(function (e, t) {
  'object' == typeof exports && 'undefined' != typeof module
    ? (module.exports = t())
    : 'function' == typeof define && define.amd
    ? define(t)
    : (e.CodeMirror = t());
})(this, function () {
  'use strict';
  function e(e) {
    return new RegExp('(^|\\s)' + e + '(?:$|\\s)\\s*');
  }
  function t(e) {
    for (var t = e.childNodes.length; t > 0; --t) e.removeChild(e.firstChild);
    return e;
  }
  function r(e, r) {
    return t(e).appendChild(r);
  }
  function n(e, t, r, n) {
    var i = document.createElement(e);
    if (
      (r && (i.className = r), n && (i.style.cssText = n), 'string' == typeof t)
    )
      i.appendChild(document.createTextNode(t));
    else if (t) for (var o = 0; o < t.length; ++o) i.appendChild(t[o]);
    return i;
  }
  function i(e, t, r, i) {
    var o = n(e, t, r, i);
    return o.setAttribute('role', 'presentation'), o;
  }
  function o(e, t) {
    if ((3 == t.nodeType && (t = t.parentNode), e.contains))
      return e.contains(t);
    do {
      if ((11 == t.nodeType && (t = t.host), t == e)) return !0;
    } while ((t = t.parentNode));
  }
  function l() {
    var e;
    try {
      e = document.activeElement;
    } catch (t) {
      e = document.body || null;
    }
    for (; e && e.shadowRoot && e.shadowRoot.activeElement; )
      e = e.shadowRoot.activeElement;
    return e;
  }
  function s(t, r) {
    var n = t.className;
    e(r).test(n) || (t.className += (n ? ' ' : '') + r);
  }
  function a(t, r) {
    for (var n = t.split(' '), i = 0; i < n.length; i++)
      n[i] && !e(n[i]).test(r) && (r += ' ' + n[i]);
    return r;
  }
  function u(e) {
    var t = Array.prototype.slice.call(arguments, 1);
    return function () {
      return e.apply(null, t);
    };
  }
  function c(e, t, r) {
    for (var n in (t || (t = {}), e))
      !e.hasOwnProperty(n) ||
        (!1 === r && t.hasOwnProperty(n)) ||
        (t[n] = e[n]);
    return t;
  }
  function h(e, t, r, n, i) {
    null == t && ((t = e.search(/[^\s\u00a0]/)), -1 == t && (t = e.length));
    for (var o = n || 0, l = i || 0; ; ) {
      var s = e.indexOf('\t', o);
      if (s < 0 || s >= t) return l + (t - o);
      (l += s - o), (l += r - (l % r)), (o = s + 1);
    }
  }
  function f(e, t) {
    for (var r = 0; r < e.length; ++r) if (e[r] == t) return r;
    return -1;
  }
  function d(e, t, r) {
    for (var n = 0, i = 0; ; ) {
      var o = e.indexOf('\t', n);
      -1 == o && (o = e.length);
      var l = o - n;
      if (o == e.length || i + l >= t) return n + Math.min(l, t - i);
      if (((i += o - n), (i += r - (i % r)), (n = o + 1), i >= t)) return n;
    }
  }
  function p(e) {
    for (; Ql.length <= e; ) Ql.push(g(Ql) + ' ');
    return Ql[e];
  }
  function g(e) {
    return e[e.length - 1];
  }
  function v(e, t) {
    for (var r = [], n = 0; n < e.length; n++) r[n] = t(e[n], n);
    return r;
  }
  function m(e, t, r) {
    for (var n = 0, i = r(t); n < e.length && r(e[n]) <= i; ) n++;
    e.splice(n, 0, t);
  }
  function y() {}
  function b(e, t) {
    var r;
    return (
      Object.create
        ? (r = Object.create(e))
        : ((y.prototype = e), (r = new y())),
      t && c(t, r),
      r
    );
  }
  function w(e) {
    return (
      /\w/.test(e) ||
      (e > '' && (e.toUpperCase() != e.toLowerCase() || Jl.test(e)))
    );
  }
  function x(e, t) {
    return t ? !!(t.source.indexOf('\\w') > -1 && w(e)) || t.test(e) : w(e);
  }
  function C(e) {
    for (var t in e) if (e.hasOwnProperty(t) && e[t]) return !1;
    return !0;
  }
  function S(e) {
    return e.charCodeAt(0) >= 768 && es.test(e);
  }
  function L(e, t, r) {
    for (; (r < 0 ? t > 0 : t < e.length) && S(e.charAt(t)); ) t += r;
    return t;
  }
  function k(e, t, r) {
    for (var n = t > r ? -1 : 1; ; ) {
      if (t == r) return t;
      var i = (t + r) / 2,
        o = n < 0 ? Math.ceil(i) : Math.floor(i);
      if (o == t) return e(o) ? t : r;
      e(o) ? (r = o) : (t = o + n);
    }
  }
  function T(e, t, r, n) {
    if (!e) return n(t, r, 'ltr', 0);
    for (var i = !1, o = 0; o < e.length; ++o) {
      var l = e[o];
      ((l.from < r && l.to > t) || (t == r && l.to == t)) &&
        (n(
          Math.max(l.from, t),
          Math.min(l.to, r),
          1 == l.level ? 'rtl' : 'ltr',
          o
        ),
        (i = !0));
    }
    i || n(t, r, 'ltr');
  }
  function M(e, t, r) {
    var n;
    ts = null;
    for (var i = 0; i < e.length; ++i) {
      var o = e[i];
      if (o.from < t && o.to > t) return i;
      o.to == t && (o.from != o.to && 'before' == r ? (n = i) : (ts = i)),
        o.from == t && (o.from != o.to && 'before' != r ? (n = i) : (ts = i));
    }
    return null != n ? n : ts;
  }
  function N(e, t) {
    var r = e.order;
    return null == r && (r = e.order = rs(e.text, t)), r;
  }
  function O(e, t) {
    return (e._handlers && e._handlers[t]) || ns;
  }
  function A(e, t, r) {
    if (e.removeEventListener) e.removeEventListener(t, r, !1);
    else if (e.detachEvent) e.detachEvent('on' + t, r);
    else {
      var n = e._handlers,
        i = n && n[t];
      if (i) {
        var o = f(i, r);
        o > -1 && (n[t] = i.slice(0, o).concat(i.slice(o + 1)));
      }
    }
  }
  function D(e, t) {
    var r = O(e, t);
    if (r.length)
      for (
        var n = Array.prototype.slice.call(arguments, 2), i = 0;
        i < r.length;
        ++i
      )
        r[i].apply(null, n);
  }
  function W(e, t, r) {
    return (
      'string' == typeof t &&
        (t = {
          type: t,
          preventDefault: function () {
            this.defaultPrevented = !0;
          },
        }),
      D(e, r || t.type, e, t),
      z(t) || t.codemirrorIgnore
    );
  }
  function H(e) {
    var t = e._handlers && e._handlers.cursorActivity;
    if (t)
      for (
        var r =
            e.curOp.cursorActivityHandlers ||
            (e.curOp.cursorActivityHandlers = []),
          n = 0;
        n < t.length;
        ++n
      )
        -1 == f(r, t[n]) && r.push(t[n]);
  }
  function F(e, t) {
    return O(e, t).length > 0;
  }
  function P(e) {
    (e.prototype.on = function (e, t) {
      is(this, e, t);
    }),
      (e.prototype.off = function (e, t) {
        A(this, e, t);
      });
  }
  function E(e) {
    e.preventDefault ? e.preventDefault() : (e.returnValue = !1);
  }
  function I(e) {
    e.stopPropagation ? e.stopPropagation() : (e.cancelBubble = !0);
  }
  function z(e) {
    return null != e.defaultPrevented ? e.defaultPrevented : 0 == e.returnValue;
  }
  function R(e) {
    E(e), I(e);
  }
  function B(e) {
    return e.target || e.srcElement;
  }
  function G(e) {
    var t = e.which;
    return (
      null == t &&
        (1 & e.button
          ? (t = 1)
          : 2 & e.button
          ? (t = 3)
          : 4 & e.button && (t = 2)),
      Fl && e.ctrlKey && 1 == t && (t = 3),
      t
    );
  }
  function U(e) {
    if (null == Kl) {
      var t = n('span', '​');
      r(e, n('span', [t, document.createTextNode('x')])),
        0 != e.firstChild.offsetHeight &&
          (Kl = t.offsetWidth <= 1 && t.offsetHeight > 2 && !(Cl && Sl < 8));
    }
    var i = Kl
      ? n('span', '​')
      : n(
          'span',
          ' ',
          null,
          'display: inline-block; width: 1px; margin-right: -1px'
        );
    return i.setAttribute('cm-text', ''), i;
  }
  function V(e) {
    if (null != jl) return jl;
    var n = r(e, document.createTextNode('AخA')),
      i = zl(n, 0, 1).getBoundingClientRect(),
      o = zl(n, 1, 2).getBoundingClientRect();
    return t(e), !(!i || i.left == i.right) && (jl = o.right - i.right < 3);
  }
  function K(e) {
    if (null != us) return us;
    var t = r(e, n('span', 'x')),
      i = t.getBoundingClientRect(),
      o = zl(t, 0, 1).getBoundingClientRect();
    return (us = Math.abs(i.left - o.left) > 1);
  }
  function j(e, t) {
    arguments.length > 2 &&
      (t.dependencies = Array.prototype.slice.call(arguments, 2)),
      (cs[e] = t);
  }
  function X(e, t) {
    hs[e] = t;
  }
  function Y(e) {
    if ('string' == typeof e && hs.hasOwnProperty(e)) e = hs[e];
    else if (e && 'string' == typeof e.name && hs.hasOwnProperty(e.name)) {
      var t = hs[e.name];
      'string' == typeof t && (t = { name: t }),
        (e = b(t, e)),
        (e.name = t.name);
    } else {
      if ('string' == typeof e && /^[\w\-]+\/[\w\-]+\+xml$/.test(e))
        return Y('application/xml');
      if ('string' == typeof e && /^[\w\-]+\/[\w\-]+\+json$/.test(e))
        return Y('application/json');
    }
    return 'string' == typeof e ? { name: e } : e || { name: 'null' };
  }
  function _(e, t) {
    t = Y(t);
    var r = cs[t.name];
    if (!r) return _(e, 'text/plain');
    var n = r(e, t);
    if (fs.hasOwnProperty(t.name)) {
      var i = fs[t.name];
      for (var o in i)
        i.hasOwnProperty(o) &&
          (n.hasOwnProperty(o) && (n['_' + o] = n[o]), (n[o] = i[o]));
    }
    if (
      ((n.name = t.name),
      t.helperType && (n.helperType = t.helperType),
      t.modeProps)
    )
      for (var l in t.modeProps) n[l] = t.modeProps[l];
    return n;
  }
  function $(e, t) {
    var r = fs.hasOwnProperty(e) ? fs[e] : (fs[e] = {});
    c(t, r);
  }
  function q(e, t) {
    if (!0 === t) return t;
    if (e.copyState) return e.copyState(t);
    var r = {};
    for (var n in t) {
      var i = t[n];
      i instanceof Array && (i = i.concat([])), (r[n] = i);
    }
    return r;
  }
  function Z(e, t) {
    for (var r; e.innerMode && ((r = e.innerMode(t)), r && r.mode != e); )
      (t = r.state), (e = r.mode);
    return r || { mode: e, state: t };
  }
  function Q(e, t, r) {
    return !e.startState || e.startState(t, r);
  }
  function J(e, t) {
    if (((t -= e.first), t < 0 || t >= e.size))
      throw new Error(
        'There is no line ' + (t + e.first) + ' in the document.'
      );
    for (var r = e; !r.lines; )
      for (var n = 0; ; ++n) {
        var i = r.children[n],
          o = i.chunkSize();
        if (t < o) {
          r = i;
          break;
        }
        t -= o;
      }
    return r.lines[t];
  }
  function ee(e, t, r) {
    var n = [],
      i = t.line;
    return (
      e.iter(t.line, r.line + 1, function (e) {
        var o = e.text;
        i == r.line && (o = o.slice(0, r.ch)),
          i == t.line && (o = o.slice(t.ch)),
          n.push(o),
          ++i;
      }),
      n
    );
  }
  function te(e, t, r) {
    var n = [];
    return (
      e.iter(t, r, function (e) {
        n.push(e.text);
      }),
      n
    );
  }
  function re(e, t) {
    var r = t - e.height;
    if (r) for (var n = e; n; n = n.parent) n.height += r;
  }
  function ne(e) {
    if (null == e.parent) return null;
    for (
      var t = e.parent, r = f(t.lines, e), n = t.parent;
      n;
      t = n, n = n.parent
    )
      for (var i = 0; n.children[i] != t; ++i) r += n.children[i].chunkSize();
    return r + t.first;
  }
  function ie(e, t) {
    var r = e.first;
    e: do {
      for (var n = 0; n < e.children.length; ++n) {
        var i = e.children[n],
          o = i.height;
        if (t < o) {
          e = i;
          continue e;
        }
        (t -= o), (r += i.chunkSize());
      }
      return r;
    } while (!e.lines);
    for (var l = 0; l < e.lines.length; ++l) {
      var s = e.lines[l],
        a = s.height;
      if (t < a) break;
      t -= a;
    }
    return r + l;
  }
  function oe(e, t) {
    return t >= e.first && t < e.first + e.size;
  }
  function le(e, t) {
    return String(e.lineNumberFormatter(t + e.firstLineNumber));
  }
  function se(e, t, r) {
    if ((void 0 === r && (r = null), !(this instanceof se)))
      return new se(e, t, r);
    (this.line = e), (this.ch = t), (this.sticky = r);
  }
  function ae(e, t) {
    return e.line - t.line || e.ch - t.ch;
  }
  function ue(e, t) {
    return e.sticky == t.sticky && 0 == ae(e, t);
  }
  function ce(e) {
    return se(e.line, e.ch);
  }
  function he(e, t) {
    return ae(e, t) < 0 ? t : e;
  }
  function fe(e, t) {
    return ae(e, t) < 0 ? e : t;
  }
  function de(e, t) {
    return Math.max(e.first, Math.min(t, e.first + e.size - 1));
  }
  function pe(e, t) {
    if (t.line < e.first) return se(e.first, 0);
    var r = e.first + e.size - 1;
    return t.line > r
      ? se(r, J(e, r).text.length)
      : ge(t, J(e, t.line).text.length);
  }
  function ge(e, t) {
    var r = e.ch;
    return null == r || r > t ? se(e.line, t) : r < 0 ? se(e.line, 0) : e;
  }
  function ve(e, t) {
    for (var r = [], n = 0; n < t.length; n++) r[n] = pe(e, t[n]);
    return r;
  }
  function me(e, t, r, n) {
    var i = [e.state.modeGen],
      o = {};
    ke(
      e,
      t.text,
      e.doc.mode,
      r,
      function (e, t) {
        return i.push(e, t);
      },
      o,
      n
    );
    for (
      var l = r.state,
        s = function (n) {
          r.baseTokens = i;
          var s = e.state.overlays[n],
            a = 1,
            u = 0;
          (r.state = !0),
            ke(
              e,
              t.text,
              s.mode,
              r,
              function (e, t) {
                for (var r = a; u < e; ) {
                  var n = i[a];
                  n > e && i.splice(a, 1, e, i[a + 1], n),
                    (a += 2),
                    (u = Math.min(e, n));
                }
                if (t)
                  if (s.opaque)
                    i.splice(r, a - r, e, 'overlay ' + t), (a = r + 2);
                  else
                    for (; r < a; r += 2) {
                      var o = i[r + 1];
                      i[r + 1] = (o ? o + ' ' : '') + 'overlay ' + t;
                    }
              },
              o
            ),
            (r.state = l),
            (r.baseTokens = null),
            (r.baseTokenPos = 1);
        },
        a = 0;
      a < e.state.overlays.length;
      ++a
    )
      s(a);
    return { styles: i, classes: o.bgClass || o.textClass ? o : null };
  }
  function ye(e, t, r) {
    if (!t.styles || t.styles[0] != e.state.modeGen) {
      var n = be(e, ne(t)),
        i =
          t.text.length > e.options.maxHighlightLength &&
          q(e.doc.mode, n.state),
        o = me(e, t, n);
      i && (n.state = i),
        (t.stateAfter = n.save(!i)),
        (t.styles = o.styles),
        o.classes
          ? (t.styleClasses = o.classes)
          : t.styleClasses && (t.styleClasses = null),
        r === e.doc.highlightFrontier &&
          (e.doc.modeFrontier = Math.max(
            e.doc.modeFrontier,
            ++e.doc.highlightFrontier
          ));
    }
    return t.styles;
  }
  function be(e, t, r) {
    var n = e.doc,
      i = e.display;
    if (!n.mode.startState) return new gs(n, !0, t);
    var o = Te(e, t, r),
      l = o > n.first && J(n, o - 1).stateAfter,
      s = l ? gs.fromSaved(n, l, o) : new gs(n, Q(n.mode), o);
    return (
      n.iter(o, t, function (r) {
        we(e, r.text, s);
        var n = s.line;
        (r.stateAfter =
          n == t - 1 || n % 5 == 0 || (n >= i.viewFrom && n < i.viewTo)
            ? s.save()
            : null),
          s.nextLine();
      }),
      r && (n.modeFrontier = s.line),
      s
    );
  }
  function we(e, t, r, n) {
    var i = e.doc.mode,
      o = new ds(t, e.options.tabSize, r);
    for (o.start = o.pos = n || 0, '' == t && xe(i, r.state); !o.eol(); )
      Ce(i, o, r.state), (o.start = o.pos);
  }
  function xe(e, t) {
    if (e.blankLine) return e.blankLine(t);
    if (e.innerMode) {
      var r = Z(e, t);
      return r.mode.blankLine ? r.mode.blankLine(r.state) : void 0;
    }
  }
  function Ce(e, t, r, n) {
    for (var i = 0; i < 10; i++) {
      n && (n[0] = Z(e, r).mode);
      var o = e.token(t, r);
      if (t.pos > t.start) return o;
    }
    throw new Error('Mode ' + e.name + ' failed to advance stream.');
  }
  function Se(e, t, r, n) {
    var i,
      o = e.doc,
      l = o.mode;
    t = pe(o, t);
    var s,
      a = J(o, t.line),
      u = be(e, t.line, r),
      c = new ds(a.text, e.options.tabSize, u);
    for (n && (s = []); (n || c.pos < t.ch) && !c.eol(); )
      (c.start = c.pos),
        (i = Ce(l, c, u.state)),
        n && s.push(new vs(c, i, q(o.mode, u.state)));
    return n ? s : new vs(c, i, u.state);
  }
  function Le(e, t) {
    if (e)
      for (;;) {
        var r = e.match(/(?:^|\s+)line-(background-)?(\S+)/);
        if (!r) break;
        e = e.slice(0, r.index) + e.slice(r.index + r[0].length);
        var n = r[1] ? 'bgClass' : 'textClass';
        null == t[n]
          ? (t[n] = r[2])
          : new RegExp('(?:^|s)' + r[2] + '(?:$|s)').test(t[n]) ||
            (t[n] += ' ' + r[2]);
      }
    return e;
  }
  function ke(e, t, r, n, i, o, l) {
    var s = r.flattenSpans;
    null == s && (s = e.options.flattenSpans);
    var a,
      u = 0,
      c = null,
      h = new ds(t, e.options.tabSize, n),
      f = e.options.addModeClass && [null];
    for ('' == t && Le(xe(r, n.state), o); !h.eol(); ) {
      if (
        (h.pos > e.options.maxHighlightLength
          ? ((s = !1), l && we(e, t, n, h.pos), (h.pos = t.length), (a = null))
          : (a = Le(Ce(r, h, n.state, f), o)),
        f)
      ) {
        var d = f[0].name;
        d && (a = 'm-' + (a ? d + ' ' + a : d));
      }
      if (!s || c != a) {
        for (; u < h.start; ) (u = Math.min(h.start, u + 5e3)), i(u, c);
        c = a;
      }
      h.start = h.pos;
    }
    for (; u < h.pos; ) {
      var p = Math.min(h.pos, u + 5e3);
      i(p, c), (u = p);
    }
  }
  function Te(e, t, r) {
    for (
      var n,
        i,
        o = e.doc,
        l = r ? -1 : t - (e.doc.mode.innerMode ? 1e3 : 100),
        s = t;
      s > l;
      --s
    ) {
      if (s <= o.first) return o.first;
      var a = J(o, s - 1),
        u = a.stateAfter;
      if (
        u &&
        (!r || s + (u instanceof ps ? u.lookAhead : 0) <= o.modeFrontier)
      )
        return s;
      var c = h(a.text, null, e.options.tabSize);
      (null == i || n > c) && ((i = s - 1), (n = c));
    }
    return i;
  }
  function Me(e, t) {
    if (
      ((e.modeFrontier = Math.min(e.modeFrontier, t)),
      !(e.highlightFrontier < t - 10))
    ) {
      for (var r = e.first, n = t - 1; n > r; n--) {
        var i = J(e, n).stateAfter;
        if (i && (!(i instanceof ps) || n + i.lookAhead < t)) {
          r = n + 1;
          break;
        }
      }
      e.highlightFrontier = Math.min(e.highlightFrontier, r);
    }
  }
  function Ne() {
    ms = !0;
  }
  function Oe() {
    ys = !0;
  }
  function Ae(e, t, r) {
    (this.marker = e), (this.from = t), (this.to = r);
  }
  function De(e, t) {
    if (e)
      for (var r = 0; r < e.length; ++r) {
        var n = e[r];
        if (n.marker == t) return n;
      }
  }
  function We(e, t) {
    for (var r, n = 0; n < e.length; ++n)
      e[n] != t && (r || (r = [])).push(e[n]);
    return r;
  }
  function He(e, t) {
    (e.markedSpans = e.markedSpans ? e.markedSpans.concat([t]) : [t]),
      t.marker.attachLine(e);
  }
  function Fe(e, t, r) {
    var n;
    if (e)
      for (var i = 0; i < e.length; ++i) {
        var o = e[i],
          l = o.marker,
          s = null == o.from || (l.inclusiveLeft ? o.from <= t : o.from < t);
        if (
          s ||
          (o.from == t && 'bookmark' == l.type && (!r || !o.marker.insertLeft))
        ) {
          var a = null == o.to || (l.inclusiveRight ? o.to >= t : o.to > t);
          (n || (n = [])).push(new Ae(l, o.from, a ? null : o.to));
        }
      }
    return n;
  }
  function Pe(e, t, r) {
    var n;
    if (e)
      for (var i = 0; i < e.length; ++i) {
        var o = e[i],
          l = o.marker,
          s = null == o.to || (l.inclusiveRight ? o.to >= t : o.to > t);
        if (
          s ||
          (o.from == t && 'bookmark' == l.type && (!r || o.marker.insertLeft))
        ) {
          var a =
            null == o.from || (l.inclusiveLeft ? o.from <= t : o.from < t);
          (n || (n = [])).push(
            new Ae(l, a ? null : o.from - t, null == o.to ? null : o.to - t)
          );
        }
      }
    return n;
  }
  function Ee(e, t) {
    if (t.full) return null;
    var r = oe(e, t.from.line) && J(e, t.from.line).markedSpans,
      n = oe(e, t.to.line) && J(e, t.to.line).markedSpans;
    if (!r && !n) return null;
    var i = t.from.ch,
      o = t.to.ch,
      l = 0 == ae(t.from, t.to),
      s = Fe(r, i, l),
      a = Pe(n, o, l),
      u = 1 == t.text.length,
      c = g(t.text).length + (u ? i : 0);
    if (s)
      for (var h = 0; h < s.length; ++h) {
        var f = s[h];
        if (null == f.to) {
          var d = De(a, f.marker);
          d ? u && (f.to = null == d.to ? null : d.to + c) : (f.to = i);
        }
      }
    if (a)
      for (var p = 0; p < a.length; ++p) {
        var v = a[p];
        if ((null != v.to && (v.to += c), null == v.from)) {
          var m = De(s, v.marker);
          m || ((v.from = c), u && (s || (s = [])).push(v));
        } else (v.from += c), u && (s || (s = [])).push(v);
      }
    s && (s = Ie(s)), a && a != s && (a = Ie(a));
    var y = [s];
    if (!u) {
      var b,
        w = t.text.length - 2;
      if (w > 0 && s)
        for (var x = 0; x < s.length; ++x)
          null == s[x].to &&
            (b || (b = [])).push(new Ae(s[x].marker, null, null));
      for (var C = 0; C < w; ++C) y.push(b);
      y.push(a);
    }
    return y;
  }
  function Ie(e) {
    for (var t = 0; t < e.length; ++t) {
      var r = e[t];
      null != r.from &&
        r.from == r.to &&
        !1 !== r.marker.clearWhenEmpty &&
        e.splice(t--, 1);
    }
    return e.length ? e : null;
  }
  function ze(e, t, r) {
    var n = null;
    if (
      (e.iter(t.line, r.line + 1, function (e) {
        if (e.markedSpans)
          for (var t = 0; t < e.markedSpans.length; ++t) {
            var r = e.markedSpans[t].marker;
            !r.readOnly || (n && -1 != f(n, r)) || (n || (n = [])).push(r);
          }
      }),
      !n)
    )
      return null;
    for (var i = [{ from: t, to: r }], o = 0; o < n.length; ++o)
      for (var l = n[o], s = l.find(0), a = 0; a < i.length; ++a) {
        var u = i[a];
        if (!(ae(u.to, s.from) < 0 || ae(u.from, s.to) > 0)) {
          var c = [a, 1],
            h = ae(u.from, s.from),
            d = ae(u.to, s.to);
          (h < 0 || (!l.inclusiveLeft && !h)) &&
            c.push({ from: u.from, to: s.from }),
            (d > 0 || (!l.inclusiveRight && !d)) &&
              c.push({ from: s.to, to: u.to }),
            i.splice.apply(i, c),
            (a += c.length - 3);
        }
      }
    return i;
  }
  function Re(e) {
    var t = e.markedSpans;
    if (t) {
      for (var r = 0; r < t.length; ++r) t[r].marker.detachLine(e);
      e.markedSpans = null;
    }
  }
  function Be(e, t) {
    if (t) {
      for (var r = 0; r < t.length; ++r) t[r].marker.attachLine(e);
      e.markedSpans = t;
    }
  }
  function Ge(e) {
    return e.inclusiveLeft ? -1 : 0;
  }
  function Ue(e) {
    return e.inclusiveRight ? 1 : 0;
  }
  function Ve(e, t) {
    var r = e.lines.length - t.lines.length;
    if (0 != r) return r;
    var n = e.find(),
      i = t.find(),
      o = ae(n.from, i.from) || Ge(e) - Ge(t);
    if (o) return -o;
    var l = ae(n.to, i.to) || Ue(e) - Ue(t);
    return l || t.id - e.id;
  }
  function Ke(e, t) {
    var r,
      n = ys && e.markedSpans;
    if (n)
      for (var i = void 0, o = 0; o < n.length; ++o)
        (i = n[o]),
          i.marker.collapsed &&
            null == (t ? i.from : i.to) &&
            (!r || Ve(r, i.marker) < 0) &&
            (r = i.marker);
    return r;
  }
  function je(e) {
    return Ke(e, !0);
  }
  function Xe(e) {
    return Ke(e, !1);
  }
  function Ye(e, t) {
    var r,
      n = ys && e.markedSpans;
    if (n)
      for (var i = 0; i < n.length; ++i) {
        var o = n[i];
        o.marker.collapsed &&
          (null == o.from || o.from < t) &&
          (null == o.to || o.to > t) &&
          (!r || Ve(r, o.marker) < 0) &&
          (r = o.marker);
      }
    return r;
  }
  function _e(e, t, r, n, i) {
    var o = J(e, t),
      l = ys && o.markedSpans;
    if (l)
      for (var s = 0; s < l.length; ++s) {
        var a = l[s];
        if (a.marker.collapsed) {
          var u = a.marker.find(0),
            c = ae(u.from, r) || Ge(a.marker) - Ge(i),
            h = ae(u.to, n) || Ue(a.marker) - Ue(i);
          if (
            !((c >= 0 && h <= 0) || (c <= 0 && h >= 0)) &&
            ((c <= 0 &&
              (a.marker.inclusiveRight && i.inclusiveLeft
                ? ae(u.to, r) >= 0
                : ae(u.to, r) > 0)) ||
              (c >= 0 &&
                (a.marker.inclusiveRight && i.inclusiveLeft
                  ? ae(u.from, n) <= 0
                  : ae(u.from, n) < 0)))
          )
            return !0;
        }
      }
  }
  function $e(e) {
    for (var t; (t = je(e)); ) e = t.find(-1, !0).line;
    return e;
  }
  function qe(e) {
    for (var t; (t = Xe(e)); ) e = t.find(1, !0).line;
    return e;
  }
  function Ze(e) {
    for (var t, r; (t = Xe(e)); )
      (e = t.find(1, !0).line), (r || (r = [])).push(e);
    return r;
  }
  function Qe(e, t) {
    var r = J(e, t),
      n = $e(r);
    return r == n ? t : ne(n);
  }
  function Je(e, t) {
    if (t > e.lastLine()) return t;
    var r,
      n = J(e, t);
    if (!et(e, n)) return t;
    for (; (r = Xe(n)); ) n = r.find(1, !0).line;
    return ne(n) + 1;
  }
  function et(e, t) {
    var r = ys && t.markedSpans;
    if (r)
      for (var n = void 0, i = 0; i < r.length; ++i)
        if (((n = r[i]), n.marker.collapsed)) {
          if (null == n.from) return !0;
          if (
            !n.marker.widgetNode &&
            0 == n.from &&
            n.marker.inclusiveLeft &&
            tt(e, t, n)
          )
            return !0;
        }
  }
  function tt(e, t, r) {
    if (null == r.to) {
      var n = r.marker.find(1, !0);
      return tt(e, n.line, De(n.line.markedSpans, r.marker));
    }
    if (r.marker.inclusiveRight && r.to == t.text.length) return !0;
    for (var i = void 0, o = 0; o < t.markedSpans.length; ++o)
      if (
        ((i = t.markedSpans[o]),
        i.marker.collapsed &&
          !i.marker.widgetNode &&
          i.from == r.to &&
          (null == i.to || i.to != r.from) &&
          (i.marker.inclusiveLeft || r.marker.inclusiveRight) &&
          tt(e, t, i))
      )
        return !0;
  }
  function rt(e) {
    e = $e(e);
    for (var t = 0, r = e.parent, n = 0; n < r.lines.length; ++n) {
      var i = r.lines[n];
      if (i == e) break;
      t += i.height;
    }
    for (var o = r.parent; o; r = o, o = r.parent)
      for (var l = 0; l < o.children.length; ++l) {
        var s = o.children[l];
        if (s == r) break;
        t += s.height;
      }
    return t;
  }
  function nt(e) {
    if (0 == e.height) return 0;
    for (var t, r = e.text.length, n = e; (t = je(n)); ) {
      var i = t.find(0, !0);
      (n = i.from.line), (r += i.from.ch - i.to.ch);
    }
    for (n = e; (t = Xe(n)); ) {
      var o = t.find(0, !0);
      (r -= n.text.length - o.from.ch),
        (n = o.to.line),
        (r += n.text.length - o.to.ch);
    }
    return r;
  }
  function it(e) {
    var t = e.display,
      r = e.doc;
    (t.maxLine = J(r, r.first)),
      (t.maxLineLength = nt(t.maxLine)),
      (t.maxLineChanged = !0),
      r.iter(function (e) {
        var r = nt(e);
        r > t.maxLineLength && ((t.maxLineLength = r), (t.maxLine = e));
      });
  }
  function ot(e, t, r, n) {
    (e.text = t),
      e.stateAfter && (e.stateAfter = null),
      e.styles && (e.styles = null),
      null != e.order && (e.order = null),
      Re(e),
      Be(e, r);
    var i = n ? n(e) : 1;
    i != e.height && re(e, i);
  }
  function lt(e) {
    (e.parent = null), Re(e);
  }
  function st(e, t) {
    if (!e || /^\s*$/.test(e)) return null;
    var r = t.addModeClass ? Cs : xs;
    return r[e] || (r[e] = e.replace(/\S+/g, 'cm-$&'));
  }
  function at(e, t) {
    var r = i('span', null, null, Ll ? 'padding-right: .1px' : null),
      n = {
        pre: i('pre', [r], 'CodeMirror-line'),
        content: r,
        col: 0,
        pos: 0,
        cm: e,
        trailingSpace: !1,
        splitSpaces: e.getOption('lineWrapping'),
      };
    t.measure = {};
    for (var o = 0; o <= (t.rest ? t.rest.length : 0); o++) {
      var l = o ? t.rest[o - 1] : t.line,
        s = void 0;
      (n.pos = 0),
        (n.addToken = ct),
        V(e.display.measure) &&
          (s = N(l, e.doc.direction)) &&
          (n.addToken = ft(n.addToken, s)),
        (n.map = []);
      var u = t != e.display.externalMeasured && ne(l);
      pt(l, n, ye(e, l, u)),
        l.styleClasses &&
          (l.styleClasses.bgClass &&
            (n.bgClass = a(l.styleClasses.bgClass, n.bgClass || '')),
          l.styleClasses.textClass &&
            (n.textClass = a(l.styleClasses.textClass, n.textClass || ''))),
        0 == n.map.length &&
          n.map.push(0, 0, n.content.appendChild(U(e.display.measure))),
        0 == o
          ? ((t.measure.map = n.map), (t.measure.cache = {}))
          : ((t.measure.maps || (t.measure.maps = [])).push(n.map),
            (t.measure.caches || (t.measure.caches = [])).push({}));
    }
    if (Ll) {
      var c = n.content.lastChild;
      (/\bcm-tab\b/.test(c.className) ||
        (c.querySelector && c.querySelector('.cm-tab'))) &&
        (n.content.className = 'cm-tab-wrap-hack');
    }
    return (
      D(e, 'renderLine', e, t.line, n.pre),
      n.pre.className && (n.textClass = a(n.pre.className, n.textClass || '')),
      n
    );
  }
  function ut(e) {
    var t = n('span', '•', 'cm-invalidchar');
    return (
      (t.title = '\\u' + e.charCodeAt(0).toString(16)),
      t.setAttribute('aria-label', t.title),
      t
    );
  }
  function ct(e, t, r, i, o, l, s) {
    if (t) {
      var a,
        u = e.splitSpaces ? ht(t, e.trailingSpace) : t,
        c = e.cm.state.specialChars,
        h = !1;
      if (c.test(t)) {
        a = document.createDocumentFragment();
        for (var f = 0; ; ) {
          c.lastIndex = f;
          var d = c.exec(t),
            g = d ? d.index - f : t.length - f;
          if (g) {
            var v = document.createTextNode(u.slice(f, f + g));
            Cl && Sl < 9 ? a.appendChild(n('span', [v])) : a.appendChild(v),
              e.map.push(e.pos, e.pos + g, v),
              (e.col += g),
              (e.pos += g);
          }
          if (!d) break;
          f += g + 1;
          var m = void 0;
          if ('\t' == d[0]) {
            var y = e.cm.options.tabSize,
              b = y - (e.col % y);
            (m = a.appendChild(n('span', p(b), 'cm-tab'))),
              m.setAttribute('role', 'presentation'),
              m.setAttribute('cm-text', '\t'),
              (e.col += b);
          } else
            '\r' == d[0] || '\n' == d[0]
              ? ((m = a.appendChild(
                  n('span', '\r' == d[0] ? '␍' : '␤', 'cm-invalidchar')
                )),
                m.setAttribute('cm-text', d[0]),
                (e.col += 1))
              : ((m = e.cm.options.specialCharPlaceholder(d[0])),
                m.setAttribute('cm-text', d[0]),
                Cl && Sl < 9 ? a.appendChild(n('span', [m])) : a.appendChild(m),
                (e.col += 1));
          e.map.push(e.pos, e.pos + 1, m), e.pos++;
        }
      } else
        (e.col += t.length),
          (a = document.createTextNode(u)),
          e.map.push(e.pos, e.pos + t.length, a),
          Cl && Sl < 9 && (h = !0),
          (e.pos += t.length);
      if (
        ((e.trailingSpace = 32 == u.charCodeAt(t.length - 1)),
        r || i || o || h || l)
      ) {
        var w = r || '';
        i && (w += i), o && (w += o);
        var x = n('span', [a], w, l);
        if (s)
          for (var C in s)
            s.hasOwnProperty(C) &&
              'style' != C &&
              'class' != C &&
              x.setAttribute(C, s[C]);
        return e.content.appendChild(x);
      }
      e.content.appendChild(a);
    }
  }
  function ht(e, t) {
    if (e.length > 1 && !/  /.test(e)) return e;
    for (var r = t, n = '', i = 0; i < e.length; i++) {
      var o = e.charAt(i);
      ' ' != o ||
        !r ||
        (i != e.length - 1 && 32 != e.charCodeAt(i + 1)) ||
        (o = ' '),
        (n += o),
        (r = ' ' == o);
    }
    return n;
  }
  function ft(e, t) {
    return function (r, n, i, o, l, s, a) {
      i = i ? i + ' cm-force-border' : 'cm-force-border';
      for (var u = r.pos, c = u + n.length; ; ) {
        for (
          var h = void 0, f = 0;
          f < t.length && ((h = t[f]), !(h.to > u && h.from <= u));
          f++
        );
        if (h.to >= c) return e(r, n, i, o, l, s, a);
        e(r, n.slice(0, h.to - u), i, o, null, s, a),
          (o = null),
          (n = n.slice(h.to - u)),
          (u = h.to);
      }
    };
  }
  function dt(e, t, r, n) {
    var i = !n && r.widgetNode;
    i && e.map.push(e.pos, e.pos + t, i),
      !n &&
        e.cm.display.input.needsContentAttribute &&
        (i || (i = e.content.appendChild(document.createElement('span'))),
        i.setAttribute('cm-marker', r.id)),
      i && (e.cm.display.input.setUneditable(i), e.content.appendChild(i)),
      (e.pos += t),
      (e.trailingSpace = !1);
  }
  function pt(e, t, r) {
    var n = e.markedSpans,
      i = e.text,
      o = 0;
    if (n)
      for (
        var l, s, a, u, c, h, f, d = i.length, p = 0, g = 1, v = '', m = 0;
        ;

      ) {
        if (m == p) {
          (a = u = c = s = ''), (f = null), (h = null), (m = 1 / 0);
          for (var y = [], b = void 0, w = 0; w < n.length; ++w) {
            var x = n[w],
              C = x.marker;
            if ('bookmark' == C.type && x.from == p && C.widgetNode) y.push(C);
            else if (
              x.from <= p &&
              (null == x.to ||
                x.to > p ||
                (C.collapsed && x.to == p && x.from == p))
            ) {
              if (
                (null != x.to &&
                  x.to != p &&
                  m > x.to &&
                  ((m = x.to), (u = '')),
                C.className && (a += ' ' + C.className),
                C.css && (s = (s ? s + ';' : '') + C.css),
                C.startStyle && x.from == p && (c += ' ' + C.startStyle),
                C.endStyle &&
                  x.to == m &&
                  (b || (b = [])).push(C.endStyle, x.to),
                C.title && ((f || (f = {})).title = C.title),
                C.attributes)
              )
                for (var S in C.attributes)
                  (f || (f = {}))[S] = C.attributes[S];
              C.collapsed && (!h || Ve(h.marker, C) < 0) && (h = x);
            } else x.from > p && m > x.from && (m = x.from);
          }
          if (b)
            for (var L = 0; L < b.length; L += 2)
              b[L + 1] == m && (u += ' ' + b[L]);
          if (!h || h.from == p)
            for (var k = 0; k < y.length; ++k) dt(t, 0, y[k]);
          if (h && (h.from || 0) == p) {
            if (
              (dt(
                t,
                (null == h.to ? d + 1 : h.to) - p,
                h.marker,
                null == h.from
              ),
              null == h.to)
            )
              return;
            h.to == p && (h = !1);
          }
        }
        if (p >= d) break;
        for (var T = Math.min(d, m); ; ) {
          if (v) {
            var M = p + v.length;
            if (!h) {
              var N = M > T ? v.slice(0, T - p) : v;
              t.addToken(
                t,
                N,
                l ? l + a : a,
                c,
                p + N.length == m ? u : '',
                s,
                f
              );
            }
            if (M >= T) {
              (v = v.slice(T - p)), (p = T);
              break;
            }
            (p = M), (c = '');
          }
          (v = i.slice(o, (o = r[g++]))), (l = st(r[g++], t.cm.options));
        }
      }
    else
      for (var O = 1; O < r.length; O += 2)
        t.addToken(t, i.slice(o, (o = r[O])), st(r[O + 1], t.cm.options));
  }
  function gt(e, t, r) {
    (this.line = t),
      (this.rest = Ze(t)),
      (this.size = this.rest ? ne(g(this.rest)) - r + 1 : 1),
      (this.node = this.text = null),
      (this.hidden = et(e, t));
  }
  function vt(e, t, r) {
    for (var n, i = [], o = t; o < r; o = n) {
      var l = new gt(e.doc, J(e.doc, o), o);
      (n = o + l.size), i.push(l);
    }
    return i;
  }
  function mt(e) {
    Ss
      ? Ss.ops.push(e)
      : (e.ownsGroup = Ss = { ops: [e], delayedCallbacks: [] });
  }
  function yt(e) {
    var t = e.delayedCallbacks,
      r = 0;
    do {
      for (; r < t.length; r++) t[r].call(null);
      for (var n = 0; n < e.ops.length; n++) {
        var i = e.ops[n];
        if (i.cursorActivityHandlers)
          for (; i.cursorActivityCalled < i.cursorActivityHandlers.length; )
            i.cursorActivityHandlers[i.cursorActivityCalled++].call(null, i.cm);
      }
    } while (r < t.length);
  }
  function bt(e, t) {
    var r = e.ownsGroup;
    if (r)
      try {
        yt(r);
      } finally {
        (Ss = null), t(r);
      }
  }
  function wt(e, t) {
    var r = O(e, t);
    if (r.length) {
      var n,
        i = Array.prototype.slice.call(arguments, 2);
      Ss
        ? (n = Ss.delayedCallbacks)
        : Ls
        ? (n = Ls)
        : ((n = Ls = []), setTimeout(xt, 0));
      for (
        var o = function (e) {
            n.push(function () {
              return r[e].apply(null, i);
            });
          },
          l = 0;
        l < r.length;
        ++l
      )
        o(l);
    }
  }
  function xt() {
    var e = Ls;
    Ls = null;
    for (var t = 0; t < e.length; ++t) e[t]();
  }
  function Ct(e, t, r, n) {
    for (var i = 0; i < t.changes.length; i++) {
      var o = t.changes[i];
      'text' == o
        ? Tt(e, t)
        : 'gutter' == o
        ? Nt(e, t, r, n)
        : 'class' == o
        ? Mt(e, t)
        : 'widget' == o && Ot(e, t, n);
    }
    t.changes = null;
  }
  function St(e) {
    return (
      e.node == e.text &&
        ((e.node = n('div', null, null, 'position: relative')),
        e.text.parentNode && e.text.parentNode.replaceChild(e.node, e.text),
        e.node.appendChild(e.text),
        Cl && Sl < 8 && (e.node.style.zIndex = 2)),
      e.node
    );
  }
  function Lt(e, t) {
    var r = t.bgClass
      ? t.bgClass + ' ' + (t.line.bgClass || '')
      : t.line.bgClass;
    if ((r && (r += ' CodeMirror-linebackground'), t.background))
      r
        ? (t.background.className = r)
        : (t.background.parentNode.removeChild(t.background),
          (t.background = null));
    else if (r) {
      var i = St(t);
      (t.background = i.insertBefore(n('div', null, r), i.firstChild)),
        e.display.input.setUneditable(t.background);
    }
  }
  function kt(e, t) {
    var r = e.display.externalMeasured;
    return r && r.line == t.line
      ? ((e.display.externalMeasured = null), (t.measure = r.measure), r.built)
      : at(e, t);
  }
  function Tt(e, t) {
    var r = t.text.className,
      n = kt(e, t);
    t.text == t.node && (t.node = n.pre),
      t.text.parentNode.replaceChild(n.pre, t.text),
      (t.text = n.pre),
      n.bgClass != t.bgClass || n.textClass != t.textClass
        ? ((t.bgClass = n.bgClass), (t.textClass = n.textClass), Mt(e, t))
        : r && (t.text.className = r);
  }
  function Mt(e, t) {
    Lt(e, t),
      t.line.wrapClass
        ? (St(t).className = t.line.wrapClass)
        : t.node != t.text && (t.node.className = '');
    var r = t.textClass
      ? t.textClass + ' ' + (t.line.textClass || '')
      : t.line.textClass;
    t.text.className = r || '';
  }
  function Nt(e, t, r, i) {
    if (
      (t.gutter && (t.node.removeChild(t.gutter), (t.gutter = null)),
      t.gutterBackground &&
        (t.node.removeChild(t.gutterBackground), (t.gutterBackground = null)),
      t.line.gutterClass)
    ) {
      var o = St(t);
      (t.gutterBackground = n(
        'div',
        null,
        'CodeMirror-gutter-background ' + t.line.gutterClass,
        'left: ' +
          (e.options.fixedGutter ? i.fixedPos : -i.gutterTotalWidth) +
          'px; width: ' +
          i.gutterTotalWidth +
          'px'
      )),
        e.display.input.setUneditable(t.gutterBackground),
        o.insertBefore(t.gutterBackground, t.text);
    }
    var l = t.line.gutterMarkers;
    if (e.options.lineNumbers || l) {
      var s = St(t),
        a = (t.gutter = n(
          'div',
          null,
          'CodeMirror-gutter-wrapper',
          'left: ' +
            (e.options.fixedGutter ? i.fixedPos : -i.gutterTotalWidth) +
            'px'
        ));
      if (
        (e.display.input.setUneditable(a),
        s.insertBefore(a, t.text),
        t.line.gutterClass && (a.className += ' ' + t.line.gutterClass),
        !e.options.lineNumbers ||
          (l && l['CodeMirror-linenumbers']) ||
          (t.lineNumber = a.appendChild(
            n(
              'div',
              le(e.options, r),
              'CodeMirror-linenumber CodeMirror-gutter-elt',
              'left: ' +
                i.gutterLeft['CodeMirror-linenumbers'] +
                'px; width: ' +
                e.display.lineNumInnerWidth +
                'px'
            )
          )),
        l)
      )
        for (var u = 0; u < e.display.gutterSpecs.length; ++u) {
          var c = e.display.gutterSpecs[u].className,
            h = l.hasOwnProperty(c) && l[c];
          h &&
            a.appendChild(
              n(
                'div',
                [h],
                'CodeMirror-gutter-elt',
                'left: ' +
                  i.gutterLeft[c] +
                  'px; width: ' +
                  i.gutterWidth[c] +
                  'px'
              )
            );
        }
    }
  }
  function Ot(t, r, n) {
    r.alignable && (r.alignable = null);
    for (
      var i = e('CodeMirror-linewidget'), o = r.node.firstChild, l = void 0;
      o;
      o = l
    )
      (l = o.nextSibling), i.test(o.className) && r.node.removeChild(o);
    Dt(t, r, n);
  }
  function At(e, t, r, n) {
    var i = kt(e, t);
    return (
      (t.text = t.node = i.pre),
      i.bgClass && (t.bgClass = i.bgClass),
      i.textClass && (t.textClass = i.textClass),
      Mt(e, t),
      Nt(e, t, r, n),
      Dt(e, t, n),
      t.node
    );
  }
  function Dt(e, t, r) {
    if ((Wt(e, t.line, t, r, !0), t.rest))
      for (var n = 0; n < t.rest.length; n++) Wt(e, t.rest[n], t, r, !1);
  }
  function Wt(e, t, r, i, o) {
    if (t.widgets)
      for (var l = St(r), s = 0, a = t.widgets; s < a.length; ++s) {
        var u = a[s],
          c = n(
            'div',
            [u.node],
            'CodeMirror-linewidget' + (u.className ? ' ' + u.className : '')
          );
        u.handleMouseEvents || c.setAttribute('cm-ignore-events', 'true'),
          Ht(u, c, r, i),
          e.display.input.setUneditable(c),
          o && u.above
            ? l.insertBefore(c, r.gutter || r.text)
            : l.appendChild(c),
          wt(u, 'redraw');
      }
  }
  function Ht(e, t, r, n) {
    if (e.noHScroll) {
      (r.alignable || (r.alignable = [])).push(t);
      var i = n.wrapperWidth;
      (t.style.left = n.fixedPos + 'px'),
        e.coverGutter ||
          ((i -= n.gutterTotalWidth),
          (t.style.paddingLeft = n.gutterTotalWidth + 'px')),
        (t.style.width = i + 'px');
    }
    e.coverGutter &&
      ((t.style.zIndex = 5),
      (t.style.position = 'relative'),
      e.noHScroll || (t.style.marginLeft = -n.gutterTotalWidth + 'px'));
  }
  function Ft(e) {
    if (null != e.height) return e.height;
    var t = e.doc.cm;
    if (!t) return 0;
    if (!o(document.body, e.node)) {
      var i = 'position: relative;';
      e.coverGutter &&
        (i += 'margin-left: -' + t.display.gutters.offsetWidth + 'px;'),
        e.noHScroll && (i += 'width: ' + t.display.wrapper.clientWidth + 'px;'),
        r(t.display.measure, n('div', [e.node], null, i));
    }
    return (e.height = e.node.parentNode.offsetHeight);
  }
  function Pt(e, t) {
    for (var r = B(t); r != e.wrapper; r = r.parentNode)
      if (
        !r ||
        (1 == r.nodeType && 'true' == r.getAttribute('cm-ignore-events')) ||
        (r.parentNode == e.sizer && r != e.mover)
      )
        return !0;
  }
  function Et(e) {
    return e.lineSpace.offsetTop;
  }
  function It(e) {
    return e.mover.offsetHeight - e.lineSpace.offsetHeight;
  }
  function zt(e) {
    if (e.cachedPaddingH) return e.cachedPaddingH;
    var t = r(e.measure, n('pre', 'x', 'CodeMirror-line-like')),
      i = window.getComputedStyle ? window.getComputedStyle(t) : t.currentStyle,
      o = { left: parseInt(i.paddingLeft), right: parseInt(i.paddingRight) };
    return isNaN(o.left) || isNaN(o.right) || (e.cachedPaddingH = o), o;
  }
  function Rt(e) {
    return Yl - e.display.nativeBarWidth;
  }
  function Bt(e) {
    return e.display.scroller.clientWidth - Rt(e) - e.display.barWidth;
  }
  function Gt(e) {
    return e.display.scroller.clientHeight - Rt(e) - e.display.barHeight;
  }
  function Ut(e, t, r) {
    var n = e.options.lineWrapping,
      i = n && Bt(e);
    if (!t.measure.heights || (n && t.measure.width != i)) {
      var o = (t.measure.heights = []);
      if (n) {
        t.measure.width = i;
        for (
          var l = t.text.firstChild.getClientRects(), s = 0;
          s < l.length - 1;
          s++
        ) {
          var a = l[s],
            u = l[s + 1];
          Math.abs(a.bottom - u.bottom) > 2 &&
            o.push((a.bottom + u.top) / 2 - r.top);
        }
      }
      o.push(r.bottom - r.top);
    }
  }
  function Vt(e, t, r) {
    if (e.line == t) return { map: e.measure.map, cache: e.measure.cache };
    for (var n = 0; n < e.rest.length; n++)
      if (e.rest[n] == t)
        return { map: e.measure.maps[n], cache: e.measure.caches[n] };
    for (var i = 0; i < e.rest.length; i++)
      if (ne(e.rest[i]) > r)
        return {
          map: e.measure.maps[i],
          cache: e.measure.caches[i],
          before: !0,
        };
  }
  function Kt(e, t) {
    t = $e(t);
    var n = ne(t),
      i = (e.display.externalMeasured = new gt(e.doc, t, n));
    i.lineN = n;
    var o = (i.built = at(e, i));
    return (i.text = o.pre), r(e.display.lineMeasure, o.pre), i;
  }
  function jt(e, t, r, n) {
    return _t(e, Yt(e, t), r, n);
  }
  function Xt(e, t) {
    if (t >= e.display.viewFrom && t < e.display.viewTo)
      return e.display.view[kr(e, t)];
    var r = e.display.externalMeasured;
    return r && t >= r.lineN && t < r.lineN + r.size ? r : void 0;
  }
  function Yt(e, t) {
    var r = ne(t),
      n = Xt(e, r);
    n && !n.text
      ? (n = null)
      : n && n.changes && (Ct(e, n, r, wr(e)), (e.curOp.forceUpdate = !0)),
      n || (n = Kt(e, t));
    var i = Vt(n, t, r);
    return {
      line: t,
      view: n,
      rect: null,
      map: i.map,
      cache: i.cache,
      before: i.before,
      hasHeights: !1,
    };
  }
  function _t(e, t, r, n, i) {
    t.before && (r = -1);
    var o,
      l = r + (n || '');
    return (
      t.cache.hasOwnProperty(l)
        ? (o = t.cache[l])
        : (t.rect || (t.rect = t.view.text.getBoundingClientRect()),
          t.hasHeights || (Ut(e, t.view, t.rect), (t.hasHeights = !0)),
          (o = Zt(e, t, r, n)),
          o.bogus || (t.cache[l] = o)),
      {
        left: o.left,
        right: o.right,
        top: i ? o.rtop : o.top,
        bottom: i ? o.rbottom : o.bottom,
      }
    );
  }
  function $t(e, t, r) {
    for (var n, i, o, l, s, a, u = 0; u < e.length; u += 3)
      if (
        ((s = e[u]),
        (a = e[u + 1]),
        t < s
          ? ((i = 0), (o = 1), (l = 'left'))
          : t < a
          ? ((i = t - s), (o = i + 1))
          : (u == e.length - 3 || (t == a && e[u + 3] > t)) &&
            ((o = a - s), (i = o - 1), t >= a && (l = 'right')),
        null != i)
      ) {
        if (
          ((n = e[u + 2]),
          s == a && r == (n.insertLeft ? 'left' : 'right') && (l = r),
          'left' == r && 0 == i)
        )
          for (; u && e[u - 2] == e[u - 3] && e[u - 1].insertLeft; )
            (n = e[2 + (u -= 3)]), (l = 'left');
        if ('right' == r && i == a - s)
          for (
            ;
            u < e.length - 3 && e[u + 3] == e[u + 4] && !e[u + 5].insertLeft;

          )
            (n = e[(u += 3) + 2]), (l = 'right');
        break;
      }
    return {
      node: n,
      start: i,
      end: o,
      collapse: l,
      coverStart: s,
      coverEnd: a,
    };
  }
  function qt(e, t) {
    var r = ks;
    if ('left' == t)
      for (var n = 0; n < e.length && (r = e[n]).left == r.right; n++);
    else for (var i = e.length - 1; i >= 0 && (r = e[i]).left == r.right; i--);
    return r;
  }
  function Zt(e, t, r, n) {
    var i,
      o = $t(t.map, r, n),
      l = o.node,
      s = o.start,
      a = o.end,
      u = o.collapse;
    if (3 == l.nodeType) {
      for (var c = 0; c < 4; c++) {
        for (; s && S(t.line.text.charAt(o.coverStart + s)); ) --s;
        for (
          ;
          o.coverStart + a < o.coverEnd &&
          S(t.line.text.charAt(o.coverStart + a));

        )
          ++a;
        if (
          ((i =
            Cl && Sl < 9 && 0 == s && a == o.coverEnd - o.coverStart
              ? l.parentNode.getBoundingClientRect()
              : qt(zl(l, s, a).getClientRects(), n)),
          i.left || i.right || 0 == s)
        )
          break;
        (a = s), (s -= 1), (u = 'right');
      }
      Cl && Sl < 11 && (i = Qt(e.display.measure, i));
    } else {
      var h;
      s > 0 && (u = n = 'right'),
        (i =
          e.options.lineWrapping && (h = l.getClientRects()).length > 1
            ? h['right' == n ? h.length - 1 : 0]
            : l.getBoundingClientRect());
    }
    if (Cl && Sl < 9 && !s && (!i || (!i.left && !i.right))) {
      var f = l.parentNode.getClientRects()[0];
      i = f
        ? {
            left: f.left,
            right: f.left + br(e.display),
            top: f.top,
            bottom: f.bottom,
          }
        : ks;
    }
    for (
      var d = i.top - t.rect.top,
        p = i.bottom - t.rect.top,
        g = (d + p) / 2,
        v = t.view.measure.heights,
        m = 0;
      m < v.length - 1 && !(g < v[m]);
      m++
    );
    var y = m ? v[m - 1] : 0,
      b = v[m],
      w = {
        left: ('right' == u ? i.right : i.left) - t.rect.left,
        right: ('left' == u ? i.left : i.right) - t.rect.left,
        top: y,
        bottom: b,
      };
    return (
      i.left || i.right || (w.bogus = !0),
      e.options.singleCursorHeightPerLine || ((w.rtop = d), (w.rbottom = p)),
      w
    );
  }
  function Qt(e, t) {
    if (
      !window.screen ||
      null == screen.logicalXDPI ||
      screen.logicalXDPI == screen.deviceXDPI ||
      !K(e)
    )
      return t;
    var r = screen.logicalXDPI / screen.deviceXDPI,
      n = screen.logicalYDPI / screen.deviceYDPI;
    return {
      left: t.left * r,
      right: t.right * r,
      top: t.top * n,
      bottom: t.bottom * n,
    };
  }
  function Jt(e) {
    if (
      e.measure &&
      ((e.measure.cache = {}), (e.measure.heights = null), e.rest)
    )
      for (var t = 0; t < e.rest.length; t++) e.measure.caches[t] = {};
  }
  function er(e) {
    (e.display.externalMeasure = null), t(e.display.lineMeasure);
    for (var r = 0; r < e.display.view.length; r++) Jt(e.display.view[r]);
  }
  function tr(e) {
    er(e),
      (e.display.cachedCharWidth = e.display.cachedTextHeight = e.display.cachedPaddingH = null),
      e.options.lineWrapping || (e.display.maxLineChanged = !0),
      (e.display.lineNumChars = null);
  }
  function rr() {
    return Tl && Wl
      ? -(
          document.body.getBoundingClientRect().left -
          parseInt(getComputedStyle(document.body).marginLeft)
        )
      : window.pageXOffset ||
          (document.documentElement || document.body).scrollLeft;
  }
  function nr() {
    return Tl && Wl
      ? -(
          document.body.getBoundingClientRect().top -
          parseInt(getComputedStyle(document.body).marginTop)
        )
      : window.pageYOffset ||
          (document.documentElement || document.body).scrollTop;
  }
  function ir(e) {
    var t = 0;
    if (e.widgets)
      for (var r = 0; r < e.widgets.length; ++r)
        e.widgets[r].above && (t += Ft(e.widgets[r]));
    return t;
  }
  function or(e, t, r, n, i) {
    if (!i) {
      var o = ir(t);
      (r.top += o), (r.bottom += o);
    }
    if ('line' == n) return r;
    n || (n = 'local');
    var l = rt(t);
    if (
      ('local' == n ? (l += Et(e.display)) : (l -= e.display.viewOffset),
      'page' == n || 'window' == n)
    ) {
      var s = e.display.lineSpace.getBoundingClientRect();
      l += s.top + ('window' == n ? 0 : nr());
      var a = s.left + ('window' == n ? 0 : rr());
      (r.left += a), (r.right += a);
    }
    return (r.top += l), (r.bottom += l), r;
  }
  function lr(e, t, r) {
    if ('div' == r) return t;
    var n = t.left,
      i = t.top;
    if ('page' == r) (n -= rr()), (i -= nr());
    else if ('local' == r || !r) {
      var o = e.display.sizer.getBoundingClientRect();
      (n += o.left), (i += o.top);
    }
    var l = e.display.lineSpace.getBoundingClientRect();
    return { left: n - l.left, top: i - l.top };
  }
  function sr(e, t, r, n, i) {
    return n || (n = J(e.doc, t.line)), or(e, n, jt(e, n, t.ch, i), r);
  }
  function ar(e, t, r, n, i, o) {
    function l(t, l) {
      var s = _t(e, i, t, l ? 'right' : 'left', o);
      return l ? (s.left = s.right) : (s.right = s.left), or(e, n, s, r);
    }
    function s(e, t, r) {
      var n = a[t],
        i = 1 == n.level;
      return l(r ? e - 1 : e, i != r);
    }
    (n = n || J(e.doc, t.line)), i || (i = Yt(e, n));
    var a = N(n, e.doc.direction),
      u = t.ch,
      c = t.sticky;
    if (
      (u >= n.text.length
        ? ((u = n.text.length), (c = 'before'))
        : u <= 0 && ((u = 0), (c = 'after')),
      !a)
    )
      return l('before' == c ? u - 1 : u, 'before' == c);
    var h = M(a, u, c),
      f = ts,
      d = s(u, h, 'before' == c);
    return null != f && (d.other = s(u, f, 'before' != c)), d;
  }
  function ur(e, t) {
    var r = 0;
    (t = pe(e.doc, t)), e.options.lineWrapping || (r = br(e.display) * t.ch);
    var n = J(e.doc, t.line),
      i = rt(n) + Et(e.display);
    return { left: r, right: r, top: i, bottom: i + n.height };
  }
  function cr(e, t, r, n, i) {
    var o = se(e, t, r);
    return (o.xRel = i), n && (o.outside = n), o;
  }
  function hr(e, t, r) {
    var n = e.doc;
    if (((r += e.display.viewOffset), r < 0))
      return cr(n.first, 0, null, -1, -1);
    var i = ie(n, r),
      o = n.first + n.size - 1;
    if (i > o) return cr(n.first + n.size - 1, J(n, o).text.length, null, 1, 1);
    t < 0 && (t = 0);
    for (var l = J(n, i); ; ) {
      var s = gr(e, l, i, t, r),
        a = Ye(l, s.ch + (s.xRel > 0 || s.outside > 0 ? 1 : 0));
      if (!a) return s;
      var u = a.find(1);
      if (u.line == i) return u;
      l = J(n, (i = u.line));
    }
  }
  function fr(e, t, r, n) {
    n -= ir(t);
    var i = t.text.length,
      o = k(
        function (t) {
          return _t(e, r, t - 1).bottom <= n;
        },
        i,
        0
      );
    return (
      (i = k(
        function (t) {
          return _t(e, r, t).top > n;
        },
        o,
        i
      )),
      { begin: o, end: i }
    );
  }
  function dr(e, t, r, n) {
    r || (r = Yt(e, t));
    var i = or(e, t, _t(e, r, n), 'line').top;
    return fr(e, t, r, i);
  }
  function pr(e, t, r, n) {
    return !(e.bottom <= r) && (e.top > r || (n ? e.left : e.right) > t);
  }
  function gr(e, t, r, n, i) {
    i -= rt(t);
    var o = Yt(e, t),
      l = ir(t),
      s = 0,
      a = t.text.length,
      u = !0,
      c = N(t, e.doc.direction);
    if (c) {
      var h = (e.options.lineWrapping ? mr : vr)(e, t, r, o, c, n, i);
      (u = 1 != h.level),
        (s = u ? h.from : h.to - 1),
        (a = u ? h.to : h.from - 1);
    }
    var f,
      d,
      p = null,
      g = null,
      v = k(
        function (t) {
          var r = _t(e, o, t);
          return (
            (r.top += l),
            (r.bottom += l),
            !!pr(r, n, i, !1) &&
              (r.top <= i && r.left <= n && ((p = t), (g = r)), !0)
          );
        },
        s,
        a
      ),
      m = !1;
    if (g) {
      var y = n - g.left < g.right - n,
        b = y == u;
      (v = p + (b ? 0 : 1)),
        (d = b ? 'after' : 'before'),
        (f = y ? g.left : g.right);
    } else {
      u || (v != a && v != s) || v++,
        (d =
          0 == v
            ? 'after'
            : v == t.text.length
            ? 'before'
            : _t(e, o, v - (u ? 1 : 0)).bottom + l <= i == u
            ? 'after'
            : 'before');
      var w = ar(e, se(r, v, d), 'line', t, o);
      (f = w.left), (m = i < w.top ? -1 : i >= w.bottom ? 1 : 0);
    }
    return (v = L(t.text, v, 1)), cr(r, v, d, m, n - f);
  }
  function vr(e, t, r, n, i, o, l) {
    var s = k(
        function (s) {
          var a = i[s],
            u = 1 != a.level;
          return pr(
            ar(
              e,
              se(r, u ? a.to : a.from, u ? 'before' : 'after'),
              'line',
              t,
              n
            ),
            o,
            l,
            !0
          );
        },
        0,
        i.length - 1
      ),
      a = i[s];
    if (s > 0) {
      var u = 1 != a.level,
        c = ar(
          e,
          se(r, u ? a.from : a.to, u ? 'after' : 'before'),
          'line',
          t,
          n
        );
      pr(c, o, l, !0) && c.top > l && (a = i[s - 1]);
    }
    return a;
  }
  function mr(e, t, r, n, i, o, l) {
    var s = fr(e, t, n, l),
      a = s.begin,
      u = s.end;
    /\s/.test(t.text.charAt(u - 1)) && u--;
    for (var c = null, h = null, f = 0; f < i.length; f++) {
      var d = i[f];
      if (!(d.from >= u || d.to <= a)) {
        var p = 1 != d.level,
          g = _t(e, n, p ? Math.min(u, d.to) - 1 : Math.max(a, d.from)).right,
          v = g < o ? o - g + 1e9 : g - o;
        (!c || h > v) && ((c = d), (h = v));
      }
    }
    return (
      c || (c = i[i.length - 1]),
      c.from < a && (c = { from: a, to: c.to, level: c.level }),
      c.to > u && (c = { from: c.from, to: u, level: c.level }),
      c
    );
  }
  function yr(e) {
    if (null != e.cachedTextHeight) return e.cachedTextHeight;
    if (null == ws) {
      ws = n('pre', null, 'CodeMirror-line-like');
      for (var i = 0; i < 49; ++i)
        ws.appendChild(document.createTextNode('x')), ws.appendChild(n('br'));
      ws.appendChild(document.createTextNode('x'));
    }
    r(e.measure, ws);
    var o = ws.offsetHeight / 50;
    return o > 3 && (e.cachedTextHeight = o), t(e.measure), o || 1;
  }
  function br(e) {
    if (null != e.cachedCharWidth) return e.cachedCharWidth;
    var t = n('span', 'xxxxxxxxxx'),
      i = n('pre', [t], 'CodeMirror-line-like');
    r(e.measure, i);
    var o = t.getBoundingClientRect(),
      l = (o.right - o.left) / 10;
    return l > 2 && (e.cachedCharWidth = l), l || 10;
  }
  function wr(e) {
    for (
      var t = e.display,
        r = {},
        n = {},
        i = t.gutters.clientLeft,
        o = t.gutters.firstChild,
        l = 0;
      o;
      o = o.nextSibling, ++l
    ) {
      var s = e.display.gutterSpecs[l].className;
      (r[s] = o.offsetLeft + o.clientLeft + i), (n[s] = o.clientWidth);
    }
    return {
      fixedPos: xr(t),
      gutterTotalWidth: t.gutters.offsetWidth,
      gutterLeft: r,
      gutterWidth: n,
      wrapperWidth: t.wrapper.clientWidth,
    };
  }
  function xr(e) {
    return (
      e.scroller.getBoundingClientRect().left -
      e.sizer.getBoundingClientRect().left
    );
  }
  function Cr(e) {
    var t = yr(e.display),
      r = e.options.lineWrapping,
      n = r && Math.max(5, e.display.scroller.clientWidth / br(e.display) - 3);
    return function (i) {
      if (et(e.doc, i)) return 0;
      var o = 0;
      if (i.widgets)
        for (var l = 0; l < i.widgets.length; l++)
          i.widgets[l].height && (o += i.widgets[l].height);
      return r ? o + (Math.ceil(i.text.length / n) || 1) * t : o + t;
    };
  }
  function Sr(e) {
    var t = e.doc,
      r = Cr(e);
    t.iter(function (e) {
      var t = r(e);
      t != e.height && re(e, t);
    });
  }
  function Lr(e, t, r, n) {
    var i = e.display;
    if (!r && 'true' == B(t).getAttribute('cm-not-content')) return null;
    var o,
      l,
      s = i.lineSpace.getBoundingClientRect();
    try {
      (o = t.clientX - s.left), (l = t.clientY - s.top);
    } catch (t) {
      return null;
    }
    var a,
      u = hr(e, o, l);
    if (n && u.xRel > 0 && (a = J(e.doc, u.line).text).length == u.ch) {
      var c = h(a, a.length, e.options.tabSize) - a.length;
      u = se(
        u.line,
        Math.max(0, Math.round((o - zt(e.display).left) / br(e.display)) - c)
      );
    }
    return u;
  }
  function kr(e, t) {
    if (t >= e.display.viewTo) return null;
    if (((t -= e.display.viewFrom), t < 0)) return null;
    for (var r = e.display.view, n = 0; n < r.length; n++)
      if (((t -= r[n].size), t < 0)) return n;
  }
  function Tr(e, t, r, n) {
    null == t && (t = e.doc.first),
      null == r && (r = e.doc.first + e.doc.size),
      n || (n = 0);
    var i = e.display;
    if (
      (n &&
        r < i.viewTo &&
        (null == i.updateLineNumbers || i.updateLineNumbers > t) &&
        (i.updateLineNumbers = t),
      (e.curOp.viewChanged = !0),
      t >= i.viewTo)
    )
      ys && Qe(e.doc, t) < i.viewTo && Nr(e);
    else if (r <= i.viewFrom)
      ys && Je(e.doc, r + n) > i.viewFrom
        ? Nr(e)
        : ((i.viewFrom += n), (i.viewTo += n));
    else if (t <= i.viewFrom && r >= i.viewTo) Nr(e);
    else if (t <= i.viewFrom) {
      var o = Or(e, r, r + n, 1);
      o
        ? ((i.view = i.view.slice(o.index)),
          (i.viewFrom = o.lineN),
          (i.viewTo += n))
        : Nr(e);
    } else if (r >= i.viewTo) {
      var l = Or(e, t, t, -1);
      l ? ((i.view = i.view.slice(0, l.index)), (i.viewTo = l.lineN)) : Nr(e);
    } else {
      var s = Or(e, t, t, -1),
        a = Or(e, r, r + n, 1);
      s && a
        ? ((i.view = i.view
            .slice(0, s.index)
            .concat(vt(e, s.lineN, a.lineN))
            .concat(i.view.slice(a.index))),
          (i.viewTo += n))
        : Nr(e);
    }
    var u = i.externalMeasured;
    u &&
      (r < u.lineN
        ? (u.lineN += n)
        : t < u.lineN + u.size && (i.externalMeasured = null));
  }
  function Mr(e, t, r) {
    e.curOp.viewChanged = !0;
    var n = e.display,
      i = e.display.externalMeasured;
    if (
      (i && t >= i.lineN && t < i.lineN + i.size && (n.externalMeasured = null),
      !(t < n.viewFrom || t >= n.viewTo))
    ) {
      var o = n.view[kr(e, t)];
      if (null != o.node) {
        var l = o.changes || (o.changes = []);
        -1 == f(l, r) && l.push(r);
      }
    }
  }
  function Nr(e) {
    (e.display.viewFrom = e.display.viewTo = e.doc.first),
      (e.display.view = []),
      (e.display.viewOffset = 0);
  }
  function Or(e, t, r, n) {
    var i,
      o = kr(e, t),
      l = e.display.view;
    if (!ys || r == e.doc.first + e.doc.size) return { index: o, lineN: r };
    for (var s = e.display.viewFrom, a = 0; a < o; a++) s += l[a].size;
    if (s != t) {
      if (n > 0) {
        if (o == l.length - 1) return null;
        (i = s + l[o].size - t), o++;
      } else i = s - t;
      (t += i), (r += i);
    }
    for (; Qe(e.doc, r) != r; ) {
      if (o == (n < 0 ? 0 : l.length - 1)) return null;
      (r += n * l[o - (n < 0 ? 1 : 0)].size), (o += n);
    }
    return { index: o, lineN: r };
  }
  function Ar(e, t, r) {
    var n = e.display,
      i = n.view;
    0 == i.length || t >= n.viewTo || r <= n.viewFrom
      ? ((n.view = vt(e, t, r)), (n.viewFrom = t))
      : (n.viewFrom > t
          ? (n.view = vt(e, t, n.viewFrom).concat(n.view))
          : n.viewFrom < t && (n.view = n.view.slice(kr(e, t))),
        (n.viewFrom = t),
        n.viewTo < r
          ? (n.view = n.view.concat(vt(e, n.viewTo, r)))
          : n.viewTo > r && (n.view = n.view.slice(0, kr(e, r)))),
      (n.viewTo = r);
  }
  function Dr(e) {
    for (var t = e.display.view, r = 0, n = 0; n < t.length; n++) {
      var i = t[n];
      i.hidden || (i.node && !i.changes) || ++r;
    }
    return r;
  }
  function Wr(e) {
    e.display.input.showSelection(e.display.input.prepareSelection());
  }
  function Hr(e, t) {
    void 0 === t && (t = !0);
    for (
      var r = e.doc,
        n = {},
        i = (n.cursors = document.createDocumentFragment()),
        o = (n.selection = document.createDocumentFragment()),
        l = 0;
      l < r.sel.ranges.length;
      l++
    )
      if (t || l != r.sel.primIndex) {
        var s = r.sel.ranges[l];
        if (
          !(
            s.from().line >= e.display.viewTo ||
            s.to().line < e.display.viewFrom
          )
        ) {
          var a = s.empty();
          (a || e.options.showCursorWhenSelecting) && Fr(e, s.head, i),
            a || Er(e, s, o);
        }
      }
    return n;
  }
  function Fr(e, t, r) {
    var i = ar(e, t, 'div', null, null, !e.options.singleCursorHeightPerLine),
      o = r.appendChild(n('div', ' ', 'CodeMirror-cursor'));
    if (
      ((o.style.left = i.left + 'px'),
      (o.style.top = i.top + 'px'),
      (o.style.height =
        Math.max(0, i.bottom - i.top) * e.options.cursorHeight + 'px'),
      i.other)
    ) {
      var l = r.appendChild(
        n('div', ' ', 'CodeMirror-cursor CodeMirror-secondarycursor')
      );
      (l.style.display = ''),
        (l.style.left = i.other.left + 'px'),
        (l.style.top = i.other.top + 'px'),
        (l.style.height = 0.85 * (i.other.bottom - i.other.top) + 'px');
    }
  }
  function Pr(e, t) {
    return e.top - t.top || e.left - t.left;
  }
  function Er(e, t, r) {
    function i(e, t, r, i) {
      t < 0 && (t = 0),
        (t = Math.round(t)),
        (i = Math.round(i)),
        a.appendChild(
          n(
            'div',
            null,
            'CodeMirror-selected',
            'position: absolute; left: ' +
              e +
              'px;\n                             top: ' +
              t +
              'px; width: ' +
              (null == r ? h - e : r) +
              'px;\n                             height: ' +
              (i - t) +
              'px'
          )
        );
    }
    function o(t, r, n) {
      function o(r, n) {
        return sr(e, se(t, r), 'div', d, n);
      }
      function l(t, r, n) {
        var i = dr(e, d, null, t),
          l = ('ltr' == r) == ('after' == n) ? 'left' : 'right',
          s =
            'after' == n
              ? i.begin
              : i.end - (/\s/.test(d.text.charAt(i.end - 1)) ? 2 : 1);
        return o(s, l)[l];
      }
      var a,
        u,
        d = J(s, t),
        p = d.text.length,
        g = N(d, s.direction);
      return (
        T(g, r || 0, null == n ? p : n, function (e, t, s, d) {
          var v = 'ltr' == s,
            m = o(e, v ? 'left' : 'right'),
            y = o(t - 1, v ? 'right' : 'left'),
            b = null == r && 0 == e,
            w = null == n && t == p,
            x = 0 == d,
            C = !g || d == g.length - 1;
          if (y.top - m.top <= 3) {
            var S = (f ? b : w) && x,
              L = (f ? w : b) && C,
              k = S ? c : (v ? m : y).left,
              T = L ? h : (v ? y : m).right;
            i(k, m.top, T - k, m.bottom);
          } else {
            var M, N, O, A;
            v
              ? ((M = f && b && x ? c : m.left),
                (N = f ? h : l(e, s, 'before')),
                (O = f ? c : l(t, s, 'after')),
                (A = f && w && C ? h : y.right))
              : ((M = f ? l(e, s, 'before') : c),
                (N = !f && b && x ? h : m.right),
                (O = !f && w && C ? c : y.left),
                (A = f ? l(t, s, 'after') : h)),
              i(M, m.top, N - M, m.bottom),
              m.bottom < y.top && i(c, m.bottom, null, y.top),
              i(O, y.top, A - O, y.bottom);
          }
          (!a || Pr(m, a) < 0) && (a = m),
            Pr(y, a) < 0 && (a = y),
            (!u || Pr(m, u) < 0) && (u = m),
            Pr(y, u) < 0 && (u = y);
        }),
        { start: a, end: u }
      );
    }
    var l = e.display,
      s = e.doc,
      a = document.createDocumentFragment(),
      u = zt(e.display),
      c = u.left,
      h = Math.max(l.sizerWidth, Bt(e) - l.sizer.offsetLeft) - u.right,
      f = 'ltr' == s.direction,
      d = t.from(),
      p = t.to();
    if (d.line == p.line) o(d.line, d.ch, p.ch);
    else {
      var g = J(s, d.line),
        v = J(s, p.line),
        m = $e(g) == $e(v),
        y = o(d.line, d.ch, m ? g.text.length + 1 : null).end,
        b = o(p.line, m ? 0 : null, p.ch).start;
      m &&
        (y.top < b.top - 2
          ? (i(y.right, y.top, null, y.bottom), i(c, b.top, b.left, b.bottom))
          : i(y.right, y.top, b.left - y.right, y.bottom)),
        y.bottom < b.top && i(c, y.bottom, null, b.top);
    }
    r.appendChild(a);
  }
  function Ir(e) {
    if (e.state.focused) {
      var t = e.display;
      clearInterval(t.blinker);
      var r = !0;
      (t.cursorDiv.style.visibility = ''),
        e.options.cursorBlinkRate > 0
          ? (t.blinker = setInterval(function () {
              return (t.cursorDiv.style.visibility = (r = !r) ? '' : 'hidden');
            }, e.options.cursorBlinkRate))
          : e.options.cursorBlinkRate < 0 &&
            (t.cursorDiv.style.visibility = 'hidden');
    }
  }
  function zr(e) {
    e.state.focused || (e.display.input.focus(), Br(e));
  }
  function Rr(e) {
    (e.state.delayingBlurEvent = !0),
      setTimeout(function () {
        e.state.delayingBlurEvent && ((e.state.delayingBlurEvent = !1), Gr(e));
      }, 100);
  }
  function Br(e, t) {
    e.state.delayingBlurEvent && (e.state.delayingBlurEvent = !1),
      'nocursor' != e.options.readOnly &&
        (e.state.focused ||
          (D(e, 'focus', e, t),
          (e.state.focused = !0),
          s(e.display.wrapper, 'CodeMirror-focused'),
          e.curOp ||
            e.display.selForContextMenu == e.doc.sel ||
            (e.display.input.reset(),
            Ll &&
              setTimeout(function () {
                return e.display.input.reset(!0);
              }, 20)),
          e.display.input.receivedFocus()),
        Ir(e));
  }
  function Gr(e, t) {
    e.state.delayingBlurEvent ||
      (e.state.focused &&
        (D(e, 'blur', e, t),
        (e.state.focused = !1),
        Gl(e.display.wrapper, 'CodeMirror-focused')),
      clearInterval(e.display.blinker),
      setTimeout(function () {
        e.state.focused || (e.display.shift = !1);
      }, 150));
  }
  function Ur(e) {
    for (
      var t = e.display, r = t.lineDiv.offsetTop, n = 0;
      n < t.view.length;
      n++
    ) {
      var i = t.view[n],
        o = e.options.lineWrapping,
        l = void 0,
        s = 0;
      if (!i.hidden) {
        if (Cl && Sl < 8) {
          var a = i.node.offsetTop + i.node.offsetHeight;
          (l = a - r), (r = a);
        } else {
          var u = i.node.getBoundingClientRect();
          (l = u.bottom - u.top),
            !o &&
              i.text.firstChild &&
              (s =
                i.text.firstChild.getBoundingClientRect().right - u.left - 1);
        }
        var c = i.line.height - l;
        if ((c > 0.005 || c < -0.005) && (re(i.line, l), Vr(i.line), i.rest))
          for (var h = 0; h < i.rest.length; h++) Vr(i.rest[h]);
        if (s > e.display.sizerWidth) {
          var f = Math.ceil(s / br(e.display));
          f > e.display.maxLineLength &&
            ((e.display.maxLineLength = f),
            (e.display.maxLine = i.line),
            (e.display.maxLineChanged = !0));
        }
      }
    }
  }
  function Vr(e) {
    if (e.widgets)
      for (var t = 0; t < e.widgets.length; ++t) {
        var r = e.widgets[t],
          n = r.node.parentNode;
        n && (r.height = n.offsetHeight);
      }
  }
  function Kr(e, t, r) {
    var n = r && null != r.top ? Math.max(0, r.top) : e.scroller.scrollTop;
    n = Math.floor(n - Et(e));
    var i = r && null != r.bottom ? r.bottom : n + e.wrapper.clientHeight,
      o = ie(t, n),
      l = ie(t, i);
    if (r && r.ensure) {
      var s = r.ensure.from.line,
        a = r.ensure.to.line;
      s < o
        ? ((o = s), (l = ie(t, rt(J(t, s)) + e.wrapper.clientHeight)))
        : Math.min(a, t.lastLine()) >= l &&
          ((o = ie(t, rt(J(t, a)) - e.wrapper.clientHeight)), (l = a));
    }
    return { from: o, to: Math.max(l, o + 1) };
  }
  function jr(e, t) {
    if (!W(e, 'scrollCursorIntoView')) {
      var r = e.display,
        i = r.sizer.getBoundingClientRect(),
        o = null;
      if (
        (t.top + i.top < 0
          ? (o = !0)
          : t.bottom + i.top >
              (window.innerHeight || document.documentElement.clientHeight) &&
            (o = !1),
        null != o && !Al)
      ) {
        var l = n(
          'div',
          '​',
          null,
          'position: absolute;\n                         top: ' +
            (t.top - r.viewOffset - Et(e.display)) +
            'px;\n                         height: ' +
            (t.bottom - t.top + Rt(e) + r.barHeight) +
            'px;\n                         left: ' +
            t.left +
            'px; width: ' +
            Math.max(2, t.right - t.left) +
            'px;'
        );
        e.display.lineSpace.appendChild(l),
          l.scrollIntoView(o),
          e.display.lineSpace.removeChild(l);
      }
    }
  }
  function Xr(e, t, r, n) {
    var i;
    null == n && (n = 0),
      e.options.lineWrapping ||
        t != r ||
        ((t = t.ch
          ? se(t.line, 'before' == t.sticky ? t.ch - 1 : t.ch, 'after')
          : t),
        (r = 'before' == t.sticky ? se(t.line, t.ch + 1, 'before') : t));
    for (var o = 0; o < 5; o++) {
      var l = !1,
        s = ar(e, t),
        a = r && r != t ? ar(e, r) : s;
      i = {
        left: Math.min(s.left, a.left),
        top: Math.min(s.top, a.top) - n,
        right: Math.max(s.left, a.left),
        bottom: Math.max(s.bottom, a.bottom) + n,
      };
      var u = _r(e, i),
        c = e.doc.scrollTop,
        h = e.doc.scrollLeft;
      if (
        (null != u.scrollTop &&
          (tn(e, u.scrollTop), Math.abs(e.doc.scrollTop - c) > 1 && (l = !0)),
        null != u.scrollLeft &&
          (nn(e, u.scrollLeft), Math.abs(e.doc.scrollLeft - h) > 1 && (l = !0)),
        !l)
      )
        break;
    }
    return i;
  }
  function Yr(e, t) {
    var r = _r(e, t);
    null != r.scrollTop && tn(e, r.scrollTop),
      null != r.scrollLeft && nn(e, r.scrollLeft);
  }
  function _r(e, t) {
    var r = e.display,
      n = yr(e.display);
    t.top < 0 && (t.top = 0);
    var i =
        e.curOp && null != e.curOp.scrollTop
          ? e.curOp.scrollTop
          : r.scroller.scrollTop,
      o = Gt(e),
      l = {};
    t.bottom - t.top > o && (t.bottom = t.top + o);
    var s = e.doc.height + It(r),
      a = t.top < n,
      u = t.bottom > s - n;
    if (t.top < i) l.scrollTop = a ? 0 : t.top;
    else if (t.bottom > i + o) {
      var c = Math.min(t.top, (u ? s : t.bottom) - o);
      c != i && (l.scrollTop = c);
    }
    var h =
        e.curOp && null != e.curOp.scrollLeft
          ? e.curOp.scrollLeft
          : r.scroller.scrollLeft,
      f = Bt(e) - (e.options.fixedGutter ? r.gutters.offsetWidth : 0),
      d = t.right - t.left > f;
    return (
      d && (t.right = t.left + f),
      t.left < 10
        ? (l.scrollLeft = 0)
        : t.left < h
        ? (l.scrollLeft = Math.max(0, t.left - (d ? 0 : 10)))
        : t.right > f + h - 3 && (l.scrollLeft = t.right + (d ? 0 : 10) - f),
      l
    );
  }
  function $r(e, t) {
    null != t &&
      (Jr(e),
      (e.curOp.scrollTop =
        (null == e.curOp.scrollTop ? e.doc.scrollTop : e.curOp.scrollTop) + t));
  }
  function qr(e) {
    Jr(e);
    var t = e.getCursor();
    e.curOp.scrollToPos = {
      from: t,
      to: t,
      margin: e.options.cursorScrollMargin,
    };
  }
  function Zr(e, t, r) {
    (null == t && null == r) || Jr(e),
      null != t && (e.curOp.scrollLeft = t),
      null != r && (e.curOp.scrollTop = r);
  }
  function Qr(e, t) {
    Jr(e), (e.curOp.scrollToPos = t);
  }
  function Jr(e) {
    var t = e.curOp.scrollToPos;
    if (t) {
      e.curOp.scrollToPos = null;
      var r = ur(e, t.from),
        n = ur(e, t.to);
      en(e, r, n, t.margin);
    }
  }
  function en(e, t, r, n) {
    var i = _r(e, {
      left: Math.min(t.left, r.left),
      top: Math.min(t.top, r.top) - n,
      right: Math.max(t.right, r.right),
      bottom: Math.max(t.bottom, r.bottom) + n,
    });
    Zr(e, i.scrollLeft, i.scrollTop);
  }
  function tn(e, t) {
    Math.abs(e.doc.scrollTop - t) < 2 ||
      (yl || Nn(e, { top: t }), rn(e, t, !0), yl && Nn(e), xn(e, 100));
  }
  function rn(e, t, r) {
    (t = Math.max(
      0,
      Math.min(
        e.display.scroller.scrollHeight - e.display.scroller.clientHeight,
        t
      )
    )),
      (e.display.scroller.scrollTop != t || r) &&
        ((e.doc.scrollTop = t),
        e.display.scrollbars.setScrollTop(t),
        e.display.scroller.scrollTop != t &&
          (e.display.scroller.scrollTop = t));
  }
  function nn(e, t, r, n) {
    (t = Math.max(
      0,
      Math.min(
        t,
        e.display.scroller.scrollWidth - e.display.scroller.clientWidth
      )
    )),
      ((r ? t == e.doc.scrollLeft : Math.abs(e.doc.scrollLeft - t) < 2) &&
        !n) ||
        ((e.doc.scrollLeft = t),
        Wn(e),
        e.display.scroller.scrollLeft != t &&
          (e.display.scroller.scrollLeft = t),
        e.display.scrollbars.setScrollLeft(t));
  }
  function on(e) {
    var t = e.display,
      r = t.gutters.offsetWidth,
      n = Math.round(e.doc.height + It(e.display));
    return {
      clientHeight: t.scroller.clientHeight,
      viewHeight: t.wrapper.clientHeight,
      scrollWidth: t.scroller.scrollWidth,
      clientWidth: t.scroller.clientWidth,
      viewWidth: t.wrapper.clientWidth,
      barLeft: e.options.fixedGutter ? r : 0,
      docHeight: n,
      scrollHeight: n + Rt(e) + t.barHeight,
      nativeBarWidth: t.nativeBarWidth,
      gutterWidth: r,
    };
  }
  function ln(e, t) {
    t || (t = on(e));
    var r = e.display.barWidth,
      n = e.display.barHeight;
    sn(e, t);
    for (
      var i = 0;
      (i < 4 && r != e.display.barWidth) || n != e.display.barHeight;
      i++
    )
      r != e.display.barWidth && e.options.lineWrapping && Ur(e),
        sn(e, on(e)),
        (r = e.display.barWidth),
        (n = e.display.barHeight);
  }
  function sn(e, t) {
    var r = e.display,
      n = r.scrollbars.update(t);
    (r.sizer.style.paddingRight = (r.barWidth = n.right) + 'px'),
      (r.sizer.style.paddingBottom = (r.barHeight = n.bottom) + 'px'),
      (r.heightForcer.style.borderBottom = n.bottom + 'px solid transparent'),
      n.right && n.bottom
        ? ((r.scrollbarFiller.style.display = 'block'),
          (r.scrollbarFiller.style.height = n.bottom + 'px'),
          (r.scrollbarFiller.style.width = n.right + 'px'))
        : (r.scrollbarFiller.style.display = ''),
      n.bottom && e.options.coverGutterNextToScrollbar && e.options.fixedGutter
        ? ((r.gutterFiller.style.display = 'block'),
          (r.gutterFiller.style.height = n.bottom + 'px'),
          (r.gutterFiller.style.width = t.gutterWidth + 'px'))
        : (r.gutterFiller.style.display = '');
  }
  function an(e) {
    e.display.scrollbars &&
      (e.display.scrollbars.clear(),
      e.display.scrollbars.addClass &&
        Gl(e.display.wrapper, e.display.scrollbars.addClass)),
      (e.display.scrollbars = new Ns[e.options.scrollbarStyle](
        function (t) {
          e.display.wrapper.insertBefore(t, e.display.scrollbarFiller),
            is(t, 'mousedown', function () {
              e.state.focused &&
                setTimeout(function () {
                  return e.display.input.focus();
                }, 0);
            }),
            t.setAttribute('cm-not-content', 'true');
        },
        function (t, r) {
          'horizontal' == r ? nn(e, t) : tn(e, t);
        },
        e
      )),
      e.display.scrollbars.addClass &&
        s(e.display.wrapper, e.display.scrollbars.addClass);
  }
  function un(e) {
    (e.curOp = {
      cm: e,
      viewChanged: !1,
      startHeight: e.doc.height,
      forceUpdate: !1,
      updateInput: 0,
      typing: !1,
      changeObjs: null,
      cursorActivityHandlers: null,
      cursorActivityCalled: 0,
      selectionChanged: !1,
      updateMaxLine: !1,
      scrollLeft: null,
      scrollTop: null,
      scrollToPos: null,
      focus: !1,
      id: ++Os,
    }),
      mt(e.curOp);
  }
  function cn(e) {
    var t = e.curOp;
    t &&
      bt(t, function (e) {
        for (var t = 0; t < e.ops.length; t++) e.ops[t].cm.curOp = null;
        hn(e);
      });
  }
  function hn(e) {
    for (var t = e.ops, r = 0; r < t.length; r++) fn(t[r]);
    for (var n = 0; n < t.length; n++) dn(t[n]);
    for (var i = 0; i < t.length; i++) pn(t[i]);
    for (var o = 0; o < t.length; o++) gn(t[o]);
    for (var l = 0; l < t.length; l++) vn(t[l]);
  }
  function fn(e) {
    var t = e.cm,
      r = t.display;
    Sn(t),
      e.updateMaxLine && it(t),
      (e.mustUpdate =
        e.viewChanged ||
        e.forceUpdate ||
        null != e.scrollTop ||
        (e.scrollToPos &&
          (e.scrollToPos.from.line < r.viewFrom ||
            e.scrollToPos.to.line >= r.viewTo)) ||
        (r.maxLineChanged && t.options.lineWrapping)),
      (e.update =
        e.mustUpdate &&
        new As(
          t,
          e.mustUpdate && { top: e.scrollTop, ensure: e.scrollToPos },
          e.forceUpdate
        ));
  }
  function dn(e) {
    e.updatedDisplay = e.mustUpdate && Tn(e.cm, e.update);
  }
  function pn(e) {
    var t = e.cm,
      r = t.display;
    e.updatedDisplay && Ur(t),
      (e.barMeasure = on(t)),
      r.maxLineChanged &&
        !t.options.lineWrapping &&
        ((e.adjustWidthTo = jt(t, r.maxLine, r.maxLine.text.length).left + 3),
        (t.display.sizerWidth = e.adjustWidthTo),
        (e.barMeasure.scrollWidth = Math.max(
          r.scroller.clientWidth,
          r.sizer.offsetLeft + e.adjustWidthTo + Rt(t) + t.display.barWidth
        )),
        (e.maxScrollLeft = Math.max(
          0,
          r.sizer.offsetLeft + e.adjustWidthTo - Bt(t)
        ))),
      (e.updatedDisplay || e.selectionChanged) &&
        (e.preparedSelection = r.input.prepareSelection());
  }
  function gn(e) {
    var t = e.cm;
    null != e.adjustWidthTo &&
      ((t.display.sizer.style.minWidth = e.adjustWidthTo + 'px'),
      e.maxScrollLeft < t.doc.scrollLeft &&
        nn(t, Math.min(t.display.scroller.scrollLeft, e.maxScrollLeft), !0),
      (t.display.maxLineChanged = !1));
    var r = e.focus && e.focus == l();
    e.preparedSelection &&
      t.display.input.showSelection(e.preparedSelection, r),
      (e.updatedDisplay || e.startHeight != t.doc.height) &&
        ln(t, e.barMeasure),
      e.updatedDisplay && Dn(t, e.barMeasure),
      e.selectionChanged && Ir(t),
      t.state.focused && e.updateInput && t.display.input.reset(e.typing),
      r && zr(e.cm);
  }
  function vn(e) {
    var t = e.cm,
      r = t.display,
      n = t.doc;
    if (
      (e.updatedDisplay && Mn(t, e.update),
      null == r.wheelStartX ||
        (null == e.scrollTop && null == e.scrollLeft && !e.scrollToPos) ||
        (r.wheelStartX = r.wheelStartY = null),
      null != e.scrollTop && rn(t, e.scrollTop, e.forceScroll),
      null != e.scrollLeft && nn(t, e.scrollLeft, !0, !0),
      e.scrollToPos)
    ) {
      var i = Xr(
        t,
        pe(n, e.scrollToPos.from),
        pe(n, e.scrollToPos.to),
        e.scrollToPos.margin
      );
      jr(t, i);
    }
    var o = e.maybeHiddenMarkers,
      l = e.maybeUnhiddenMarkers;
    if (o)
      for (var s = 0; s < o.length; ++s) o[s].lines.length || D(o[s], 'hide');
    if (l)
      for (var a = 0; a < l.length; ++a) l[a].lines.length && D(l[a], 'unhide');
    r.wrapper.offsetHeight && (n.scrollTop = t.display.scroller.scrollTop),
      e.changeObjs && D(t, 'changes', t, e.changeObjs),
      e.update && e.update.finish();
  }
  function mn(e, t) {
    if (e.curOp) return t();
    un(e);
    try {
      return t();
    } finally {
      cn(e);
    }
  }
  function yn(e, t) {
    return function () {
      if (e.curOp) return t.apply(e, arguments);
      un(e);
      try {
        return t.apply(e, arguments);
      } finally {
        cn(e);
      }
    };
  }
  function bn(e) {
    return function () {
      if (this.curOp) return e.apply(this, arguments);
      un(this);
      try {
        return e.apply(this, arguments);
      } finally {
        cn(this);
      }
    };
  }
  function wn(e) {
    return function () {
      var t = this.cm;
      if (!t || t.curOp) return e.apply(this, arguments);
      un(t);
      try {
        return e.apply(this, arguments);
      } finally {
        cn(t);
      }
    };
  }
  function xn(e, t) {
    e.doc.highlightFrontier < e.display.viewTo &&
      e.state.highlight.set(t, u(Cn, e));
  }
  function Cn(e) {
    var t = e.doc;
    if (!(t.highlightFrontier >= e.display.viewTo)) {
      var r = +new Date() + e.options.workTime,
        n = be(e, t.highlightFrontier),
        i = [];
      t.iter(
        n.line,
        Math.min(t.first + t.size, e.display.viewTo + 500),
        function (o) {
          if (n.line >= e.display.viewFrom) {
            var l = o.styles,
              s =
                o.text.length > e.options.maxHighlightLength
                  ? q(t.mode, n.state)
                  : null,
              a = me(e, o, n, !0);
            s && (n.state = s), (o.styles = a.styles);
            var u = o.styleClasses,
              c = a.classes;
            c ? (o.styleClasses = c) : u && (o.styleClasses = null);
            for (
              var h =
                  !l ||
                  l.length != o.styles.length ||
                  (u != c &&
                    (!u ||
                      !c ||
                      u.bgClass != c.bgClass ||
                      u.textClass != c.textClass)),
                f = 0;
              !h && f < l.length;
              ++f
            )
              h = l[f] != o.styles[f];
            h && i.push(n.line), (o.stateAfter = n.save()), n.nextLine();
          } else
            o.text.length <= e.options.maxHighlightLength && we(e, o.text, n),
              (o.stateAfter = n.line % 5 == 0 ? n.save() : null),
              n.nextLine();
          if (+new Date() > r) return xn(e, e.options.workDelay), !0;
        }
      ),
        (t.highlightFrontier = n.line),
        (t.modeFrontier = Math.max(t.modeFrontier, n.line)),
        i.length &&
          mn(e, function () {
            for (var t = 0; t < i.length; t++) Mr(e, i[t], 'text');
          });
    }
  }
  function Sn(e) {
    var t = e.display;
    !t.scrollbarsClipped &&
      t.scroller.offsetWidth &&
      ((t.nativeBarWidth = t.scroller.offsetWidth - t.scroller.clientWidth),
      (t.heightForcer.style.height = Rt(e) + 'px'),
      (t.sizer.style.marginBottom = -t.nativeBarWidth + 'px'),
      (t.sizer.style.borderRightWidth = Rt(e) + 'px'),
      (t.scrollbarsClipped = !0));
  }
  function Ln(e) {
    if (e.hasFocus()) return null;
    var t = l();
    if (!t || !o(e.display.lineDiv, t)) return null;
    var r = { activeElt: t };
    if (window.getSelection) {
      var n = window.getSelection();
      n.anchorNode &&
        n.extend &&
        o(e.display.lineDiv, n.anchorNode) &&
        ((r.anchorNode = n.anchorNode),
        (r.anchorOffset = n.anchorOffset),
        (r.focusNode = n.focusNode),
        (r.focusOffset = n.focusOffset));
    }
    return r;
  }
  function kn(e) {
    if (
      e &&
      e.activeElt &&
      e.activeElt != l() &&
      (e.activeElt.focus(),
      e.anchorNode &&
        o(document.body, e.anchorNode) &&
        o(document.body, e.focusNode))
    ) {
      var t = window.getSelection(),
        r = document.createRange();
      r.setEnd(e.anchorNode, e.anchorOffset),
        r.collapse(!1),
        t.removeAllRanges(),
        t.addRange(r),
        t.extend(e.focusNode, e.focusOffset);
    }
  }
  function Tn(e, r) {
    var n = e.display,
      i = e.doc;
    if (r.editorIsHidden) return Nr(e), !1;
    if (
      !r.force &&
      r.visible.from >= n.viewFrom &&
      r.visible.to <= n.viewTo &&
      (null == n.updateLineNumbers || n.updateLineNumbers >= n.viewTo) &&
      n.renderedView == n.view &&
      0 == Dr(e)
    )
      return !1;
    Hn(e) && (Nr(e), (r.dims = wr(e)));
    var o = i.first + i.size,
      l = Math.max(r.visible.from - e.options.viewportMargin, i.first),
      s = Math.min(o, r.visible.to + e.options.viewportMargin);
    n.viewFrom < l &&
      l - n.viewFrom < 20 &&
      (l = Math.max(i.first, n.viewFrom)),
      n.viewTo > s && n.viewTo - s < 20 && (s = Math.min(o, n.viewTo)),
      ys && ((l = Qe(e.doc, l)), (s = Je(e.doc, s)));
    var a =
      l != n.viewFrom ||
      s != n.viewTo ||
      n.lastWrapHeight != r.wrapperHeight ||
      n.lastWrapWidth != r.wrapperWidth;
    Ar(e, l, s),
      (n.viewOffset = rt(J(e.doc, n.viewFrom))),
      (e.display.mover.style.top = n.viewOffset + 'px');
    var u = Dr(e);
    if (
      !a &&
      0 == u &&
      !r.force &&
      n.renderedView == n.view &&
      (null == n.updateLineNumbers || n.updateLineNumbers >= n.viewTo)
    )
      return !1;
    var c = Ln(e);
    return (
      u > 4 && (n.lineDiv.style.display = 'none'),
      On(e, n.updateLineNumbers, r.dims),
      u > 4 && (n.lineDiv.style.display = ''),
      (n.renderedView = n.view),
      kn(c),
      t(n.cursorDiv),
      t(n.selectionDiv),
      (n.gutters.style.height = n.sizer.style.minHeight = 0),
      a &&
        ((n.lastWrapHeight = r.wrapperHeight),
        (n.lastWrapWidth = r.wrapperWidth),
        xn(e, 400)),
      (n.updateLineNumbers = null),
      !0
    );
  }
  function Mn(e, t) {
    for (var r = t.viewport, n = !0; ; n = !1) {
      if (n && e.options.lineWrapping && t.oldDisplayWidth != Bt(e))
        n && (t.visible = Kr(e.display, e.doc, r));
      else if (
        (r &&
          null != r.top &&
          (r = { top: Math.min(e.doc.height + It(e.display) - Gt(e), r.top) }),
        (t.visible = Kr(e.display, e.doc, r)),
        t.visible.from >= e.display.viewFrom &&
          t.visible.to <= e.display.viewTo)
      )
        break;
      if (!Tn(e, t)) break;
      Ur(e);
      var i = on(e);
      Wr(e), ln(e, i), Dn(e, i), (t.force = !1);
    }
    t.signal(e, 'update', e),
      (e.display.viewFrom == e.display.reportedViewFrom &&
        e.display.viewTo == e.display.reportedViewTo) ||
        (t.signal(e, 'viewportChange', e, e.display.viewFrom, e.display.viewTo),
        (e.display.reportedViewFrom = e.display.viewFrom),
        (e.display.reportedViewTo = e.display.viewTo));
  }
  function Nn(e, t) {
    var r = new As(e, t);
    if (Tn(e, r)) {
      Ur(e), Mn(e, r);
      var n = on(e);
      Wr(e), ln(e, n), Dn(e, n), r.finish();
    }
  }
  function On(e, r, n) {
    function i(t) {
      var r = t.nextSibling;
      return (
        Ll && Fl && e.display.currentWheelTarget == t
          ? (t.style.display = 'none')
          : t.parentNode.removeChild(t),
        r
      );
    }
    for (
      var o = e.display,
        l = e.options.lineNumbers,
        s = o.lineDiv,
        a = s.firstChild,
        u = o.view,
        c = o.viewFrom,
        h = 0;
      h < u.length;
      h++
    ) {
      var d = u[h];
      if (d.hidden);
      else if (d.node && d.node.parentNode == s) {
        for (; a != d.node; ) a = i(a);
        var p = l && null != r && r <= c && d.lineNumber;
        d.changes && (f(d.changes, 'gutter') > -1 && (p = !1), Ct(e, d, c, n)),
          p &&
            (t(d.lineNumber),
            d.lineNumber.appendChild(
              document.createTextNode(le(e.options, c))
            )),
          (a = d.node.nextSibling);
      } else {
        var g = At(e, d, c, n);
        s.insertBefore(g, a);
      }
      c += d.size;
    }
    for (; a; ) a = i(a);
  }
  function An(e) {
    var t = e.gutters.offsetWidth;
    e.sizer.style.marginLeft = t + 'px';
  }
  function Dn(e, t) {
    (e.display.sizer.style.minHeight = t.docHeight + 'px'),
      (e.display.heightForcer.style.top = t.docHeight + 'px'),
      (e.display.gutters.style.height =
        t.docHeight + e.display.barHeight + Rt(e) + 'px');
  }
  function Wn(e) {
    var t = e.display,
      r = t.view;
    if (t.alignWidgets || (t.gutters.firstChild && e.options.fixedGutter)) {
      for (
        var n = xr(t) - t.scroller.scrollLeft + e.doc.scrollLeft,
          i = t.gutters.offsetWidth,
          o = n + 'px',
          l = 0;
        l < r.length;
        l++
      )
        if (!r[l].hidden) {
          e.options.fixedGutter &&
            (r[l].gutter && (r[l].gutter.style.left = o),
            r[l].gutterBackground && (r[l].gutterBackground.style.left = o));
          var s = r[l].alignable;
          if (s) for (var a = 0; a < s.length; a++) s[a].style.left = o;
        }
      e.options.fixedGutter && (t.gutters.style.left = n + i + 'px');
    }
  }
  function Hn(e) {
    if (!e.options.lineNumbers) return !1;
    var t = e.doc,
      r = le(e.options, t.first + t.size - 1),
      i = e.display;
    if (r.length != i.lineNumChars) {
      var o = i.measure.appendChild(
          n('div', [n('div', r)], 'CodeMirror-linenumber CodeMirror-gutter-elt')
        ),
        l = o.firstChild.offsetWidth,
        s = o.offsetWidth - l;
      return (
        (i.lineGutter.style.width = ''),
        (i.lineNumInnerWidth = Math.max(l, i.lineGutter.offsetWidth - s) + 1),
        (i.lineNumWidth = i.lineNumInnerWidth + s),
        (i.lineNumChars = i.lineNumInnerWidth ? r.length : -1),
        (i.lineGutter.style.width = i.lineNumWidth + 'px'),
        An(e.display),
        !0
      );
    }
    return !1;
  }
  function Fn(e, t) {
    for (var r = [], n = !1, i = 0; i < e.length; i++) {
      var o = e[i],
        l = null;
      if (
        ('string' != typeof o && ((l = o.style), (o = o.className)),
        'CodeMirror-linenumbers' == o)
      ) {
        if (!t) continue;
        n = !0;
      }
      r.push({ className: o, style: l });
    }
    return (
      t && !n && r.push({ className: 'CodeMirror-linenumbers', style: null }), r
    );
  }
  function Pn(e) {
    var r = e.gutters,
      i = e.gutterSpecs;
    t(r), (e.lineGutter = null);
    for (var o = 0; o < i.length; ++o) {
      var l = i[o],
        s = l.className,
        a = l.style,
        u = r.appendChild(n('div', null, 'CodeMirror-gutter ' + s));
      a && (u.style.cssText = a),
        'CodeMirror-linenumbers' == s &&
          ((e.lineGutter = u), (u.style.width = (e.lineNumWidth || 1) + 'px'));
    }
    (r.style.display = i.length ? '' : 'none'), An(e);
  }
  function En(e) {
    Pn(e.display), Tr(e), Wn(e);
  }
  function In(e, t, r, o) {
    var l = this;
    (this.input = r),
      (l.scrollbarFiller = n('div', null, 'CodeMirror-scrollbar-filler')),
      l.scrollbarFiller.setAttribute('cm-not-content', 'true'),
      (l.gutterFiller = n('div', null, 'CodeMirror-gutter-filler')),
      l.gutterFiller.setAttribute('cm-not-content', 'true'),
      (l.lineDiv = i('div', null, 'CodeMirror-code')),
      (l.selectionDiv = n('div', null, null, 'position: relative; z-index: 1')),
      (l.cursorDiv = n('div', null, 'CodeMirror-cursors')),
      (l.measure = n('div', null, 'CodeMirror-measure')),
      (l.lineMeasure = n('div', null, 'CodeMirror-measure')),
      (l.lineSpace = i(
        'div',
        [l.measure, l.lineMeasure, l.selectionDiv, l.cursorDiv, l.lineDiv],
        null,
        'position: relative; outline: none'
      ));
    var s = i('div', [l.lineSpace], 'CodeMirror-lines');
    (l.mover = n('div', [s], null, 'position: relative')),
      (l.sizer = n('div', [l.mover], 'CodeMirror-sizer')),
      (l.sizerWidth = null),
      (l.heightForcer = n(
        'div',
        null,
        null,
        'position: absolute; height: ' + Yl + 'px; width: 1px;'
      )),
      (l.gutters = n('div', null, 'CodeMirror-gutters')),
      (l.lineGutter = null),
      (l.scroller = n(
        'div',
        [l.sizer, l.heightForcer, l.gutters],
        'CodeMirror-scroll'
      )),
      l.scroller.setAttribute('tabIndex', '-1'),
      (l.wrapper = n(
        'div',
        [l.scrollbarFiller, l.gutterFiller, l.scroller],
        'CodeMirror'
      )),
      Cl &&
        Sl < 8 &&
        ((l.gutters.style.zIndex = -1), (l.scroller.style.paddingRight = 0)),
      Ll || (yl && Hl) || (l.scroller.draggable = !0),
      e && (e.appendChild ? e.appendChild(l.wrapper) : e(l.wrapper)),
      (l.viewFrom = l.viewTo = t.first),
      (l.reportedViewFrom = l.reportedViewTo = t.first),
      (l.view = []),
      (l.renderedView = null),
      (l.externalMeasured = null),
      (l.viewOffset = 0),
      (l.lastWrapHeight = l.lastWrapWidth = 0),
      (l.updateLineNumbers = null),
      (l.nativeBarWidth = l.barHeight = l.barWidth = 0),
      (l.scrollbarsClipped = !1),
      (l.lineNumWidth = l.lineNumInnerWidth = l.lineNumChars = null),
      (l.alignWidgets = !1),
      (l.cachedCharWidth = l.cachedTextHeight = l.cachedPaddingH = null),
      (l.maxLine = null),
      (l.maxLineLength = 0),
      (l.maxLineChanged = !1),
      (l.wheelDX = l.wheelDY = l.wheelStartX = l.wheelStartY = null),
      (l.shift = !1),
      (l.selForContextMenu = null),
      (l.activeTouch = null),
      (l.gutterSpecs = Fn(o.gutters, o.lineNumbers)),
      Pn(l),
      r.init(l);
  }
  function zn(e) {
    var t = e.wheelDeltaX,
      r = e.wheelDeltaY;
    return (
      null == t && e.detail && e.axis == e.HORIZONTAL_AXIS && (t = e.detail),
      null == r && e.detail && e.axis == e.VERTICAL_AXIS
        ? (r = e.detail)
        : null == r && (r = e.wheelDelta),
      { x: t, y: r }
    );
  }
  function Rn(e) {
    var t = zn(e);
    return (t.x *= Ws), (t.y *= Ws), t;
  }
  function Bn(e, t) {
    var r = zn(t),
      n = r.x,
      i = r.y,
      o = e.display,
      l = o.scroller,
      s = l.scrollWidth > l.clientWidth,
      a = l.scrollHeight > l.clientHeight;
    if ((n && s) || (i && a)) {
      if (i && Fl && Ll)
        e: for (var u = t.target, c = o.view; u != l; u = u.parentNode)
          for (var h = 0; h < c.length; h++)
            if (c[h].node == u) {
              e.display.currentWheelTarget = u;
              break e;
            }
      if (n && !yl && !Ml && null != Ws)
        return (
          i && a && tn(e, Math.max(0, l.scrollTop + i * Ws)),
          nn(e, Math.max(0, l.scrollLeft + n * Ws)),
          (!i || (i && a)) && E(t),
          void (o.wheelStartX = null)
        );
      if (i && null != Ws) {
        var f = i * Ws,
          d = e.doc.scrollTop,
          p = d + o.wrapper.clientHeight;
        f < 0
          ? (d = Math.max(0, d + f - 50))
          : (p = Math.min(e.doc.height, p + f + 50)),
          Nn(e, { top: d, bottom: p });
      }
      Ds < 20 &&
        (null == o.wheelStartX
          ? ((o.wheelStartX = l.scrollLeft),
            (o.wheelStartY = l.scrollTop),
            (o.wheelDX = n),
            (o.wheelDY = i),
            setTimeout(function () {
              if (null != o.wheelStartX) {
                var e = l.scrollLeft - o.wheelStartX,
                  t = l.scrollTop - o.wheelStartY,
                  r =
                    (t && o.wheelDY && t / o.wheelDY) ||
                    (e && o.wheelDX && e / o.wheelDX);
                (o.wheelStartX = o.wheelStartY = null),
                  r && ((Ws = (Ws * Ds + r) / (Ds + 1)), ++Ds);
              }
            }, 200))
          : ((o.wheelDX += n), (o.wheelDY += i)));
    }
  }
  function Gn(e, t, r) {
    var n = e && e.options.selectionsMayTouch,
      i = t[r];
    t.sort(function (e, t) {
      return ae(e.from(), t.from());
    }),
      (r = f(t, i));
    for (var o = 1; o < t.length; o++) {
      var l = t[o],
        s = t[o - 1],
        a = ae(s.to(), l.from());
      if (n && !l.empty() ? a > 0 : a >= 0) {
        var u = fe(s.from(), l.from()),
          c = he(s.to(), l.to()),
          h = s.empty() ? l.from() == l.head : s.from() == s.head;
        o <= r && --r, t.splice(--o, 2, new Fs(h ? c : u, h ? u : c));
      }
    }
    return new Hs(t, r);
  }
  function Un(e, t) {
    return new Hs([new Fs(e, t || e)], 0);
  }
  function Vn(e) {
    return e.text
      ? se(
          e.from.line + e.text.length - 1,
          g(e.text).length + (1 == e.text.length ? e.from.ch : 0)
        )
      : e.to;
  }
  function Kn(e, t) {
    if (ae(e, t.from) < 0) return e;
    if (ae(e, t.to) <= 0) return Vn(t);
    var r = e.line + t.text.length - (t.to.line - t.from.line) - 1,
      n = e.ch;
    return e.line == t.to.line && (n += Vn(t).ch - t.to.ch), se(r, n);
  }
  function jn(e, t) {
    for (var r = [], n = 0; n < e.sel.ranges.length; n++) {
      var i = e.sel.ranges[n];
      r.push(new Fs(Kn(i.anchor, t), Kn(i.head, t)));
    }
    return Gn(e.cm, r, e.sel.primIndex);
  }
  function Xn(e, t, r) {
    return e.line == t.line
      ? se(r.line, e.ch - t.ch + r.ch)
      : se(r.line + (e.line - t.line), e.ch);
  }
  function Yn(e, t, r) {
    for (var n = [], i = se(e.first, 0), o = i, l = 0; l < t.length; l++) {
      var s = t[l],
        a = Xn(s.from, i, o),
        u = Xn(Vn(s), i, o);
      if (((i = s.to), (o = u), 'around' == r)) {
        var c = e.sel.ranges[l],
          h = ae(c.head, c.anchor) < 0;
        n[l] = new Fs(h ? u : a, h ? a : u);
      } else n[l] = new Fs(a, a);
    }
    return new Hs(n, e.sel.primIndex);
  }
  function _n(e) {
    (e.doc.mode = _(e.options, e.doc.modeOption)), $n(e);
  }
  function $n(e) {
    e.doc.iter(function (e) {
      e.stateAfter && (e.stateAfter = null), e.styles && (e.styles = null);
    }),
      (e.doc.modeFrontier = e.doc.highlightFrontier = e.doc.first),
      xn(e, 100),
      e.state.modeGen++,
      e.curOp && Tr(e);
  }
  function qn(e, t) {
    return (
      0 == t.from.ch &&
      0 == t.to.ch &&
      '' == g(t.text) &&
      (!e.cm || e.cm.options.wholeLineUpdateBefore)
    );
  }
  function Zn(e, t, r, n) {
    function i(e) {
      return r ? r[e] : null;
    }
    function o(e, r, i) {
      ot(e, r, i, n), wt(e, 'change', e, t);
    }
    function l(e, t) {
      for (var r = [], o = e; o < t; ++o) r.push(new bs(u[o], i(o), n));
      return r;
    }
    var s = t.from,
      a = t.to,
      u = t.text,
      c = J(e, s.line),
      h = J(e, a.line),
      f = g(u),
      d = i(u.length - 1),
      p = a.line - s.line;
    if (t.full)
      e.insert(0, l(0, u.length)), e.remove(u.length, e.size - u.length);
    else if (qn(e, t)) {
      var v = l(0, u.length - 1);
      o(h, h.text, d),
        p && e.remove(s.line, p),
        v.length && e.insert(s.line, v);
    } else if (c == h)
      if (1 == u.length)
        o(c, c.text.slice(0, s.ch) + f + c.text.slice(a.ch), d);
      else {
        var m = l(1, u.length - 1);
        m.push(new bs(f + c.text.slice(a.ch), d, n)),
          o(c, c.text.slice(0, s.ch) + u[0], i(0)),
          e.insert(s.line + 1, m);
      }
    else if (1 == u.length)
      o(c, c.text.slice(0, s.ch) + u[0] + h.text.slice(a.ch), i(0)),
        e.remove(s.line + 1, p);
    else {
      o(c, c.text.slice(0, s.ch) + u[0], i(0)), o(h, f + h.text.slice(a.ch), d);
      var y = l(1, u.length - 1);
      p > 1 && e.remove(s.line + 1, p - 1), e.insert(s.line + 1, y);
    }
    wt(e, 'change', e, t);
  }
  function Qn(e, t, r) {
    function n(e, i, o) {
      if (e.linked)
        for (var l = 0; l < e.linked.length; ++l) {
          var s = e.linked[l];
          if (s.doc != i) {
            var a = o && s.sharedHist;
            (r && !a) || (t(s.doc, a), n(s.doc, e, a));
          }
        }
    }
    n(e, null, !0);
  }
  function Jn(e, t) {
    if (t.cm) throw new Error('This document is already in use.');
    (e.doc = t),
      (t.cm = e),
      Sr(e),
      _n(e),
      ei(e),
      e.options.lineWrapping || it(e),
      (e.options.mode = t.modeOption),
      Tr(e);
  }
  function ei(e) {
    ('rtl' == e.doc.direction ? s : Gl)(e.display.lineDiv, 'CodeMirror-rtl');
  }
  function ti(e) {
    mn(e, function () {
      ei(e), Tr(e);
    });
  }
  function ri(e) {
    (this.done = []),
      (this.undone = []),
      (this.undoDepth = 1 / 0),
      (this.lastModTime = this.lastSelTime = 0),
      (this.lastOp = this.lastSelOp = null),
      (this.lastOrigin = this.lastSelOrigin = null),
      (this.generation = this.maxGeneration = e || 1);
  }
  function ni(e, t) {
    var r = { from: ce(t.from), to: Vn(t), text: ee(e, t.from, t.to) };
    return (
      ci(e, r, t.from.line, t.to.line + 1),
      Qn(
        e,
        function (e) {
          return ci(e, r, t.from.line, t.to.line + 1);
        },
        !0
      ),
      r
    );
  }
  function ii(e) {
    for (; e.length; ) {
      var t = g(e);
      if (!t.ranges) break;
      e.pop();
    }
  }
  function oi(e, t) {
    return t
      ? (ii(e.done), g(e.done))
      : e.done.length && !g(e.done).ranges
      ? g(e.done)
      : e.done.length > 1 && !e.done[e.done.length - 2].ranges
      ? (e.done.pop(), g(e.done))
      : void 0;
  }
  function li(e, t, r, n) {
    var i = e.history;
    i.undone.length = 0;
    var o,
      l,
      s = +new Date();
    if (
      (i.lastOp == n ||
        (i.lastOrigin == t.origin &&
          t.origin &&
          (('+' == t.origin.charAt(0) &&
            i.lastModTime >
              s - (e.cm ? e.cm.options.historyEventDelay : 500)) ||
            '*' == t.origin.charAt(0)))) &&
      (o = oi(i, i.lastOp == n))
    )
      (l = g(o.changes)),
        0 == ae(t.from, t.to) && 0 == ae(t.from, l.to)
          ? (l.to = Vn(t))
          : o.changes.push(ni(e, t));
    else {
      var a = g(i.done);
      for (
        (a && a.ranges) || ui(e.sel, i.done),
          o = { changes: [ni(e, t)], generation: i.generation },
          i.done.push(o);
        i.done.length > i.undoDepth;

      )
        i.done.shift(), i.done[0].ranges || i.done.shift();
    }
    i.done.push(r),
      (i.generation = ++i.maxGeneration),
      (i.lastModTime = i.lastSelTime = s),
      (i.lastOp = i.lastSelOp = n),
      (i.lastOrigin = i.lastSelOrigin = t.origin),
      l || D(e, 'historyAdded');
  }
  function si(e, t, r, n) {
    var i = t.charAt(0);
    return (
      '*' == i ||
      ('+' == i &&
        r.ranges.length == n.ranges.length &&
        r.somethingSelected() == n.somethingSelected() &&
        new Date() - e.history.lastSelTime <=
          (e.cm ? e.cm.options.historyEventDelay : 500))
    );
  }
  function ai(e, t, r, n) {
    var i = e.history,
      o = n && n.origin;
    r == i.lastSelOp ||
    (o &&
      i.lastSelOrigin == o &&
      ((i.lastModTime == i.lastSelTime && i.lastOrigin == o) ||
        si(e, o, g(i.done), t)))
      ? (i.done[i.done.length - 1] = t)
      : ui(t, i.done),
      (i.lastSelTime = +new Date()),
      (i.lastSelOrigin = o),
      (i.lastSelOp = r),
      n && !1 !== n.clearRedo && ii(i.undone);
  }
  function ui(e, t) {
    var r = g(t);
    (r && r.ranges && r.equals(e)) || t.push(e);
  }
  function ci(e, t, r, n) {
    var i = t['spans_' + e.id],
      o = 0;
    e.iter(Math.max(e.first, r), Math.min(e.first + e.size, n), function (r) {
      r.markedSpans &&
        ((i || (i = t['spans_' + e.id] = {}))[o] = r.markedSpans),
        ++o;
    });
  }
  function hi(e) {
    if (!e) return null;
    for (var t, r = 0; r < e.length; ++r)
      e[r].marker.explicitlyCleared
        ? t || (t = e.slice(0, r))
        : t && t.push(e[r]);
    return t ? (t.length ? t : null) : e;
  }
  function fi(e, t) {
    var r = t['spans_' + e.id];
    if (!r) return null;
    for (var n = [], i = 0; i < t.text.length; ++i) n.push(hi(r[i]));
    return n;
  }
  function di(e, t) {
    var r = fi(e, t),
      n = Ee(e, t);
    if (!r) return n;
    if (!n) return r;
    for (var i = 0; i < r.length; ++i) {
      var o = r[i],
        l = n[i];
      if (o && l)
        e: for (var s = 0; s < l.length; ++s) {
          for (var a = l[s], u = 0; u < o.length; ++u)
            if (o[u].marker == a.marker) continue e;
          o.push(a);
        }
      else l && (r[i] = l);
    }
    return r;
  }
  function pi(e, t, r) {
    for (var n = [], i = 0; i < e.length; ++i) {
      var o = e[i];
      if (o.ranges) n.push(r ? Hs.prototype.deepCopy.call(o) : o);
      else {
        var l = o.changes,
          s = [];
        n.push({ changes: s });
        for (var a = 0; a < l.length; ++a) {
          var u = l[a],
            c = void 0;
          if ((s.push({ from: u.from, to: u.to, text: u.text }), t))
            for (var h in u)
              (c = h.match(/^spans_(\d+)$/)) &&
                f(t, Number(c[1])) > -1 &&
                ((g(s)[h] = u[h]), delete u[h]);
        }
      }
    }
    return n;
  }
  function gi(e, t, r, n) {
    if (n) {
      var i = e.anchor;
      if (r) {
        var o = ae(t, i) < 0;
        o != ae(r, i) < 0 ? ((i = t), (t = r)) : o != ae(t, r) < 0 && (t = r);
      }
      return new Fs(i, t);
    }
    return new Fs(r || t, t);
  }
  function vi(e, t, r, n, i) {
    null == i && (i = e.cm && (e.cm.display.shift || e.extend)),
      Ci(e, new Hs([gi(e.sel.primary(), t, r, i)], 0), n);
  }
  function mi(e, t, r) {
    for (
      var n = [], i = e.cm && (e.cm.display.shift || e.extend), o = 0;
      o < e.sel.ranges.length;
      o++
    )
      n[o] = gi(e.sel.ranges[o], t[o], null, i);
    var l = Gn(e.cm, n, e.sel.primIndex);
    Ci(e, l, r);
  }
  function yi(e, t, r, n) {
    var i = e.sel.ranges.slice(0);
    (i[t] = r), Ci(e, Gn(e.cm, i, e.sel.primIndex), n);
  }
  function bi(e, t, r, n) {
    Ci(e, Un(t, r), n);
  }
  function wi(e, t, r) {
    var n = {
      ranges: t.ranges,
      update: function (t) {
        var r = this;
        this.ranges = [];
        for (var n = 0; n < t.length; n++)
          r.ranges[n] = new Fs(pe(e, t[n].anchor), pe(e, t[n].head));
      },
      origin: r && r.origin,
    };
    return (
      D(e, 'beforeSelectionChange', e, n),
      e.cm && D(e.cm, 'beforeSelectionChange', e.cm, n),
      n.ranges != t.ranges ? Gn(e.cm, n.ranges, n.ranges.length - 1) : t
    );
  }
  function xi(e, t, r) {
    var n = e.history.done,
      i = g(n);
    i && i.ranges ? ((n[n.length - 1] = t), Si(e, t, r)) : Ci(e, t, r);
  }
  function Ci(e, t, r) {
    Si(e, t, r), ai(e, e.sel, e.cm ? e.cm.curOp.id : NaN, r);
  }
  function Si(e, t, r) {
    (F(e, 'beforeSelectionChange') ||
      (e.cm && F(e.cm, 'beforeSelectionChange'))) &&
      (t = wi(e, t, r));
    var n =
      (r && r.bias) ||
      (ae(t.primary().head, e.sel.primary().head) < 0 ? -1 : 1);
    Li(e, Ti(e, t, n, !0)), (r && !1 === r.scroll) || !e.cm || qr(e.cm);
  }
  function Li(e, t) {
    t.equals(e.sel) ||
      ((e.sel = t),
      e.cm &&
        ((e.cm.curOp.updateInput = 1),
        (e.cm.curOp.selectionChanged = !0),
        H(e.cm)),
      wt(e, 'cursorActivity', e));
  }
  function ki(e) {
    Li(e, Ti(e, e.sel, null, !1));
  }
  function Ti(e, t, r, n) {
    for (var i, o = 0; o < t.ranges.length; o++) {
      var l = t.ranges[o],
        s = t.ranges.length == e.sel.ranges.length && e.sel.ranges[o],
        a = Ni(e, l.anchor, s && s.anchor, r, n),
        u = Ni(e, l.head, s && s.head, r, n);
      (i || a != l.anchor || u != l.head) &&
        (i || (i = t.ranges.slice(0, o)), (i[o] = new Fs(a, u)));
    }
    return i ? Gn(e.cm, i, t.primIndex) : t;
  }
  function Mi(e, t, r, n, i) {
    var o = J(e, t.line);
    if (o.markedSpans)
      for (var l = 0; l < o.markedSpans.length; ++l) {
        var s = o.markedSpans[l],
          a = s.marker,
          u = 'selectLeft' in a ? !a.selectLeft : a.inclusiveLeft,
          c = 'selectRight' in a ? !a.selectRight : a.inclusiveRight;
        if (
          (null == s.from || (u ? s.from <= t.ch : s.from < t.ch)) &&
          (null == s.to || (c ? s.to >= t.ch : s.to > t.ch))
        ) {
          if (i && (D(a, 'beforeCursorEnter'), a.explicitlyCleared)) {
            if (o.markedSpans) {
              --l;
              continue;
            }
            break;
          }
          if (!a.atomic) continue;
          if (r) {
            var h = a.find(n < 0 ? 1 : -1),
              f = void 0;
            if (
              ((n < 0 ? c : u) &&
                (h = Oi(e, h, -n, h && h.line == t.line ? o : null)),
              h &&
                h.line == t.line &&
                (f = ae(h, r)) &&
                (n < 0 ? f < 0 : f > 0))
            )
              return Mi(e, h, t, n, i);
          }
          var d = a.find(n < 0 ? -1 : 1);
          return (
            (n < 0 ? u : c) && (d = Oi(e, d, n, d.line == t.line ? o : null)),
            d ? Mi(e, d, t, n, i) : null
          );
        }
      }
    return t;
  }
  function Ni(e, t, r, n, i) {
    var o = n || 1,
      l =
        Mi(e, t, r, o, i) ||
        (!i && Mi(e, t, r, o, !0)) ||
        Mi(e, t, r, -o, i) ||
        (!i && Mi(e, t, r, -o, !0));
    return l || ((e.cantEdit = !0), se(e.first, 0));
  }
  function Oi(e, t, r, n) {
    return r < 0 && 0 == t.ch
      ? t.line > e.first
        ? pe(e, se(t.line - 1))
        : null
      : r > 0 && t.ch == (n || J(e, t.line)).text.length
      ? t.line < e.first + e.size - 1
        ? se(t.line + 1, 0)
        : null
      : new se(t.line, t.ch + r);
  }
  function Ai(e) {
    e.setSelection(se(e.firstLine(), 0), se(e.lastLine()), $l);
  }
  function Di(e, t, r) {
    var n = {
      canceled: !1,
      from: t.from,
      to: t.to,
      text: t.text,
      origin: t.origin,
      cancel: function () {
        return (n.canceled = !0);
      },
    };
    return (
      r &&
        (n.update = function (t, r, i, o) {
          t && (n.from = pe(e, t)),
            r && (n.to = pe(e, r)),
            i && (n.text = i),
            void 0 !== o && (n.origin = o);
        }),
      D(e, 'beforeChange', e, n),
      e.cm && D(e.cm, 'beforeChange', e.cm, n),
      n.canceled
        ? (e.cm && (e.cm.curOp.updateInput = 2), null)
        : { from: n.from, to: n.to, text: n.text, origin: n.origin }
    );
  }
  function Wi(e, t, r) {
    if (e.cm) {
      if (!e.cm.curOp) return yn(e.cm, Wi)(e, t, r);
      if (e.cm.state.suppressEdits) return;
    }
    if (
      !(F(e, 'beforeChange') || (e.cm && F(e.cm, 'beforeChange'))) ||
      ((t = Di(e, t, !0)), t)
    ) {
      var n = ms && !r && ze(e, t.from, t.to);
      if (n)
        for (var i = n.length - 1; i >= 0; --i)
          Hi(e, {
            from: n[i].from,
            to: n[i].to,
            text: i ? [''] : t.text,
            origin: t.origin,
          });
      else Hi(e, t);
    }
  }
  function Hi(e, t) {
    if (1 != t.text.length || '' != t.text[0] || 0 != ae(t.from, t.to)) {
      var r = jn(e, t);
      li(e, t, r, e.cm ? e.cm.curOp.id : NaN), Ei(e, t, r, Ee(e, t));
      var n = [];
      Qn(e, function (e, r) {
        r || -1 != f(n, e.history) || (Gi(e.history, t), n.push(e.history)),
          Ei(e, t, null, Ee(e, t));
      });
    }
  }
  function Fi(e, t, r) {
    var n = e.cm && e.cm.state.suppressEdits;
    if (!n || r) {
      for (
        var i,
          o = e.history,
          l = e.sel,
          s = 'undo' == t ? o.done : o.undone,
          a = 'undo' == t ? o.undone : o.done,
          u = 0;
        u < s.length &&
        ((i = s[u]), r ? !i.ranges || i.equals(e.sel) : i.ranges);
        u++
      );
      if (u != s.length) {
        for (o.lastOrigin = o.lastSelOrigin = null; ; ) {
          if (((i = s.pop()), !i.ranges)) {
            if (n) return void s.push(i);
            break;
          }
          if ((ui(i, a), r && !i.equals(e.sel)))
            return void Ci(e, i, { clearRedo: !1 });
          l = i;
        }
        var c = [];
        ui(l, a),
          a.push({ changes: c, generation: o.generation }),
          (o.generation = i.generation || ++o.maxGeneration);
        for (
          var h = F(e, 'beforeChange') || (e.cm && F(e.cm, 'beforeChange')),
            d = function (r) {
              var n = i.changes[r];
              if (((n.origin = t), h && !Di(e, n, !1)))
                return (s.length = 0), {};
              c.push(ni(e, n));
              var o = r ? jn(e, n) : g(s);
              Ei(e, n, o, di(e, n)),
                !r && e.cm && e.cm.scrollIntoView({ from: n.from, to: Vn(n) });
              var l = [];
              Qn(e, function (e, t) {
                t ||
                  -1 != f(l, e.history) ||
                  (Gi(e.history, n), l.push(e.history)),
                  Ei(e, n, null, di(e, n));
              });
            },
            p = i.changes.length - 1;
          p >= 0;
          --p
        ) {
          var v = d(p);
          if (v) return v.v;
        }
      }
    }
  }
  function Pi(e, t) {
    if (
      0 != t &&
      ((e.first += t),
      (e.sel = new Hs(
        v(e.sel.ranges, function (e) {
          return new Fs(
            se(e.anchor.line + t, e.anchor.ch),
            se(e.head.line + t, e.head.ch)
          );
        }),
        e.sel.primIndex
      )),
      e.cm)
    ) {
      Tr(e.cm, e.first, e.first - t, t);
      for (var r = e.cm.display, n = r.viewFrom; n < r.viewTo; n++)
        Mr(e.cm, n, 'gutter');
    }
  }
  function Ei(e, t, r, n) {
    if (e.cm && !e.cm.curOp) return yn(e.cm, Ei)(e, t, r, n);
    if (t.to.line < e.first)
      Pi(e, t.text.length - 1 - (t.to.line - t.from.line));
    else if (!(t.from.line > e.lastLine())) {
      if (t.from.line < e.first) {
        var i = t.text.length - 1 - (e.first - t.from.line);
        Pi(e, i),
          (t = {
            from: se(e.first, 0),
            to: se(t.to.line + i, t.to.ch),
            text: [g(t.text)],
            origin: t.origin,
          });
      }
      var o = e.lastLine();
      t.to.line > o &&
        (t = {
          from: t.from,
          to: se(o, J(e, o).text.length),
          text: [t.text[0]],
          origin: t.origin,
        }),
        (t.removed = ee(e, t.from, t.to)),
        r || (r = jn(e, t)),
        e.cm ? Ii(e.cm, t, n) : Zn(e, t, n),
        Si(e, r, $l),
        e.cantEdit && Ni(e, se(e.firstLine(), 0)) && (e.cantEdit = !1);
    }
  }
  function Ii(e, t, r) {
    var n = e.doc,
      i = e.display,
      o = t.from,
      l = t.to,
      s = !1,
      a = o.line;
    e.options.lineWrapping ||
      ((a = ne($e(J(n, o.line)))),
      n.iter(a, l.line + 1, function (e) {
        if (e == i.maxLine) return (s = !0), !0;
      })),
      n.sel.contains(t.from, t.to) > -1 && H(e),
      Zn(n, t, r, Cr(e)),
      e.options.lineWrapping ||
        (n.iter(a, o.line + t.text.length, function (e) {
          var t = nt(e);
          t > i.maxLineLength &&
            ((i.maxLine = e),
            (i.maxLineLength = t),
            (i.maxLineChanged = !0),
            (s = !1));
        }),
        s && (e.curOp.updateMaxLine = !0)),
      Me(n, o.line),
      xn(e, 400);
    var u = t.text.length - (l.line - o.line) - 1;
    t.full
      ? Tr(e)
      : o.line != l.line || 1 != t.text.length || qn(e.doc, t)
      ? Tr(e, o.line, l.line + 1, u)
      : Mr(e, o.line, 'text');
    var c = F(e, 'changes'),
      h = F(e, 'change');
    if (h || c) {
      var f = {
        from: o,
        to: l,
        text: t.text,
        removed: t.removed,
        origin: t.origin,
      };
      h && wt(e, 'change', e, f),
        c && (e.curOp.changeObjs || (e.curOp.changeObjs = [])).push(f);
    }
    e.display.selForContextMenu = null;
  }
  function zi(e, t, r, n, i) {
    var o;
    n || (n = r),
      ae(n, r) < 0 && ((o = [n, r]), (r = o[0]), (n = o[1])),
      'string' == typeof t && (t = e.splitLines(t)),
      Wi(e, { from: r, to: n, text: t, origin: i });
  }
  function Ri(e, t, r, n) {
    r < e.line ? (e.line += n) : t < e.line && ((e.line = t), (e.ch = 0));
  }
  function Bi(e, t, r, n) {
    for (var i = 0; i < e.length; ++i) {
      var o = e[i],
        l = !0;
      if (o.ranges) {
        o.copied || ((o = e[i] = o.deepCopy()), (o.copied = !0));
        for (var s = 0; s < o.ranges.length; s++)
          Ri(o.ranges[s].anchor, t, r, n), Ri(o.ranges[s].head, t, r, n);
      } else {
        for (var a = 0; a < o.changes.length; ++a) {
          var u = o.changes[a];
          if (r < u.from.line)
            (u.from = se(u.from.line + n, u.from.ch)),
              (u.to = se(u.to.line + n, u.to.ch));
          else if (t <= u.to.line) {
            l = !1;
            break;
          }
        }
        l || (e.splice(0, i + 1), (i = 0));
      }
    }
  }
  function Gi(e, t) {
    var r = t.from.line,
      n = t.to.line,
      i = t.text.length - (n - r) - 1;
    Bi(e.done, r, n, i), Bi(e.undone, r, n, i);
  }
  function Ui(e, t, r, n) {
    var i = t,
      o = t;
    return (
      'number' == typeof t ? (o = J(e, de(e, t))) : (i = ne(t)),
      null == i ? null : (n(o, i) && e.cm && Mr(e.cm, i, r), o)
    );
  }
  function Vi(e) {
    var t = this;
    (this.lines = e), (this.parent = null);
    for (var r = 0, n = 0; n < e.length; ++n)
      (e[n].parent = t), (r += e[n].height);
    this.height = r;
  }
  function Ki(e) {
    var t = this;
    this.children = e;
    for (var r = 0, n = 0, i = 0; i < e.length; ++i) {
      var o = e[i];
      (r += o.chunkSize()), (n += o.height), (o.parent = t);
    }
    (this.size = r), (this.height = n), (this.parent = null);
  }
  function ji(e, t, r) {
    rt(t) < ((e.curOp && e.curOp.scrollTop) || e.doc.scrollTop) && $r(e, r);
  }
  function Xi(e, t, r, n) {
    var i = new Ps(e, r, n),
      o = e.cm;
    return (
      o && i.noHScroll && (o.display.alignWidgets = !0),
      Ui(e, t, 'widget', function (t) {
        var r = t.widgets || (t.widgets = []);
        if (
          (null == i.insertAt
            ? r.push(i)
            : r.splice(Math.min(r.length - 1, Math.max(0, i.insertAt)), 0, i),
          (i.line = t),
          o && !et(e, t))
        ) {
          var n = rt(t) < e.scrollTop;
          re(t, t.height + Ft(i)),
            n && $r(o, i.height),
            (o.curOp.forceUpdate = !0);
        }
        return !0;
      }),
      o && wt(o, 'lineWidgetAdded', o, i, 'number' == typeof t ? t : ne(t)),
      i
    );
  }
  function Yi(e, t, r, n, o) {
    if (n && n.shared) return _i(e, t, r, n, o);
    if (e.cm && !e.cm.curOp) return yn(e.cm, Yi)(e, t, r, n, o);
    var l = new Is(e, o),
      s = ae(t, r);
    if ((n && c(n, l, !1), s > 0 || (0 == s && !1 !== l.clearWhenEmpty)))
      return l;
    if (
      (l.replacedWith &&
        ((l.collapsed = !0),
        (l.widgetNode = i('span', [l.replacedWith], 'CodeMirror-widget')),
        n.handleMouseEvents ||
          l.widgetNode.setAttribute('cm-ignore-events', 'true'),
        n.insertLeft && (l.widgetNode.insertLeft = !0)),
      l.collapsed)
    ) {
      if (
        _e(e, t.line, t, r, l) ||
        (t.line != r.line && _e(e, r.line, t, r, l))
      )
        throw new Error(
          'Inserting collapsed marker partially overlapping an existing one'
        );
      Oe();
    }
    l.addToHistory && li(e, { from: t, to: r, origin: 'markText' }, e.sel, NaN);
    var a,
      u = t.line,
      h = e.cm;
    if (
      (e.iter(u, r.line + 1, function (e) {
        h &&
          l.collapsed &&
          !h.options.lineWrapping &&
          $e(e) == h.display.maxLine &&
          (a = !0),
          l.collapsed && u != t.line && re(e, 0),
          He(
            e,
            new Ae(l, u == t.line ? t.ch : null, u == r.line ? r.ch : null)
          ),
          ++u;
      }),
      l.collapsed &&
        e.iter(t.line, r.line + 1, function (t) {
          et(e, t) && re(t, 0);
        }),
      l.clearOnEnter &&
        is(l, 'beforeCursorEnter', function () {
          return l.clear();
        }),
      l.readOnly &&
        (Ne(),
        (e.history.done.length || e.history.undone.length) && e.clearHistory()),
      l.collapsed && ((l.id = ++Es), (l.atomic = !0)),
      h)
    ) {
      if ((a && (h.curOp.updateMaxLine = !0), l.collapsed))
        Tr(h, t.line, r.line + 1);
      else if (
        l.className ||
        l.startStyle ||
        l.endStyle ||
        l.css ||
        l.attributes ||
        l.title
      )
        for (var f = t.line; f <= r.line; f++) Mr(h, f, 'text');
      l.atomic && ki(h.doc), wt(h, 'markerAdded', h, l);
    }
    return l;
  }
  function _i(e, t, r, n, i) {
    (n = c(n)), (n.shared = !1);
    var o = [Yi(e, t, r, n, i)],
      l = o[0],
      s = n.widgetNode;
    return (
      Qn(e, function (e) {
        s && (n.widgetNode = s.cloneNode(!0)),
          o.push(Yi(e, pe(e, t), pe(e, r), n, i));
        for (var a = 0; a < e.linked.length; ++a)
          if (e.linked[a].isParent) return;
        l = g(o);
      }),
      new zs(o, l)
    );
  }
  function $i(e) {
    return e.findMarks(se(e.first, 0), e.clipPos(se(e.lastLine())), function (
      e
    ) {
      return e.parent;
    });
  }
  function qi(e, t) {
    for (var r = 0; r < t.length; r++) {
      var n = t[r],
        i = n.find(),
        o = e.clipPos(i.from),
        l = e.clipPos(i.to);
      if (ae(o, l)) {
        var s = Yi(e, o, l, n.primary, n.primary.type);
        n.markers.push(s), (s.parent = n);
      }
    }
  }
  function Zi(e) {
    for (
      var t = function (t) {
          var r = e[t],
            n = [r.primary.doc];
          Qn(r.primary.doc, function (e) {
            return n.push(e);
          });
          for (var i = 0; i < r.markers.length; i++) {
            var o = r.markers[i];
            -1 == f(n, o.doc) && ((o.parent = null), r.markers.splice(i--, 1));
          }
        },
        r = 0;
      r < e.length;
      r++
    )
      t(r);
  }
  function Qi(e) {
    var t = this;
    if ((to(t), !W(t, e) && !Pt(t.display, e))) {
      E(e), Cl && (Gs = +new Date());
      var r = Lr(t, e, !0),
        n = e.dataTransfer.files;
      if (r && !t.isReadOnly())
        if (n && n.length && window.FileReader && window.File)
          for (
            var i = n.length,
              o = Array(i),
              l = 0,
              s = function () {
                ++l == i &&
                  yn(t, function () {
                    r = pe(t.doc, r);
                    var e = {
                      from: r,
                      to: r,
                      text: t.doc.splitLines(
                        o
                          .filter(function (e) {
                            return null != e;
                          })
                          .join(t.doc.lineSeparator())
                      ),
                      origin: 'paste',
                    };
                    Wi(t.doc, e), xi(t.doc, Un(pe(t.doc, r), pe(t.doc, Vn(e))));
                  })();
              },
              a = function (e, r) {
                if (
                  t.options.allowDropFileTypes &&
                  -1 == f(t.options.allowDropFileTypes, e.type)
                )
                  s();
                else {
                  var n = new FileReader();
                  (n.onerror = function () {
                    return s();
                  }),
                    (n.onload = function () {
                      var e = n.result;
                      /[\x00-\x08\x0e-\x1f]{2}/.test(e)
                        ? s()
                        : ((o[r] = e), s());
                    }),
                    n.readAsText(e);
                }
              },
              u = 0;
            u < n.length;
            u++
          )
            a(n[u], u);
        else {
          if (t.state.draggingText && t.doc.sel.contains(r) > -1)
            return (
              t.state.draggingText(e),
              void setTimeout(function () {
                return t.display.input.focus();
              }, 20)
            );
          try {
            var c = e.dataTransfer.getData('Text');
            if (c) {
              var h;
              if (
                (t.state.draggingText &&
                  !t.state.draggingText.copy &&
                  (h = t.listSelections()),
                Si(t.doc, Un(r, r)),
                h)
              )
                for (var d = 0; d < h.length; ++d)
                  zi(t.doc, '', h[d].anchor, h[d].head, 'drag');
              t.replaceSelection(c, 'around', 'paste'), t.display.input.focus();
            }
          } catch (e) {}
        }
    }
  }
  function Ji(e, t) {
    if (Cl && (!e.state.draggingText || +new Date() - Gs < 100)) R(t);
    else if (
      !W(e, t) &&
      !Pt(e.display, t) &&
      (t.dataTransfer.setData('Text', e.getSelection()),
      (t.dataTransfer.effectAllowed = 'copyMove'),
      t.dataTransfer.setDragImage && !Nl)
    ) {
      var r = n('img', null, null, 'position: fixed; left: 0; top: 0;');
      (r.src =
        'data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=='),
        Ml &&
          ((r.width = r.height = 1),
          e.display.wrapper.appendChild(r),
          (r._top = r.offsetTop)),
        t.dataTransfer.setDragImage(r, 0, 0),
        Ml && r.parentNode.removeChild(r);
    }
  }
  function eo(e, t) {
    var i = Lr(e, t);
    if (i) {
      var o = document.createDocumentFragment();
      Fr(e, i, o),
        e.display.dragCursor ||
          ((e.display.dragCursor = n(
            'div',
            null,
            'CodeMirror-cursors CodeMirror-dragcursors'
          )),
          e.display.lineSpace.insertBefore(
            e.display.dragCursor,
            e.display.cursorDiv
          )),
        r(e.display.dragCursor, o);
    }
  }
  function to(e) {
    e.display.dragCursor &&
      (e.display.lineSpace.removeChild(e.display.dragCursor),
      (e.display.dragCursor = null));
  }
  function ro(e) {
    if (document.getElementsByClassName) {
      for (
        var t = document.getElementsByClassName('CodeMirror'), r = [], n = 0;
        n < t.length;
        n++
      ) {
        var i = t[n].CodeMirror;
        i && r.push(i);
      }
      r.length &&
        r[0].operation(function () {
          for (var t = 0; t < r.length; t++) e(r[t]);
        });
    }
  }
  function no() {
    Us || (io(), (Us = !0));
  }
  function io() {
    var e;
    is(window, 'resize', function () {
      null == e &&
        (e = setTimeout(function () {
          (e = null), ro(oo);
        }, 100));
    }),
      is(window, 'blur', function () {
        return ro(Gr);
      });
  }
  function oo(e) {
    var t = e.display;
    (t.cachedCharWidth = t.cachedTextHeight = t.cachedPaddingH = null),
      (t.scrollbarsClipped = !1),
      e.setSize();
  }
  function lo(e) {
    var t,
      r,
      n,
      i,
      o = e.split(/-(?!$)/);
    e = o[o.length - 1];
    for (var l = 0; l < o.length - 1; l++) {
      var s = o[l];
      if (/^(cmd|meta|m)$/i.test(s)) i = !0;
      else if (/^a(lt)?$/i.test(s)) t = !0;
      else if (/^(c|ctrl|control)$/i.test(s)) r = !0;
      else {
        if (!/^s(hift)?$/i.test(s))
          throw new Error('Unrecognized modifier name: ' + s);
        n = !0;
      }
    }
    return (
      t && (e = 'Alt-' + e),
      r && (e = 'Ctrl-' + e),
      i && (e = 'Cmd-' + e),
      n && (e = 'Shift-' + e),
      e
    );
  }
  function so(e) {
    var t = {};
    for (var r in e)
      if (e.hasOwnProperty(r)) {
        var n = e[r];
        if (/^(name|fallthrough|(de|at)tach)$/.test(r)) continue;
        if ('...' == n) {
          delete e[r];
          continue;
        }
        for (var i = v(r.split(' '), lo), o = 0; o < i.length; o++) {
          var l = void 0,
            s = void 0;
          o == i.length - 1
            ? ((s = i.join(' ')), (l = n))
            : ((s = i.slice(0, o + 1).join(' ')), (l = '...'));
          var a = t[s];
          if (a) {
            if (a != l) throw new Error('Inconsistent bindings for ' + s);
          } else t[s] = l;
        }
        delete e[r];
      }
    for (var u in t) e[u] = t[u];
    return e;
  }
  function ao(e, t, r, n) {
    t = fo(t);
    var i = t.call ? t.call(e, n) : t[e];
    if (!1 === i) return 'nothing';
    if ('...' === i) return 'multi';
    if (null != i && r(i)) return 'handled';
    if (t.fallthrough) {
      if ('[object Array]' != Object.prototype.toString.call(t.fallthrough))
        return ao(e, t.fallthrough, r, n);
      for (var o = 0; o < t.fallthrough.length; o++) {
        var l = ao(e, t.fallthrough[o], r, n);
        if (l) return l;
      }
    }
  }
  function uo(e) {
    var t = 'string' == typeof e ? e : Vs[e.keyCode];
    return 'Ctrl' == t || 'Alt' == t || 'Shift' == t || 'Mod' == t;
  }
  function co(e, t, r) {
    var n = e;
    return (
      t.altKey && 'Alt' != n && (e = 'Alt-' + e),
      (Rl ? t.metaKey : t.ctrlKey) && 'Ctrl' != n && (e = 'Ctrl-' + e),
      (Rl ? t.ctrlKey : t.metaKey) && 'Cmd' != n && (e = 'Cmd-' + e),
      !r && t.shiftKey && 'Shift' != n && (e = 'Shift-' + e),
      e
    );
  }
  function ho(e, t) {
    if (Ml && 34 == e.keyCode && e.char) return !1;
    var r = Vs[e.keyCode];
    return (
      null != r &&
      !e.altGraphKey &&
      (3 == e.keyCode && e.code && (r = e.code), co(r, e, t))
    );
  }
  function fo(e) {
    return 'string' == typeof e ? Ys[e] : e;
  }
  function po(e, t) {
    for (var r = e.doc.sel.ranges, n = [], i = 0; i < r.length; i++) {
      for (var o = t(r[i]); n.length && ae(o.from, g(n).to) <= 0; ) {
        var l = n.pop();
        if (ae(l.from, o.from) < 0) {
          o.from = l.from;
          break;
        }
      }
      n.push(o);
    }
    mn(e, function () {
      for (var t = n.length - 1; t >= 0; t--)
        zi(e.doc, '', n[t].from, n[t].to, '+delete');
      qr(e);
    });
  }
  function go(e, t, r) {
    var n = L(e.text, t + r, r);
    return n < 0 || n > e.text.length ? null : n;
  }
  function vo(e, t, r) {
    var n = go(e, t.ch, r);
    return null == n ? null : new se(t.line, n, r < 0 ? 'after' : 'before');
  }
  function mo(e, t, r, n, i) {
    if (e) {
      'rtl' == t.doc.direction && (i = -i);
      var o = N(r, t.doc.direction);
      if (o) {
        var l,
          s = i < 0 ? g(o) : o[0],
          a = i < 0 == (1 == s.level),
          u = a ? 'after' : 'before';
        if (s.level > 0 || 'rtl' == t.doc.direction) {
          var c = Yt(t, r);
          l = i < 0 ? r.text.length - 1 : 0;
          var h = _t(t, c, l).top;
          (l = k(
            function (e) {
              return _t(t, c, e).top == h;
            },
            i < 0 == (1 == s.level) ? s.from : s.to - 1,
            l
          )),
            'before' == u && (l = go(r, l, 1));
        } else l = i < 0 ? s.to : s.from;
        return new se(n, l, u);
      }
    }
    return new se(n, i < 0 ? r.text.length : 0, i < 0 ? 'before' : 'after');
  }
  function yo(e, t, r, n) {
    var i = N(t, e.doc.direction);
    if (!i) return vo(t, r, n);
    r.ch >= t.text.length
      ? ((r.ch = t.text.length), (r.sticky = 'before'))
      : r.ch <= 0 && ((r.ch = 0), (r.sticky = 'after'));
    var o = M(i, r.ch, r.sticky),
      l = i[o];
    if (
      'ltr' == e.doc.direction &&
      l.level % 2 == 0 &&
      (n > 0 ? l.to > r.ch : l.from < r.ch)
    )
      return vo(t, r, n);
    var s,
      a = function (e, r) {
        return go(t, e instanceof se ? e.ch : e, r);
      },
      u = function (r) {
        return e.options.lineWrapping
          ? ((s = s || Yt(e, t)), dr(e, t, s, r))
          : { begin: 0, end: t.text.length };
      },
      c = u('before' == r.sticky ? a(r, -1) : r.ch);
    if ('rtl' == e.doc.direction || 1 == l.level) {
      var h = (1 == l.level) == n < 0,
        f = a(r, h ? 1 : -1);
      if (
        null != f &&
        (h ? f <= l.to && f <= c.end : f >= l.from && f >= c.begin)
      ) {
        var d = h ? 'before' : 'after';
        return new se(r.line, f, d);
      }
    }
    var p = function (e, t, n) {
        for (
          var o = function (e, t) {
            return t
              ? new se(r.line, a(e, 1), 'before')
              : new se(r.line, e, 'after');
          };
          e >= 0 && e < i.length;
          e += t
        ) {
          var l = i[e],
            s = t > 0 == (1 != l.level),
            u = s ? n.begin : a(n.end, -1);
          if (l.from <= u && u < l.to) return o(u, s);
          if (((u = s ? l.from : a(l.to, -1)), n.begin <= u && u < n.end))
            return o(u, s);
        }
      },
      g = p(o + n, n, c);
    if (g) return g;
    var v = n > 0 ? c.end : a(c.begin, -1);
    return null == v ||
      (n > 0 && v == t.text.length) ||
      ((g = p(n > 0 ? 0 : i.length - 1, n, u(v))), !g)
      ? null
      : g;
  }
  function bo(e, t) {
    var r = J(e.doc, t),
      n = $e(r);
    return n != r && (t = ne(n)), mo(!0, e, n, t, 1);
  }
  function wo(e, t) {
    var r = J(e.doc, t),
      n = qe(r);
    return n != r && (t = ne(n)), mo(!0, e, r, t, -1);
  }
  function xo(e, t) {
    var r = bo(e, t.line),
      n = J(e.doc, r.line),
      i = N(n, e.doc.direction);
    if (!i || 0 == i[0].level) {
      var o = Math.max(r.ch, n.text.search(/\S/)),
        l = t.line == r.line && t.ch <= o && t.ch;
      return se(r.line, l ? 0 : o, r.sticky);
    }
    return r;
  }
  function Co(e, t, r) {
    if ('string' == typeof t && ((t = qs[t]), !t)) return !1;
    e.display.input.ensurePolled();
    var n = e.display.shift,
      i = !1;
    try {
      e.isReadOnly() && (e.state.suppressEdits = !0),
        r && (e.display.shift = !1),
        (i = t(e) != _l);
    } finally {
      (e.display.shift = n), (e.state.suppressEdits = !1);
    }
    return i;
  }
  function So(e, t, r) {
    for (var n = 0; n < e.state.keyMaps.length; n++) {
      var i = ao(t, e.state.keyMaps[n], r, e);
      if (i) return i;
    }
    return (
      (e.options.extraKeys && ao(t, e.options.extraKeys, r, e)) ||
      ao(t, e.options.keyMap, r, e)
    );
  }
  function Lo(e, t, r, n) {
    var i = e.state.keySeq;
    if (i) {
      if (uo(t)) return 'handled';
      if (
        (/\'$/.test(t)
          ? (e.state.keySeq = null)
          : Zs.set(50, function () {
              e.state.keySeq == i &&
                ((e.state.keySeq = null), e.display.input.reset());
            }),
        ko(e, i + ' ' + t, r, n))
      )
        return !0;
    }
    return ko(e, t, r, n);
  }
  function ko(e, t, r, n) {
    var i = So(e, t, n);
    return (
      'multi' == i && (e.state.keySeq = t),
      'handled' == i && wt(e, 'keyHandled', e, t, r),
      ('handled' != i && 'multi' != i) || (E(r), Ir(e)),
      !!i
    );
  }
  function To(e, t) {
    var r = ho(t, !0);
    return (
      !!r &&
      (t.shiftKey && !e.state.keySeq
        ? Lo(e, 'Shift-' + r, t, function (t) {
            return Co(e, t, !0);
          }) ||
          Lo(e, r, t, function (t) {
            if ('string' == typeof t ? /^go[A-Z]/.test(t) : t.motion)
              return Co(e, t);
          })
        : Lo(e, r, t, function (t) {
            return Co(e, t);
          }))
    );
  }
  function Mo(e, t, r) {
    return Lo(e, "'" + r + "'", t, function (t) {
      return Co(e, t, !0);
    });
  }
  function No(e) {
    var t = this;
    if (((t.curOp.focus = l()), !W(t, e))) {
      Cl && Sl < 11 && 27 == e.keyCode && (e.returnValue = !1);
      var r = e.keyCode;
      t.display.shift = 16 == r || e.shiftKey;
      var n = To(t, e);
      Ml &&
        ((Qs = n ? r : null),
        !n &&
          88 == r &&
          !as &&
          (Fl ? e.metaKey : e.ctrlKey) &&
          t.replaceSelection('', null, 'cut')),
        yl &&
          !Fl &&
          !n &&
          46 == r &&
          e.shiftKey &&
          !e.ctrlKey &&
          document.execCommand &&
          document.execCommand('cut'),
        18 != r ||
          /\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className) ||
          Oo(t);
    }
  }
  function Oo(e) {
    function t(e) {
      (18 != e.keyCode && e.altKey) ||
        (Gl(r, 'CodeMirror-crosshair'),
        A(document, 'keyup', t),
        A(document, 'mouseover', t));
    }
    var r = e.display.lineDiv;
    s(r, 'CodeMirror-crosshair'),
      is(document, 'keyup', t),
      is(document, 'mouseover', t);
  }
  function Ao(e) {
    16 == e.keyCode && (this.doc.sel.shift = !1), W(this, e);
  }
  function Do(e) {
    var t = this;
    if (
      !(
        Pt(t.display, e) ||
        W(t, e) ||
        (e.ctrlKey && !e.altKey) ||
        (Fl && e.metaKey)
      )
    ) {
      var r = e.keyCode,
        n = e.charCode;
      if (Ml && r == Qs) return (Qs = null), void E(e);
      if (!Ml || (e.which && !(e.which < 10)) || !To(t, e)) {
        var i = String.fromCharCode(null == n ? r : n);
        '\b' != i && (Mo(t, e, i) || t.display.input.onKeyPress(e));
      }
    }
  }
  function Wo(e, t) {
    var r = +new Date();
    return $s && $s.compare(r, e, t)
      ? ((_s = $s = null), 'triple')
      : _s && _s.compare(r, e, t)
      ? (($s = new ea(r, e, t)), (_s = null), 'double')
      : ((_s = new ea(r, e, t)), ($s = null), 'single');
  }
  function Ho(e) {
    var t = this,
      r = t.display;
    if (!(W(t, e) || (r.activeTouch && r.input.supportsTouch())))
      if ((r.input.ensurePolled(), (r.shift = e.shiftKey), Pt(r, e)))
        Ll ||
          ((r.scroller.draggable = !1),
          setTimeout(function () {
            return (r.scroller.draggable = !0);
          }, 100));
      else if (!Uo(t, e)) {
        var n = Lr(t, e),
          i = G(e),
          o = n ? Wo(n, i) : 'single';
        window.focus(),
          1 == i && t.state.selectingText && t.state.selectingText(e),
          (n && Fo(t, i, n, o, e)) ||
            (1 == i
              ? n
                ? Eo(t, n, o, e)
                : B(e) == r.scroller && E(e)
              : 2 == i
              ? (n && vi(t.doc, n),
                setTimeout(function () {
                  return r.input.focus();
                }, 20))
              : 3 == i && (Bl ? t.display.input.onContextMenu(e) : Rr(t)));
      }
  }
  function Fo(e, t, r, n, i) {
    var o = 'Click';
    return (
      'double' == n ? (o = 'Double' + o) : 'triple' == n && (o = 'Triple' + o),
      (o = (1 == t ? 'Left' : 2 == t ? 'Middle' : 'Right') + o),
      Lo(e, co(o, i), i, function (t) {
        if (('string' == typeof t && (t = qs[t]), !t)) return !1;
        var n = !1;
        try {
          e.isReadOnly() && (e.state.suppressEdits = !0), (n = t(e, r) != _l);
        } finally {
          e.state.suppressEdits = !1;
        }
        return n;
      })
    );
  }
  function Po(e, t, r) {
    var n = e.getOption('configureMouse'),
      i = n ? n(e, t, r) : {};
    if (null == i.unit) {
      var o = Pl ? r.shiftKey && r.metaKey : r.altKey;
      i.unit = o
        ? 'rectangle'
        : 'single' == t
        ? 'char'
        : 'double' == t
        ? 'word'
        : 'line';
    }
    return (
      (null == i.extend || e.doc.extend) &&
        (i.extend = e.doc.extend || r.shiftKey),
      null == i.addNew && (i.addNew = Fl ? r.metaKey : r.ctrlKey),
      null == i.moveOnDrag && (i.moveOnDrag = !(Fl ? r.altKey : r.ctrlKey)),
      i
    );
  }
  function Eo(e, t, r, n) {
    Cl ? setTimeout(u(zr, e), 0) : (e.curOp.focus = l());
    var i,
      o = Po(e, r, n),
      s = e.doc.sel;
    e.options.dragDrop &&
    os &&
    !e.isReadOnly() &&
    'single' == r &&
    (i = s.contains(t)) > -1 &&
    (ae((i = s.ranges[i]).from(), t) < 0 || t.xRel > 0) &&
    (ae(i.to(), t) > 0 || t.xRel < 0)
      ? Io(e, n, t, o)
      : Ro(e, n, t, o);
  }
  function Io(e, t, r, n) {
    var i = e.display,
      o = !1,
      l = yn(e, function (t) {
        Ll && (i.scroller.draggable = !1),
          (e.state.draggingText = !1),
          A(i.wrapper.ownerDocument, 'mouseup', l),
          A(i.wrapper.ownerDocument, 'mousemove', s),
          A(i.scroller, 'dragstart', a),
          A(i.scroller, 'drop', l),
          o ||
            (E(t),
            n.addNew || vi(e.doc, r, null, null, n.extend),
            Ll || (Cl && 9 == Sl)
              ? setTimeout(function () {
                  i.wrapper.ownerDocument.body.focus(), i.input.focus();
                }, 20)
              : i.input.focus());
      }),
      s = function (e) {
        o =
          o ||
          Math.abs(t.clientX - e.clientX) + Math.abs(t.clientY - e.clientY) >=
            10;
      },
      a = function () {
        return (o = !0);
      };
    Ll && (i.scroller.draggable = !0),
      (e.state.draggingText = l),
      (l.copy = !n.moveOnDrag),
      i.scroller.dragDrop && i.scroller.dragDrop(),
      is(i.wrapper.ownerDocument, 'mouseup', l),
      is(i.wrapper.ownerDocument, 'mousemove', s),
      is(i.scroller, 'dragstart', a),
      is(i.scroller, 'drop', l),
      Rr(e),
      setTimeout(function () {
        return i.input.focus();
      }, 20);
  }
  function zo(e, t, r) {
    if ('char' == r) return new Fs(t, t);
    if ('word' == r) return e.findWordAt(t);
    if ('line' == r) return new Fs(se(t.line, 0), pe(e.doc, se(t.line + 1, 0)));
    var n = r(e, t);
    return new Fs(n.from, n.to);
  }
  function Ro(e, t, r, n) {
    function i(t) {
      if (0 != ae(m, t))
        if (((m = t), 'rectangle' == n.unit)) {
          for (
            var i = [],
              o = e.options.tabSize,
              l = h(J(u, r.line).text, r.ch, o),
              s = h(J(u, t.line).text, t.ch, o),
              a = Math.min(l, s),
              g = Math.max(l, s),
              v = Math.min(r.line, t.line),
              y = Math.min(e.lastLine(), Math.max(r.line, t.line));
            v <= y;
            v++
          ) {
            var b = J(u, v).text,
              w = d(b, a, o);
            a == g
              ? i.push(new Fs(se(v, w), se(v, w)))
              : b.length > w && i.push(new Fs(se(v, w), se(v, d(b, g, o))));
          }
          i.length || i.push(new Fs(r, r)),
            Ci(u, Gn(e, p.ranges.slice(0, f).concat(i), f), {
              origin: '*mouse',
              scroll: !1,
            }),
            e.scrollIntoView(t);
        } else {
          var x,
            C = c,
            S = zo(e, t, n.unit),
            L = C.anchor;
          ae(S.anchor, L) > 0
            ? ((x = S.head), (L = fe(C.from(), S.anchor)))
            : ((x = S.anchor), (L = he(C.to(), S.head)));
          var k = p.ranges.slice(0);
          (k[f] = Bo(e, new Fs(pe(u, L), x))), Ci(u, Gn(e, k, f), ql);
        }
    }
    function o(t) {
      var r = ++b,
        s = Lr(e, t, !0, 'rectangle' == n.unit);
      if (s)
        if (0 != ae(s, m)) {
          (e.curOp.focus = l()), i(s);
          var c = Kr(a, u);
          (s.line >= c.to || s.line < c.from) &&
            setTimeout(
              yn(e, function () {
                b == r && o(t);
              }),
              150
            );
        } else {
          var h = t.clientY < y.top ? -20 : t.clientY > y.bottom ? 20 : 0;
          h &&
            setTimeout(
              yn(e, function () {
                b == r && ((a.scroller.scrollTop += h), o(t));
              }),
              50
            );
        }
    }
    function s(t) {
      (e.state.selectingText = !1),
        (b = 1 / 0),
        t && (E(t), a.input.focus()),
        A(a.wrapper.ownerDocument, 'mousemove', w),
        A(a.wrapper.ownerDocument, 'mouseup', x),
        (u.history.lastSelOrigin = null);
    }
    var a = e.display,
      u = e.doc;
    E(t);
    var c,
      f,
      p = u.sel,
      g = p.ranges;
    if (
      (n.addNew && !n.extend
        ? ((f = u.sel.contains(r)), (c = f > -1 ? g[f] : new Fs(r, r)))
        : ((c = u.sel.primary()), (f = u.sel.primIndex)),
      'rectangle' == n.unit)
    )
      n.addNew || (c = new Fs(r, r)), (r = Lr(e, t, !0, !0)), (f = -1);
    else {
      var v = zo(e, r, n.unit);
      c = n.extend ? gi(c, v.anchor, v.head, n.extend) : v;
    }
    n.addNew
      ? -1 == f
        ? ((f = g.length),
          Ci(u, Gn(e, g.concat([c]), f), { scroll: !1, origin: '*mouse' }))
        : g.length > 1 && g[f].empty() && 'char' == n.unit && !n.extend
        ? (Ci(u, Gn(e, g.slice(0, f).concat(g.slice(f + 1)), 0), {
            scroll: !1,
            origin: '*mouse',
          }),
          (p = u.sel))
        : yi(u, f, c, ql)
      : ((f = 0), Ci(u, new Hs([c], 0), ql), (p = u.sel));
    var m = r,
      y = a.wrapper.getBoundingClientRect(),
      b = 0,
      w = yn(e, function (e) {
        0 !== e.buttons && G(e) ? o(e) : s(e);
      }),
      x = yn(e, s);
    (e.state.selectingText = x),
      is(a.wrapper.ownerDocument, 'mousemove', w),
      is(a.wrapper.ownerDocument, 'mouseup', x);
  }
  function Bo(e, t) {
    var r = t.anchor,
      n = t.head,
      i = J(e.doc, r.line);
    if (0 == ae(r, n) && r.sticky == n.sticky) return t;
    var o = N(i);
    if (!o) return t;
    var l = M(o, r.ch, r.sticky),
      s = o[l];
    if (s.from != r.ch && s.to != r.ch) return t;
    var a,
      u = l + ((s.from == r.ch) == (1 != s.level) ? 0 : 1);
    if (0 == u || u == o.length) return t;
    if (n.line != r.line)
      a = (n.line - r.line) * ('ltr' == e.doc.direction ? 1 : -1) > 0;
    else {
      var c = M(o, n.ch, n.sticky),
        h = c - l || (n.ch - r.ch) * (1 == s.level ? -1 : 1);
      a = c == u - 1 || c == u ? h < 0 : h > 0;
    }
    var f = o[u + (a ? -1 : 0)],
      d = a == (1 == f.level),
      p = d ? f.from : f.to,
      g = d ? 'after' : 'before';
    return r.ch == p && r.sticky == g ? t : new Fs(new se(r.line, p, g), n);
  }
  function Go(e, t, r, n) {
    var i, o;
    if (t.touches) (i = t.touches[0].clientX), (o = t.touches[0].clientY);
    else
      try {
        (i = t.clientX), (o = t.clientY);
      } catch (t) {
        return !1;
      }
    if (i >= Math.floor(e.display.gutters.getBoundingClientRect().right))
      return !1;
    n && E(t);
    var l = e.display,
      s = l.lineDiv.getBoundingClientRect();
    if (o > s.bottom || !F(e, r)) return z(t);
    o -= s.top - l.viewOffset;
    for (var a = 0; a < e.display.gutterSpecs.length; ++a) {
      var u = l.gutters.childNodes[a];
      if (u && u.getBoundingClientRect().right >= i) {
        var c = ie(e.doc, o),
          h = e.display.gutterSpecs[a];
        return D(e, r, e, c, h.className, t), z(t);
      }
    }
  }
  function Uo(e, t) {
    return Go(e, t, 'gutterClick', !0);
  }
  function Vo(e, t) {
    Pt(e.display, t) ||
      Ko(e, t) ||
      W(e, t, 'contextmenu') ||
      Bl ||
      e.display.input.onContextMenu(t);
  }
  function Ko(e, t) {
    return !!F(e, 'gutterContextMenu') && Go(e, t, 'gutterContextMenu', !1);
  }
  function jo(e) {
    (e.display.wrapper.className =
      e.display.wrapper.className.replace(/\s*cm-s-\S+/g, '') +
      e.options.theme.replace(/(^|\s)\s*/g, ' cm-s-')),
      tr(e);
  }
  function Xo(e) {
    function t(t, n, i, o) {
      (e.defaults[t] = n),
        i &&
          (r[t] = o
            ? function (e, t, r) {
                r != ta && i(e, t, r);
              }
            : i);
    }
    var r = e.optionHandlers;
    (e.defineOption = t),
      (e.Init = ta),
      t(
        'value',
        '',
        function (e, t) {
          return e.setValue(t);
        },
        !0
      ),
      t(
        'mode',
        null,
        function (e, t) {
          (e.doc.modeOption = t), _n(e);
        },
        !0
      ),
      t('indentUnit', 2, _n, !0),
      t('indentWithTabs', !1),
      t('smartIndent', !0),
      t(
        'tabSize',
        4,
        function (e) {
          $n(e), tr(e), Tr(e);
        },
        !0
      ),
      t('lineSeparator', null, function (e, t) {
        if (((e.doc.lineSep = t), t)) {
          var r = [],
            n = e.doc.first;
          e.doc.iter(function (e) {
            for (var i = 0; ; ) {
              var o = e.text.indexOf(t, i);
              if (-1 == o) break;
              (i = o + t.length), r.push(se(n, o));
            }
            n++;
          });
          for (var i = r.length - 1; i >= 0; i--)
            zi(e.doc, t, r[i], se(r[i].line, r[i].ch + t.length));
        }
      }),
      t(
        'specialChars',
        /[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g,
        function (e, t, r) {
          (e.state.specialChars = new RegExp(
            t.source + (t.test('\t') ? '' : '|\t'),
            'g'
          )),
            r != ta && e.refresh();
        }
      ),
      t(
        'specialCharPlaceholder',
        ut,
        function (e) {
          return e.refresh();
        },
        !0
      ),
      t('electricChars', !0),
      t(
        'inputStyle',
        Hl ? 'contenteditable' : 'textarea',
        function () {
          throw new Error(
            'inputStyle can not (yet) be changed in a running editor'
          );
        },
        !0
      ),
      t(
        'spellcheck',
        !1,
        function (e, t) {
          return (e.getInputField().spellcheck = t);
        },
        !0
      ),
      t(
        'autocorrect',
        !1,
        function (e, t) {
          return (e.getInputField().autocorrect = t);
        },
        !0
      ),
      t(
        'autocapitalize',
        !1,
        function (e, t) {
          return (e.getInputField().autocapitalize = t);
        },
        !0
      ),
      t('rtlMoveVisually', !El),
      t('wholeLineUpdateBefore', !0),
      t(
        'theme',
        'default',
        function (e) {
          jo(e), En(e);
        },
        !0
      ),
      t('keyMap', 'default', function (e, t, r) {
        var n = fo(t),
          i = r != ta && fo(r);
        i && i.detach && i.detach(e, n), n.attach && n.attach(e, i || null);
      }),
      t('extraKeys', null),
      t('configureMouse', null),
      t('lineWrapping', !1, _o, !0),
      t(
        'gutters',
        [],
        function (e, t) {
          (e.display.gutterSpecs = Fn(t, e.options.lineNumbers)), En(e);
        },
        !0
      ),
      t(
        'fixedGutter',
        !0,
        function (e, t) {
          (e.display.gutters.style.left = t ? xr(e.display) + 'px' : '0'),
            e.refresh();
        },
        !0
      ),
      t(
        'coverGutterNextToScrollbar',
        !1,
        function (e) {
          return ln(e);
        },
        !0
      ),
      t(
        'scrollbarStyle',
        'native',
        function (e) {
          an(e),
            ln(e),
            e.display.scrollbars.setScrollTop(e.doc.scrollTop),
            e.display.scrollbars.setScrollLeft(e.doc.scrollLeft);
        },
        !0
      ),
      t(
        'lineNumbers',
        !1,
        function (e, t) {
          (e.display.gutterSpecs = Fn(e.options.gutters, t)), En(e);
        },
        !0
      ),
      t('firstLineNumber', 1, En, !0),
      t(
        'lineNumberFormatter',
        function (e) {
          return e;
        },
        En,
        !0
      ),
      t('showCursorWhenSelecting', !1, Wr, !0),
      t('resetSelectionOnContextMenu', !0),
      t('lineWiseCopyCut', !0),
      t('pasteLinesPerSelection', !0),
      t('selectionsMayTouch', !1),
      t('readOnly', !1, function (e, t) {
        'nocursor' == t && (Gr(e), e.display.input.blur()),
          e.display.input.readOnlyChanged(t);
      }),
      t('screenReaderLabel', null, function (e, t) {
        (t = '' === t ? null : t), e.display.input.screenReaderLabelChanged(t);
      }),
      t(
        'disableInput',
        !1,
        function (e, t) {
          t || e.display.input.reset();
        },
        !0
      ),
      t('dragDrop', !0, Yo),
      t('allowDropFileTypes', null),
      t('cursorBlinkRate', 530),
      t('cursorScrollMargin', 0),
      t('cursorHeight', 1, Wr, !0),
      t('singleCursorHeightPerLine', !0, Wr, !0),
      t('workTime', 100),
      t('workDelay', 100),
      t('flattenSpans', !0, $n, !0),
      t('addModeClass', !1, $n, !0),
      t('pollInterval', 100),
      t('undoDepth', 200, function (e, t) {
        return (e.doc.history.undoDepth = t);
      }),
      t('historyEventDelay', 1250),
      t(
        'viewportMargin',
        10,
        function (e) {
          return e.refresh();
        },
        !0
      ),
      t('maxHighlightLength', 1e4, $n, !0),
      t('moveInputWithCursor', !0, function (e, t) {
        t || e.display.input.resetPosition();
      }),
      t('tabindex', null, function (e, t) {
        return (e.display.input.getField().tabIndex = t || '');
      }),
      t('autofocus', null),
      t(
        'direction',
        'ltr',
        function (e, t) {
          return e.doc.setDirection(t);
        },
        !0
      ),
      t('phrases', null);
  }
  function Yo(e, t, r) {
    var n = r && r != ta;
    if (!t != !n) {
      var i = e.display.dragFunctions,
        o = t ? is : A;
      o(e.display.scroller, 'dragstart', i.start),
        o(e.display.scroller, 'dragenter', i.enter),
        o(e.display.scroller, 'dragover', i.over),
        o(e.display.scroller, 'dragleave', i.leave),
        o(e.display.scroller, 'drop', i.drop);
    }
  }
  function _o(e) {
    e.options.lineWrapping
      ? (s(e.display.wrapper, 'CodeMirror-wrap'),
        (e.display.sizer.style.minWidth = ''),
        (e.display.sizerWidth = null))
      : (Gl(e.display.wrapper, 'CodeMirror-wrap'), it(e)),
      Sr(e),
      Tr(e),
      tr(e),
      setTimeout(function () {
        return ln(e);
      }, 100);
  }
  function $o(e, t) {
    var r = this;
    if (!(this instanceof $o)) return new $o(e, t);
    (this.options = t = t ? c(t) : {}), c(ra, t, !1);
    var n = t.value;
    'string' == typeof n
      ? (n = new Bs(n, t.mode, null, t.lineSeparator, t.direction))
      : t.mode && (n.modeOption = t.mode),
      (this.doc = n);
    var i = new $o.inputStyles[t.inputStyle](this),
      o = (this.display = new In(e, n, i, t));
    for (var l in ((o.wrapper.CodeMirror = this),
    jo(this),
    t.lineWrapping && (this.display.wrapper.className += ' CodeMirror-wrap'),
    an(this),
    (this.state = {
      keyMaps: [],
      overlays: [],
      modeGen: 0,
      overwrite: !1,
      delayingBlurEvent: !1,
      focused: !1,
      suppressEdits: !1,
      pasteIncoming: -1,
      cutIncoming: -1,
      selectingText: !1,
      draggingText: !1,
      highlight: new Vl(),
      keySeq: null,
      specialChars: null,
    }),
    t.autofocus && !Hl && o.input.focus(),
    Cl &&
      Sl < 11 &&
      setTimeout(function () {
        return r.display.input.reset(!0);
      }, 20),
    qo(this),
    no(),
    un(this),
    (this.curOp.forceUpdate = !0),
    Jn(this, n),
    (t.autofocus && !Hl) || this.hasFocus()
      ? setTimeout(u(Br, this), 20)
      : Gr(this),
    na))
      na.hasOwnProperty(l) && na[l](r, t[l], ta);
    Hn(this), t.finishInit && t.finishInit(this);
    for (var s = 0; s < ia.length; ++s) ia[s](r);
    cn(this),
      Ll &&
        t.lineWrapping &&
        'optimizelegibility' == getComputedStyle(o.lineDiv).textRendering &&
        (o.lineDiv.style.textRendering = 'auto');
  }
  function qo(e) {
    function t() {
      i.activeTouch &&
        ((o = setTimeout(function () {
          return (i.activeTouch = null);
        }, 1e3)),
        (l = i.activeTouch),
        (l.end = +new Date()));
    }
    function r(e) {
      if (1 != e.touches.length) return !1;
      var t = e.touches[0];
      return t.radiusX <= 1 && t.radiusY <= 1;
    }
    function n(e, t) {
      if (null == t.left) return !0;
      var r = t.left - e.left,
        n = t.top - e.top;
      return r * r + n * n > 400;
    }
    var i = e.display;
    is(i.scroller, 'mousedown', yn(e, Ho)),
      is(
        i.scroller,
        'dblclick',
        Cl && Sl < 11
          ? yn(e, function (t) {
              if (!W(e, t)) {
                var r = Lr(e, t);
                if (r && !Uo(e, t) && !Pt(e.display, t)) {
                  E(t);
                  var n = e.findWordAt(r);
                  vi(e.doc, n.anchor, n.head);
                }
              }
            })
          : function (t) {
              return W(e, t) || E(t);
            }
      ),
      is(i.scroller, 'contextmenu', function (t) {
        return Vo(e, t);
      }),
      is(i.input.getField(), 'contextmenu', function (t) {
        i.scroller.contains(t.target) || Vo(e, t);
      });
    var o,
      l = { end: 0 };
    is(i.scroller, 'touchstart', function (t) {
      if (!W(e, t) && !r(t) && !Uo(e, t)) {
        i.input.ensurePolled(), clearTimeout(o);
        var n = +new Date();
        (i.activeTouch = {
          start: n,
          moved: !1,
          prev: n - l.end <= 300 ? l : null,
        }),
          1 == t.touches.length &&
            ((i.activeTouch.left = t.touches[0].pageX),
            (i.activeTouch.top = t.touches[0].pageY));
      }
    }),
      is(i.scroller, 'touchmove', function () {
        i.activeTouch && (i.activeTouch.moved = !0);
      }),
      is(i.scroller, 'touchend', function (r) {
        var o = i.activeTouch;
        if (
          o &&
          !Pt(i, r) &&
          null != o.left &&
          !o.moved &&
          new Date() - o.start < 300
        ) {
          var l,
            s = e.coordsChar(i.activeTouch, 'page');
          (l =
            !o.prev || n(o, o.prev)
              ? new Fs(s, s)
              : !o.prev.prev || n(o, o.prev.prev)
              ? e.findWordAt(s)
              : new Fs(se(s.line, 0), pe(e.doc, se(s.line + 1, 0)))),
            e.setSelection(l.anchor, l.head),
            e.focus(),
            E(r);
        }
        t();
      }),
      is(i.scroller, 'touchcancel', t),
      is(i.scroller, 'scroll', function () {
        i.scroller.clientHeight &&
          (tn(e, i.scroller.scrollTop),
          nn(e, i.scroller.scrollLeft, !0),
          D(e, 'scroll', e));
      }),
      is(i.scroller, 'mousewheel', function (t) {
        return Bn(e, t);
      }),
      is(i.scroller, 'DOMMouseScroll', function (t) {
        return Bn(e, t);
      }),
      is(i.wrapper, 'scroll', function () {
        return (i.wrapper.scrollTop = i.wrapper.scrollLeft = 0);
      }),
      (i.dragFunctions = {
        enter: function (t) {
          W(e, t) || R(t);
        },
        over: function (t) {
          W(e, t) || (eo(e, t), R(t));
        },
        start: function (t) {
          return Ji(e, t);
        },
        drop: yn(e, Qi),
        leave: function (t) {
          W(e, t) || to(e);
        },
      });
    var s = i.input.getField();
    is(s, 'keyup', function (t) {
      return Ao.call(e, t);
    }),
      is(s, 'keydown', yn(e, No)),
      is(s, 'keypress', yn(e, Do)),
      is(s, 'focus', function (t) {
        return Br(e, t);
      }),
      is(s, 'blur', function (t) {
        return Gr(e, t);
      });
  }
  function Zo(e, t, r, n) {
    var i,
      o = e.doc;
    null == r && (r = 'add'),
      'smart' == r && (o.mode.indent ? (i = be(e, t).state) : (r = 'prev'));
    var l = e.options.tabSize,
      s = J(o, t),
      a = h(s.text, null, l);
    s.stateAfter && (s.stateAfter = null);
    var u,
      c = s.text.match(/^\s*/)[0];
    if (n || /\S/.test(s.text)) {
      if (
        'smart' == r &&
        ((u = o.mode.indent(i, s.text.slice(c.length), s.text)),
        u == _l || u > 150)
      ) {
        if (!n) return;
        r = 'prev';
      }
    } else (u = 0), (r = 'not');
    'prev' == r
      ? (u = t > o.first ? h(J(o, t - 1).text, null, l) : 0)
      : 'add' == r
      ? (u = a + e.options.indentUnit)
      : 'subtract' == r
      ? (u = a - e.options.indentUnit)
      : 'number' == typeof r && (u = a + r),
      (u = Math.max(0, u));
    var f = '',
      d = 0;
    if (e.options.indentWithTabs)
      for (var g = Math.floor(u / l); g; --g) (d += l), (f += '\t');
    if ((d < u && (f += p(u - d)), f != c))
      return (
        zi(o, f, se(t, 0), se(t, c.length), '+input'), (s.stateAfter = null), !0
      );
    for (var v = 0; v < o.sel.ranges.length; v++) {
      var m = o.sel.ranges[v];
      if (m.head.line == t && m.head.ch < c.length) {
        var y = se(t, c.length);
        yi(o, v, new Fs(y, y));
        break;
      }
    }
  }
  function Qo(e) {
    oa = e;
  }
  function Jo(e, t, r, n, i) {
    var o = e.doc;
    (e.display.shift = !1), n || (n = o.sel);
    var l = +new Date() - 200,
      s = 'paste' == i || e.state.pasteIncoming > l,
      a = ls(t),
      u = null;
    if (s && n.ranges.length > 1)
      if (oa && oa.text.join('\n') == t) {
        if (n.ranges.length % oa.text.length == 0) {
          u = [];
          for (var c = 0; c < oa.text.length; c++)
            u.push(o.splitLines(oa.text[c]));
        }
      } else
        a.length == n.ranges.length &&
          e.options.pasteLinesPerSelection &&
          (u = v(a, function (e) {
            return [e];
          }));
    for (var h = e.curOp.updateInput, f = n.ranges.length - 1; f >= 0; f--) {
      var d = n.ranges[f],
        p = d.from(),
        m = d.to();
      d.empty() &&
        (r && r > 0
          ? (p = se(p.line, p.ch - r))
          : e.state.overwrite && !s
          ? (m = se(
              m.line,
              Math.min(J(o, m.line).text.length, m.ch + g(a).length)
            ))
          : s &&
            oa &&
            oa.lineWise &&
            oa.text.join('\n') == t &&
            (p = m = se(p.line, 0)));
      var y = {
        from: p,
        to: m,
        text: u ? u[f % u.length] : a,
        origin: i || (s ? 'paste' : e.state.cutIncoming > l ? 'cut' : '+input'),
      };
      Wi(e.doc, y), wt(e, 'inputRead', e, y);
    }
    t && !s && tl(e, t),
      qr(e),
      e.curOp.updateInput < 2 && (e.curOp.updateInput = h),
      (e.curOp.typing = !0),
      (e.state.pasteIncoming = e.state.cutIncoming = -1);
  }
  function el(e, t) {
    var r = e.clipboardData && e.clipboardData.getData('Text');
    if (r)
      return (
        e.preventDefault(),
        t.isReadOnly() ||
          t.options.disableInput ||
          mn(t, function () {
            return Jo(t, r, 0, null, 'paste');
          }),
        !0
      );
  }
  function tl(e, t) {
    if (e.options.electricChars && e.options.smartIndent)
      for (var r = e.doc.sel, n = r.ranges.length - 1; n >= 0; n--) {
        var i = r.ranges[n];
        if (
          !(i.head.ch > 100 || (n && r.ranges[n - 1].head.line == i.head.line))
        ) {
          var o = e.getModeAt(i.head),
            l = !1;
          if (o.electricChars) {
            for (var s = 0; s < o.electricChars.length; s++)
              if (t.indexOf(o.electricChars.charAt(s)) > -1) {
                l = Zo(e, i.head.line, 'smart');
                break;
              }
          } else
            o.electricInput &&
              o.electricInput.test(
                J(e.doc, i.head.line).text.slice(0, i.head.ch)
              ) &&
              (l = Zo(e, i.head.line, 'smart'));
          l && wt(e, 'electricInput', e, i.head.line);
        }
      }
  }
  function rl(e) {
    for (var t = [], r = [], n = 0; n < e.doc.sel.ranges.length; n++) {
      var i = e.doc.sel.ranges[n].head.line,
        o = { anchor: se(i, 0), head: se(i + 1, 0) };
      r.push(o), t.push(e.getRange(o.anchor, o.head));
    }
    return { text: t, ranges: r };
  }
  function nl(e, t, r, n) {
    e.setAttribute('autocorrect', r ? '' : 'off'),
      e.setAttribute('autocapitalize', n ? '' : 'off'),
      e.setAttribute('spellcheck', !!t);
  }
  function il() {
    var e = n(
        'textarea',
        null,
        null,
        'position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none'
      ),
      t = n(
        'div',
        [e],
        null,
        'overflow: hidden; position: relative; width: 3px; height: 0px;'
      );
    return (
      Ll ? (e.style.width = '1000px') : e.setAttribute('wrap', 'off'),
      Dl && (e.style.border = '1px solid black'),
      nl(e),
      t
    );
  }
  function ol(e) {
    var t = e.optionHandlers,
      r = (e.helpers = {});
    (e.prototype = {
      constructor: e,
      focus: function () {
        window.focus(), this.display.input.focus();
      },
      setOption: function (e, r) {
        var n = this.options,
          i = n[e];
        (n[e] == r && 'mode' != e) ||
          ((n[e] = r),
          t.hasOwnProperty(e) && yn(this, t[e])(this, r, i),
          D(this, 'optionChange', this, e));
      },
      getOption: function (e) {
        return this.options[e];
      },
      getDoc: function () {
        return this.doc;
      },
      addKeyMap: function (e, t) {
        this.state.keyMaps[t ? 'push' : 'unshift'](fo(e));
      },
      removeKeyMap: function (e) {
        for (var t = this.state.keyMaps, r = 0; r < t.length; ++r)
          if (t[r] == e || t[r].name == e) return t.splice(r, 1), !0;
      },
      addOverlay: bn(function (t, r) {
        var n = t.token ? t : e.getMode(this.options, t);
        if (n.startState) throw new Error('Overlays may not be stateful.');
        m(
          this.state.overlays,
          {
            mode: n,
            modeSpec: t,
            opaque: r && r.opaque,
            priority: (r && r.priority) || 0,
          },
          function (e) {
            return e.priority;
          }
        ),
          this.state.modeGen++,
          Tr(this);
      }),
      removeOverlay: bn(function (e) {
        for (var t = this, r = this.state.overlays, n = 0; n < r.length; ++n) {
          var i = r[n].modeSpec;
          if (i == e || ('string' == typeof e && i.name == e))
            return r.splice(n, 1), t.state.modeGen++, void Tr(t);
        }
      }),
      indentLine: bn(function (e, t, r) {
        'string' != typeof t &&
          'number' != typeof t &&
          (t =
            null == t
              ? this.options.smartIndent
                ? 'smart'
                : 'prev'
              : t
              ? 'add'
              : 'subtract'),
          oe(this.doc, e) && Zo(this, e, t, r);
      }),
      indentSelection: bn(function (e) {
        for (
          var t = this, r = this.doc.sel.ranges, n = -1, i = 0;
          i < r.length;
          i++
        ) {
          var o = r[i];
          if (o.empty())
            o.head.line > n &&
              (Zo(t, o.head.line, e, !0),
              (n = o.head.line),
              i == t.doc.sel.primIndex && qr(t));
          else {
            var l = o.from(),
              s = o.to(),
              a = Math.max(n, l.line);
            n = Math.min(t.lastLine(), s.line - (s.ch ? 0 : 1)) + 1;
            for (var u = a; u < n; ++u) Zo(t, u, e);
            var c = t.doc.sel.ranges;
            0 == l.ch &&
              r.length == c.length &&
              c[i].from().ch > 0 &&
              yi(t.doc, i, new Fs(l, c[i].to()), $l);
          }
        }
      }),
      getTokenAt: function (e, t) {
        return Se(this, e, t);
      },
      getLineTokens: function (e, t) {
        return Se(this, se(e), t, !0);
      },
      getTokenTypeAt: function (e) {
        e = pe(this.doc, e);
        var t,
          r = ye(this, J(this.doc, e.line)),
          n = 0,
          i = (r.length - 1) / 2,
          o = e.ch;
        if (0 == o) t = r[2];
        else
          for (;;) {
            var l = (n + i) >> 1;
            if ((l ? r[2 * l - 1] : 0) >= o) i = l;
            else {
              if (!(r[2 * l + 1] < o)) {
                t = r[2 * l + 2];
                break;
              }
              n = l + 1;
            }
          }
        var s = t ? t.indexOf('overlay ') : -1;
        return s < 0 ? t : 0 == s ? null : t.slice(0, s - 1);
      },
      getModeAt: function (t) {
        var r = this.doc.mode;
        return r.innerMode ? e.innerMode(r, this.getTokenAt(t).state).mode : r;
      },
      getHelper: function (e, t) {
        return this.getHelpers(e, t)[0];
      },
      getHelpers: function (e, t) {
        var n = this,
          i = [];
        if (!r.hasOwnProperty(t)) return i;
        var o = r[t],
          l = this.getModeAt(e);
        if ('string' == typeof l[t]) o[l[t]] && i.push(o[l[t]]);
        else if (l[t])
          for (var s = 0; s < l[t].length; s++) {
            var a = o[l[t][s]];
            a && i.push(a);
          }
        else
          l.helperType && o[l.helperType]
            ? i.push(o[l.helperType])
            : o[l.name] && i.push(o[l.name]);
        for (var u = 0; u < o._global.length; u++) {
          var c = o._global[u];
          c.pred(l, n) && -1 == f(i, c.val) && i.push(c.val);
        }
        return i;
      },
      getStateAfter: function (e, t) {
        var r = this.doc;
        return (
          (e = de(r, null == e ? r.first + r.size - 1 : e)),
          be(this, e + 1, t).state
        );
      },
      cursorCoords: function (e, t) {
        var r,
          n = this.doc.sel.primary();
        return (
          (r =
            null == e
              ? n.head
              : 'object' == typeof e
              ? pe(this.doc, e)
              : e
              ? n.from()
              : n.to()),
          ar(this, r, t || 'page')
        );
      },
      charCoords: function (e, t) {
        return sr(this, pe(this.doc, e), t || 'page');
      },
      coordsChar: function (e, t) {
        return (e = lr(this, e, t || 'page')), hr(this, e.left, e.top);
      },
      lineAtHeight: function (e, t) {
        return (
          (e = lr(this, { top: e, left: 0 }, t || 'page').top),
          ie(this.doc, e + this.display.viewOffset)
        );
      },
      heightAtLine: function (e, t, r) {
        var n,
          i = !1;
        if ('number' == typeof e) {
          var o = this.doc.first + this.doc.size - 1;
          e < this.doc.first
            ? (e = this.doc.first)
            : e > o && ((e = o), (i = !0)),
            (n = J(this.doc, e));
        } else n = e;
        return (
          or(this, n, { top: 0, left: 0 }, t || 'page', r || i).top +
          (i ? this.doc.height - rt(n) : 0)
        );
      },
      defaultTextHeight: function () {
        return yr(this.display);
      },
      defaultCharWidth: function () {
        return br(this.display);
      },
      getViewport: function () {
        return { from: this.display.viewFrom, to: this.display.viewTo };
      },
      addWidget: function (e, t, r, n, i) {
        var o = this.display;
        e = ar(this, pe(this.doc, e));
        var l = e.bottom,
          s = e.left;
        if (
          ((t.style.position = 'absolute'),
          t.setAttribute('cm-ignore-events', 'true'),
          this.display.input.setUneditable(t),
          o.sizer.appendChild(t),
          'over' == n)
        )
          l = e.top;
        else if ('above' == n || 'near' == n) {
          var a = Math.max(o.wrapper.clientHeight, this.doc.height),
            u = Math.max(o.sizer.clientWidth, o.lineSpace.clientWidth);
          ('above' == n || e.bottom + t.offsetHeight > a) &&
          e.top > t.offsetHeight
            ? (l = e.top - t.offsetHeight)
            : e.bottom + t.offsetHeight <= a && (l = e.bottom),
            s + t.offsetWidth > u && (s = u - t.offsetWidth);
        }
        (t.style.top = l + 'px'),
          (t.style.left = t.style.right = ''),
          'right' == i
            ? ((s = o.sizer.clientWidth - t.offsetWidth),
              (t.style.right = '0px'))
            : ('left' == i
                ? (s = 0)
                : 'middle' == i &&
                  (s = (o.sizer.clientWidth - t.offsetWidth) / 2),
              (t.style.left = s + 'px')),
          r &&
            Yr(this, {
              left: s,
              top: l,
              right: s + t.offsetWidth,
              bottom: l + t.offsetHeight,
            });
      },
      triggerOnKeyDown: bn(No),
      triggerOnKeyPress: bn(Do),
      triggerOnKeyUp: Ao,
      triggerOnMouseDown: bn(Ho),
      execCommand: function (e) {
        if (qs.hasOwnProperty(e)) return qs[e].call(null, this);
      },
      triggerElectric: bn(function (e) {
        tl(this, e);
      }),
      findPosH: function (e, t, r, n) {
        var i = this,
          o = 1;
        t < 0 && ((o = -1), (t = -t));
        for (
          var l = pe(this.doc, e), s = 0;
          s < t && ((l = ll(i.doc, l, o, r, n)), !l.hitSide);
          ++s
        );
        return l;
      },
      moveH: bn(function (e, t) {
        var r = this;
        this.extendSelectionsBy(function (n) {
          return r.display.shift || r.doc.extend || n.empty()
            ? ll(r.doc, n.head, e, t, r.options.rtlMoveVisually)
            : e < 0
            ? n.from()
            : n.to();
        }, Zl);
      }),
      deleteH: bn(function (e, t) {
        var r = this.doc.sel,
          n = this.doc;
        r.somethingSelected()
          ? n.replaceSelection('', null, '+delete')
          : po(this, function (r) {
              var i = ll(n, r.head, e, t, !1);
              return e < 0 ? { from: i, to: r.head } : { from: r.head, to: i };
            });
      }),
      findPosV: function (e, t, r, n) {
        var i = this,
          o = 1,
          l = n;
        t < 0 && ((o = -1), (t = -t));
        for (var s = pe(this.doc, e), a = 0; a < t; ++a) {
          var u = ar(i, s, 'div');
          if (
            (null == l ? (l = u.left) : (u.left = l),
            (s = sl(i, u, o, r)),
            s.hitSide)
          )
            break;
        }
        return s;
      },
      moveV: bn(function (e, t) {
        var r = this,
          n = this.doc,
          i = [],
          o = !this.display.shift && !n.extend && n.sel.somethingSelected();
        if (
          (n.extendSelectionsBy(function (l) {
            if (o) return e < 0 ? l.from() : l.to();
            var s = ar(r, l.head, 'div');
            null != l.goalColumn && (s.left = l.goalColumn), i.push(s.left);
            var a = sl(r, s, e, t);
            return (
              'page' == t &&
                l == n.sel.primary() &&
                $r(r, sr(r, a, 'div').top - s.top),
              a
            );
          }, Zl),
          i.length)
        )
          for (var l = 0; l < n.sel.ranges.length; l++)
            n.sel.ranges[l].goalColumn = i[l];
      }),
      findWordAt: function (e) {
        var t = this.doc,
          r = J(t, e.line).text,
          n = e.ch,
          i = e.ch;
        if (r) {
          var o = this.getHelper(e, 'wordChars');
          ('before' != e.sticky && i != r.length) || !n ? ++i : --n;
          for (
            var l = r.charAt(n),
              s = x(l, o)
                ? function (e) {
                    return x(e, o);
                  }
                : /\s/.test(l)
                ? function (e) {
                    return /\s/.test(e);
                  }
                : function (e) {
                    return !/\s/.test(e) && !x(e);
                  };
            n > 0 && s(r.charAt(n - 1));

          )
            --n;
          for (; i < r.length && s(r.charAt(i)); ) ++i;
        }
        return new Fs(se(e.line, n), se(e.line, i));
      },
      toggleOverwrite: function (e) {
        (null != e && e == this.state.overwrite) ||
          ((this.state.overwrite = !this.state.overwrite)
            ? s(this.display.cursorDiv, 'CodeMirror-overwrite')
            : Gl(this.display.cursorDiv, 'CodeMirror-overwrite'),
          D(this, 'overwriteToggle', this, this.state.overwrite));
      },
      hasFocus: function () {
        return this.display.input.getField() == l();
      },
      isReadOnly: function () {
        return !(!this.options.readOnly && !this.doc.cantEdit);
      },
      scrollTo: bn(function (e, t) {
        Zr(this, e, t);
      }),
      getScrollInfo: function () {
        var e = this.display.scroller;
        return {
          left: e.scrollLeft,
          top: e.scrollTop,
          height: e.scrollHeight - Rt(this) - this.display.barHeight,
          width: e.scrollWidth - Rt(this) - this.display.barWidth,
          clientHeight: Gt(this),
          clientWidth: Bt(this),
        };
      },
      scrollIntoView: bn(function (e, t) {
        null == e
          ? ((e = { from: this.doc.sel.primary().head, to: null }),
            null == t && (t = this.options.cursorScrollMargin))
          : 'number' == typeof e
          ? (e = { from: se(e, 0), to: null })
          : null == e.from && (e = { from: e, to: null }),
          e.to || (e.to = e.from),
          (e.margin = t || 0),
          null != e.from.line ? Qr(this, e) : en(this, e.from, e.to, e.margin);
      }),
      setSize: bn(function (e, t) {
        var r = this,
          n = function (e) {
            return 'number' == typeof e || /^\d+$/.test(String(e))
              ? e + 'px'
              : e;
          };
        null != e && (this.display.wrapper.style.width = n(e)),
          null != t && (this.display.wrapper.style.height = n(t)),
          this.options.lineWrapping && er(this);
        var i = this.display.viewFrom;
        this.doc.iter(i, this.display.viewTo, function (e) {
          if (e.widgets)
            for (var t = 0; t < e.widgets.length; t++)
              if (e.widgets[t].noHScroll) {
                Mr(r, i, 'widget');
                break;
              }
          ++i;
        }),
          (this.curOp.forceUpdate = !0),
          D(this, 'refresh', this);
      }),
      operation: function (e) {
        return mn(this, e);
      },
      startOperation: function () {
        return un(this);
      },
      endOperation: function () {
        return cn(this);
      },
      refresh: bn(function () {
        var e = this.display.cachedTextHeight;
        Tr(this),
          (this.curOp.forceUpdate = !0),
          tr(this),
          Zr(this, this.doc.scrollLeft, this.doc.scrollTop),
          An(this.display),
          (null == e ||
            Math.abs(e - yr(this.display)) > 0.5 ||
            this.options.lineWrapping) &&
            Sr(this),
          D(this, 'refresh', this);
      }),
      swapDoc: bn(function (e) {
        var t = this.doc;
        return (
          (t.cm = null),
          this.state.selectingText && this.state.selectingText(),
          Jn(this, e),
          tr(this),
          this.display.input.reset(),
          Zr(this, e.scrollLeft, e.scrollTop),
          (this.curOp.forceScroll = !0),
          wt(this, 'swapDoc', this, t),
          t
        );
      }),
      phrase: function (e) {
        var t = this.options.phrases;
        return t && Object.prototype.hasOwnProperty.call(t, e) ? t[e] : e;
      },
      getInputField: function () {
        return this.display.input.getField();
      },
      getWrapperElement: function () {
        return this.display.wrapper;
      },
      getScrollerElement: function () {
        return this.display.scroller;
      },
      getGutterElement: function () {
        return this.display.gutters;
      },
    }),
      P(e),
      (e.registerHelper = function (t, n, i) {
        r.hasOwnProperty(t) || (r[t] = e[t] = { _global: [] }), (r[t][n] = i);
      }),
      (e.registerGlobalHelper = function (t, n, i, o) {
        e.registerHelper(t, n, o), r[t]._global.push({ pred: i, val: o });
      });
  }
  function ll(e, t, r, n, i) {
    function o() {
      var r = t.line + c;
      return (
        !(r < e.first || r >= e.first + e.size) &&
        ((t = new se(r, t.ch, t.sticky)), (u = J(e, r)))
      );
    }
    function l(n) {
      var l;
      if (((l = i ? yo(e.cm, u, t, r) : vo(u, t, r)), null == l)) {
        if (n || !o()) return !1;
        t = mo(i, e.cm, u, t.line, c);
      } else t = l;
      return !0;
    }
    var s = t,
      a = r,
      u = J(e, t.line),
      c = i && 'rtl' == e.direction ? -r : r;
    if ('char' == n) l();
    else if ('column' == n) l(!0);
    else if ('word' == n || 'group' == n)
      for (
        var h = null,
          f = 'group' == n,
          d = e.cm && e.cm.getHelper(t, 'wordChars'),
          p = !0;
        !(r < 0) || l(!p);
        p = !1
      ) {
        var g = u.text.charAt(t.ch) || '\n',
          v = x(g, d)
            ? 'w'
            : f && '\n' == g
            ? 'n'
            : !f || /\s/.test(g)
            ? null
            : 'p';
        if ((!f || p || v || (v = 's'), h && h != v)) {
          r < 0 && ((r = 1), l(), (t.sticky = 'after'));
          break;
        }
        if ((v && (h = v), r > 0 && !l(!p))) break;
      }
    var m = Ni(e, t, s, a, !0);
    return ue(s, m) && (m.hitSide = !0), m;
  }
  function sl(e, t, r, n) {
    var i,
      o,
      l = e.doc,
      s = t.left;
    if ('page' == n) {
      var a = Math.min(
          e.display.wrapper.clientHeight,
          window.innerHeight || document.documentElement.clientHeight
        ),
        u = Math.max(a - 0.5 * yr(e.display), 3);
      i = (r > 0 ? t.bottom : t.top) + r * u;
    } else 'line' == n && (i = r > 0 ? t.bottom + 3 : t.top - 3);
    for (; (o = hr(e, s, i)), o.outside; ) {
      if (r < 0 ? i <= 0 : i >= l.height) {
        o.hitSide = !0;
        break;
      }
      i += 5 * r;
    }
    return o;
  }
  function al(e, t) {
    var r = Xt(e, t.line);
    if (!r || r.hidden) return null;
    var n = J(e.doc, t.line),
      i = Vt(r, n, t.line),
      o = N(n, e.doc.direction),
      l = 'left';
    if (o) {
      var s = M(o, t.ch);
      l = s % 2 ? 'right' : 'left';
    }
    var a = $t(i.map, t.ch, l);
    return (a.offset = 'right' == a.collapse ? a.end : a.start), a;
  }
  function ul(e) {
    for (var t = e; t; t = t.parentNode)
      if (/CodeMirror-gutter-wrapper/.test(t.className)) return !0;
    return !1;
  }
  function cl(e, t) {
    return t && (e.bad = !0), e;
  }
  function hl(e, t, r, n, i) {
    function o(e) {
      return function (t) {
        return t.id == e;
      };
    }
    function l() {
      c && ((u += h), f && (u += h), (c = f = !1));
    }
    function s(e) {
      e && (l(), (u += e));
    }
    function a(t) {
      if (1 == t.nodeType) {
        var r = t.getAttribute('cm-text');
        if (r) return void s(r);
        var u,
          d = t.getAttribute('cm-marker');
        if (d) {
          var p = e.findMarks(se(n, 0), se(i + 1, 0), o(+d));
          return void (
            p.length &&
            (u = p[0].find(0)) &&
            s(ee(e.doc, u.from, u.to).join(h))
          );
        }
        if ('false' == t.getAttribute('contenteditable')) return;
        var g = /^(pre|div|p|li|table|br)$/i.test(t.nodeName);
        if (!/^br$/i.test(t.nodeName) && 0 == t.textContent.length) return;
        g && l();
        for (var v = 0; v < t.childNodes.length; v++) a(t.childNodes[v]);
        /^(pre|p)$/i.test(t.nodeName) && (f = !0), g && (c = !0);
      } else 3 == t.nodeType && s(t.nodeValue.replace(/\u200b/g, '').replace(/\u00a0/g, ' '));
    }
    for (var u = '', c = !1, h = e.doc.lineSeparator(), f = !1; a(t), t != r; )
      (t = t.nextSibling), (f = !1);
    return u;
  }
  function fl(e, t, r) {
    var n;
    if (t == e.display.lineDiv) {
      if (((n = e.display.lineDiv.childNodes[r]), !n))
        return cl(e.clipPos(se(e.display.viewTo - 1)), !0);
      (t = null), (r = 0);
    } else
      for (n = t; ; n = n.parentNode) {
        if (!n || n == e.display.lineDiv) return null;
        if (n.parentNode && n.parentNode == e.display.lineDiv) break;
      }
    for (var i = 0; i < e.display.view.length; i++) {
      var o = e.display.view[i];
      if (o.node == n) return dl(o, t, r);
    }
  }
  function dl(e, t, r) {
    function n(t, r, n) {
      for (var i = -1; i < (h ? h.length : 0); i++)
        for (var o = i < 0 ? c.map : h[i], l = 0; l < o.length; l += 3) {
          var s = o[l + 2];
          if (s == t || s == r) {
            var a = ne(i < 0 ? e.line : e.rest[i]),
              u = o[l] + n;
            return (n < 0 || s != t) && (u = o[l + (n ? 1 : 0)]), se(a, u);
          }
        }
    }
    var i = e.text.firstChild,
      l = !1;
    if (!t || !o(i, t)) return cl(se(ne(e.line), 0), !0);
    if (t == i && ((l = !0), (t = i.childNodes[r]), (r = 0), !t)) {
      var s = e.rest ? g(e.rest) : e.line;
      return cl(se(ne(s), s.text.length), l);
    }
    var a = 3 == t.nodeType ? t : null,
      u = t;
    for (
      a ||
      1 != t.childNodes.length ||
      3 != t.firstChild.nodeType ||
      ((a = t.firstChild), r && (r = a.nodeValue.length));
      u.parentNode != i;

    )
      u = u.parentNode;
    var c = e.measure,
      h = c.maps,
      f = n(a, u, r);
    if (f) return cl(f, l);
    for (
      var d = u.nextSibling, p = a ? a.nodeValue.length - r : 0;
      d;
      d = d.nextSibling
    ) {
      if (((f = n(d, d.firstChild, 0)), f)) return cl(se(f.line, f.ch - p), l);
      p += d.textContent.length;
    }
    for (var v = u.previousSibling, m = r; v; v = v.previousSibling) {
      if (((f = n(v, v.firstChild, -1)), f)) return cl(se(f.line, f.ch + m), l);
      m += v.textContent.length;
    }
  }
  function pl(e, t) {
    function r() {
      e.value = a.getValue();
    }
    if (
      ((t = t ? c(t) : {}),
      (t.value = e.value),
      !t.tabindex && e.tabIndex && (t.tabindex = e.tabIndex),
      !t.placeholder && e.placeholder && (t.placeholder = e.placeholder),
      null == t.autofocus)
    ) {
      var n = l();
      t.autofocus =
        n == e || (null != e.getAttribute('autofocus') && n == document.body);
    }
    var i;
    if (e.form && (is(e.form, 'submit', r), !t.leaveSubmitMethodAlone)) {
      var o = e.form;
      i = o.submit;
      try {
        var s = (o.submit = function () {
          r(), (o.submit = i), o.submit(), (o.submit = s);
        });
      } catch (e) {}
    }
    (t.finishInit = function (n) {
      (n.save = r),
        (n.getTextArea = function () {
          return e;
        }),
        (n.toTextArea = function () {
          (n.toTextArea = isNaN),
            r(),
            e.parentNode.removeChild(n.getWrapperElement()),
            (e.style.display = ''),
            e.form &&
              (A(e.form, 'submit', r),
              t.leaveSubmitMethodAlone ||
                'function' != typeof e.form.submit ||
                (e.form.submit = i));
        });
    }),
      (e.style.display = 'none');
    var a = $o(function (t) {
      return e.parentNode.insertBefore(t, e.nextSibling);
    }, t);
    return a;
  }
  function gl(e) {
    (e.off = A),
      (e.on = is),
      (e.wheelEventPixels = Rn),
      (e.Doc = Bs),
      (e.splitLines = ls),
      (e.countColumn = h),
      (e.findColumn = d),
      (e.isWordChar = w),
      (e.Pass = _l),
      (e.signal = D),
      (e.Line = bs),
      (e.changeEnd = Vn),
      (e.scrollbarModel = Ns),
      (e.Pos = se),
      (e.cmpPos = ae),
      (e.modes = cs),
      (e.mimeModes = hs),
      (e.resolveMode = Y),
      (e.getMode = _),
      (e.modeExtensions = fs),
      (e.extendMode = $),
      (e.copyState = q),
      (e.startState = Q),
      (e.innerMode = Z),
      (e.commands = qs),
      (e.keyMap = Ys),
      (e.keyName = ho),
      (e.isModifierKey = uo),
      (e.lookupKey = ao),
      (e.normalizeKeyMap = so),
      (e.StringStream = ds),
      (e.SharedTextMarker = zs),
      (e.TextMarker = Is),
      (e.LineWidget = Ps),
      (e.e_preventDefault = E),
      (e.e_stopPropagation = I),
      (e.e_stop = R),
      (e.addClass = s),
      (e.contains = o),
      (e.rmClass = Gl),
      (e.keyNames = Vs);
  }
  var vl = navigator.userAgent,
    ml = navigator.platform,
    yl = /gecko\/\d/i.test(vl),
    bl = /MSIE \d/.test(vl),
    wl = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(vl),
    xl = /Edge\/(\d+)/.exec(vl),
    Cl = bl || wl || xl,
    Sl = Cl && (bl ? document.documentMode || 6 : +(xl || wl)[1]),
    Ll = !xl && /WebKit\//.test(vl),
    kl = Ll && /Qt\/\d+\.\d+/.test(vl),
    Tl = !xl && /Chrome\//.test(vl),
    Ml = /Opera\//.test(vl),
    Nl = /Apple Computer/.test(navigator.vendor),
    Ol = /Mac OS X 1\d\D([8-9]|\d\d)\D/.test(vl),
    Al = /PhantomJS/.test(vl),
    Dl = !xl && /AppleWebKit/.test(vl) && /Mobile\/\w+/.test(vl),
    Wl = /Android/.test(vl),
    Hl =
      Dl || Wl || /webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(vl),
    Fl = Dl || /Mac/.test(ml),
    Pl = /\bCrOS\b/.test(vl),
    El = /win/i.test(ml),
    Il = Ml && vl.match(/Version\/(\d*\.\d*)/);
  Il && (Il = Number(Il[1])), Il && Il >= 15 && ((Ml = !1), (Ll = !0));
  var zl,
    Rl = Fl && (kl || (Ml && (null == Il || Il < 12.11))),
    Bl = yl || (Cl && Sl >= 9),
    Gl = function (t, r) {
      var n = t.className,
        i = e(r).exec(n);
      if (i) {
        var o = n.slice(i.index + i[0].length);
        t.className = n.slice(0, i.index) + (o ? i[1] + o : '');
      }
    };
  zl = document.createRange
    ? function (e, t, r, n) {
        var i = document.createRange();
        return i.setEnd(n || e, r), i.setStart(e, t), i;
      }
    : function (e, t, r) {
        var n = document.body.createTextRange();
        try {
          n.moveToElementText(e.parentNode);
        } catch (e) {
          return n;
        }
        return (
          n.collapse(!0),
          n.moveEnd('character', r),
          n.moveStart('character', t),
          n
        );
      };
  var Ul = function (e) {
    e.select();
  };
  Dl
    ? (Ul = function (e) {
        (e.selectionStart = 0), (e.selectionEnd = e.value.length);
      })
    : Cl &&
      (Ul = function (e) {
        try {
          e.select();
        } catch (e) {}
      });
  var Vl = function () {
    (this.id = null),
      (this.f = null),
      (this.time = 0),
      (this.handler = u(this.onTimeout, this));
  };
  (Vl.prototype.onTimeout = function (e) {
    (e.id = 0),
      e.time <= +new Date()
        ? e.f()
        : setTimeout(e.handler, e.time - +new Date());
  }),
    (Vl.prototype.set = function (e, t) {
      this.f = t;
      var r = +new Date() + e;
      (!this.id || r < this.time) &&
        (clearTimeout(this.id),
        (this.id = setTimeout(this.handler, e)),
        (this.time = r));
    });
  var Kl,
    jl,
    Xl,
    Yl = 30,
    _l = {
      toString: function () {
        return 'CodeMirror.Pass';
      },
    },
    $l = { scroll: !1 },
    ql = { origin: '*mouse' },
    Zl = { origin: '+move' },
    Ql = [''],
    Jl = /[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,
    es = /[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,
    ts = null,
    rs = (function () {
      function e(e) {
        return e <= 247
          ? r.charAt(e)
          : 1424 <= e && e <= 1524
          ? 'R'
          : 1536 <= e && e <= 1785
          ? n.charAt(e - 1536)
          : 1774 <= e && e <= 2220
          ? 'r'
          : 8192 <= e && e <= 8203
          ? 'w'
          : 8204 == e
          ? 'b'
          : 'L';
      }
      function t(e, t, r) {
        (this.level = e), (this.from = t), (this.to = r);
      }
      var r =
          'bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN',
        n =
          'nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111',
        i = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,
        o = /[stwN]/,
        l = /[LRr]/,
        s = /[Lb1n]/,
        a = /[1n]/;
      return function (r, n) {
        var u = 'ltr' == n ? 'L' : 'R';
        if (0 == r.length || ('ltr' == n && !i.test(r))) return !1;
        for (var c = r.length, h = [], f = 0; f < c; ++f)
          h.push(e(r.charCodeAt(f)));
        for (var d = 0, p = u; d < c; ++d) {
          var v = h[d];
          'm' == v ? (h[d] = p) : (p = v);
        }
        for (var m = 0, y = u; m < c; ++m) {
          var b = h[m];
          '1' == b && 'r' == y
            ? (h[m] = 'n')
            : l.test(b) && ((y = b), 'r' == b && (h[m] = 'R'));
        }
        for (var w = 1, x = h[0]; w < c - 1; ++w) {
          var C = h[w];
          '+' == C && '1' == x && '1' == h[w + 1]
            ? (h[w] = '1')
            : ',' != C || x != h[w + 1] || ('1' != x && 'n' != x) || (h[w] = x),
            (x = C);
        }
        for (var S = 0; S < c; ++S) {
          var L = h[S];
          if (',' == L) h[S] = 'N';
          else if ('%' == L) {
            var k = void 0;
            for (k = S + 1; k < c && '%' == h[k]; ++k);
            for (
              var T =
                  (S && '!' == h[S - 1]) || (k < c && '1' == h[k]) ? '1' : 'N',
                M = S;
              M < k;
              ++M
            )
              h[M] = T;
            S = k - 1;
          }
        }
        for (var N = 0, O = u; N < c; ++N) {
          var A = h[N];
          'L' == O && '1' == A ? (h[N] = 'L') : l.test(A) && (O = A);
        }
        for (var D = 0; D < c; ++D)
          if (o.test(h[D])) {
            var W = void 0;
            for (W = D + 1; W < c && o.test(h[W]); ++W);
            for (
              var H = 'L' == (D ? h[D - 1] : u),
                F = 'L' == (W < c ? h[W] : u),
                P = H == F ? (H ? 'L' : 'R') : u,
                E = D;
              E < W;
              ++E
            )
              h[E] = P;
            D = W - 1;
          }
        for (var I, z = [], R = 0; R < c; )
          if (s.test(h[R])) {
            var B = R;
            for (++R; R < c && s.test(h[R]); ++R);
            z.push(new t(0, B, R));
          } else {
            var G = R,
              U = z.length,
              V = 'rtl' == n ? 1 : 0;
            for (++R; R < c && 'L' != h[R]; ++R);
            for (var K = G; K < R; )
              if (a.test(h[K])) {
                G < K && (z.splice(U, 0, new t(1, G, K)), (U += V));
                var j = K;
                for (++K; K < R && a.test(h[K]); ++K);
                z.splice(U, 0, new t(2, j, K)), (U += V), (G = K);
              } else ++K;
            G < R && z.splice(U, 0, new t(1, G, R));
          }
        return (
          'ltr' == n &&
            (1 == z[0].level &&
              (I = r.match(/^\s+/)) &&
              ((z[0].from = I[0].length), z.unshift(new t(0, 0, I[0].length))),
            1 == g(z).level &&
              (I = r.match(/\s+$/)) &&
              ((g(z).to -= I[0].length), z.push(new t(0, c - I[0].length, c)))),
          'rtl' == n ? z.reverse() : z
        );
      };
    })(),
    ns = [],
    is = function (e, t, r) {
      if (e.addEventListener) e.addEventListener(t, r, !1);
      else if (e.attachEvent) e.attachEvent('on' + t, r);
      else {
        var n = e._handlers || (e._handlers = {});
        n[t] = (n[t] || ns).concat(r);
      }
    },
    os = (function () {
      if (Cl && Sl < 9) return !1;
      var e = n('div');
      return 'draggable' in e || 'dragDrop' in e;
    })(),
    ls =
      3 != '\n\nb'.split(/\n/).length
        ? function (e) {
            for (var t = 0, r = [], n = e.length; t <= n; ) {
              var i = e.indexOf('\n', t);
              -1 == i && (i = e.length);
              var o = e.slice(t, '\r' == e.charAt(i - 1) ? i - 1 : i),
                l = o.indexOf('\r');
              -1 != l
                ? (r.push(o.slice(0, l)), (t += l + 1))
                : (r.push(o), (t = i + 1));
            }
            return r;
          }
        : function (e) {
            return e.split(/\r\n?|\n/);
          },
    ss = window.getSelection
      ? function (e) {
          try {
            return e.selectionStart != e.selectionEnd;
          } catch (e) {
            return !1;
          }
        }
      : function (e) {
          var t;
          try {
            t = e.ownerDocument.selection.createRange();
          } catch (e) {}
          return (
            !(!t || t.parentElement() != e) &&
            0 != t.compareEndPoints('StartToEnd', t)
          );
        },
    as =
      ((Xl = n('div')),
      'oncopy' in Xl ||
        (Xl.setAttribute('oncopy', 'return;'), 'function' == typeof Xl.oncopy)),
    us = null,
    cs = {},
    hs = {},
    fs = {},
    ds = function (e, t, r) {
      (this.pos = this.start = 0),
        (this.string = e),
        (this.tabSize = t || 8),
        (this.lastColumnPos = this.lastColumnValue = 0),
        (this.lineStart = 0),
        (this.lineOracle = r);
    };
  (ds.prototype.eol = function () {
    return this.pos >= this.string.length;
  }),
    (ds.prototype.sol = function () {
      return this.pos == this.lineStart;
    }),
    (ds.prototype.peek = function () {
      return this.string.charAt(this.pos) || void 0;
    }),
    (ds.prototype.next = function () {
      if (this.pos < this.string.length) return this.string.charAt(this.pos++);
    }),
    (ds.prototype.eat = function (e) {
      var t,
        r = this.string.charAt(this.pos);
      if (
        ((t = 'string' == typeof e ? r == e : r && (e.test ? e.test(r) : e(r))),
        t)
      )
        return ++this.pos, r;
    }),
    (ds.prototype.eatWhile = function (e) {
      for (var t = this.pos; this.eat(e); );
      return this.pos > t;
    }),
    (ds.prototype.eatSpace = function () {
      for (
        var e = this, t = this.pos;
        /[\s\u00a0]/.test(this.string.charAt(this.pos));

      )
        ++e.pos;
      return this.pos > t;
    }),
    (ds.prototype.skipToEnd = function () {
      this.pos = this.string.length;
    }),
    (ds.prototype.skipTo = function (e) {
      var t = this.string.indexOf(e, this.pos);
      if (t > -1) return (this.pos = t), !0;
    }),
    (ds.prototype.backUp = function (e) {
      this.pos -= e;
    }),
    (ds.prototype.column = function () {
      return (
        this.lastColumnPos < this.start &&
          ((this.lastColumnValue = h(
            this.string,
            this.start,
            this.tabSize,
            this.lastColumnPos,
            this.lastColumnValue
          )),
          (this.lastColumnPos = this.start)),
        this.lastColumnValue -
          (this.lineStart ? h(this.string, this.lineStart, this.tabSize) : 0)
      );
    }),
    (ds.prototype.indentation = function () {
      return (
        h(this.string, null, this.tabSize) -
        (this.lineStart ? h(this.string, this.lineStart, this.tabSize) : 0)
      );
    }),
    (ds.prototype.match = function (e, t, r) {
      if ('string' != typeof e) {
        var n = this.string.slice(this.pos).match(e);
        return n && n.index > 0
          ? null
          : (n && !1 !== t && (this.pos += n[0].length), n);
      }
      var i = function (e) {
          return r ? e.toLowerCase() : e;
        },
        o = this.string.substr(this.pos, e.length);
      if (i(o) == i(e)) return !1 !== t && (this.pos += e.length), !0;
    }),
    (ds.prototype.current = function () {
      return this.string.slice(this.start, this.pos);
    }),
    (ds.prototype.hideFirstChars = function (e, t) {
      this.lineStart += e;
      try {
        return t();
      } finally {
        this.lineStart -= e;
      }
    }),
    (ds.prototype.lookAhead = function (e) {
      var t = this.lineOracle;
      return t && t.lookAhead(e);
    }),
    (ds.prototype.baseToken = function () {
      var e = this.lineOracle;
      return e && e.baseToken(this.pos);
    });
  var ps = function (e, t) {
      (this.state = e), (this.lookAhead = t);
    },
    gs = function (e, t, r, n) {
      (this.state = t),
        (this.doc = e),
        (this.line = r),
        (this.maxLookAhead = n || 0),
        (this.baseTokens = null),
        (this.baseTokenPos = 1);
    };
  (gs.prototype.lookAhead = function (e) {
    var t = this.doc.getLine(this.line + e);
    return null != t && e > this.maxLookAhead && (this.maxLookAhead = e), t;
  }),
    (gs.prototype.baseToken = function (e) {
      var t = this;
      if (!this.baseTokens) return null;
      for (; this.baseTokens[this.baseTokenPos] <= e; ) t.baseTokenPos += 2;
      var r = this.baseTokens[this.baseTokenPos + 1];
      return {
        type: r && r.replace(/( |^)overlay .*/, ''),
        size: this.baseTokens[this.baseTokenPos] - e,
      };
    }),
    (gs.prototype.nextLine = function () {
      this.line++, this.maxLookAhead > 0 && this.maxLookAhead--;
    }),
    (gs.fromSaved = function (e, t, r) {
      return t instanceof ps
        ? new gs(e, q(e.mode, t.state), r, t.lookAhead)
        : new gs(e, q(e.mode, t), r);
    }),
    (gs.prototype.save = function (e) {
      var t = !1 !== e ? q(this.doc.mode, this.state) : this.state;
      return this.maxLookAhead > 0 ? new ps(t, this.maxLookAhead) : t;
    });
  var vs = function (e, t, r) {
      (this.start = e.start),
        (this.end = e.pos),
        (this.string = e.current()),
        (this.type = t || null),
        (this.state = r);
    },
    ms = !1,
    ys = !1,
    bs = function (e, t, r) {
      (this.text = e), Be(this, t), (this.height = r ? r(this) : 1);
    };
  (bs.prototype.lineNo = function () {
    return ne(this);
  }),
    P(bs);
  var ws,
    xs = {},
    Cs = {},
    Ss = null,
    Ls = null,
    ks = { left: 0, right: 0, top: 0, bottom: 0 },
    Ts = function (e, t, r) {
      this.cm = r;
      var i = (this.vert = n(
          'div',
          [n('div', null, null, 'min-width: 1px')],
          'CodeMirror-vscrollbar'
        )),
        o = (this.horiz = n(
          'div',
          [n('div', null, null, 'height: 100%; min-height: 1px')],
          'CodeMirror-hscrollbar'
        ));
      (i.tabIndex = o.tabIndex = -1),
        e(i),
        e(o),
        is(i, 'scroll', function () {
          i.clientHeight && t(i.scrollTop, 'vertical');
        }),
        is(o, 'scroll', function () {
          o.clientWidth && t(o.scrollLeft, 'horizontal');
        }),
        (this.checkedZeroWidth = !1),
        Cl &&
          Sl < 8 &&
          (this.horiz.style.minHeight = this.vert.style.minWidth = '18px');
    };
  (Ts.prototype.update = function (e) {
    var t = e.scrollWidth > e.clientWidth + 1,
      r = e.scrollHeight > e.clientHeight + 1,
      n = e.nativeBarWidth;
    if (r) {
      (this.vert.style.display = 'block'),
        (this.vert.style.bottom = t ? n + 'px' : '0');
      var i = e.viewHeight - (t ? n : 0);
      this.vert.firstChild.style.height =
        Math.max(0, e.scrollHeight - e.clientHeight + i) + 'px';
    } else
      (this.vert.style.display = ''), (this.vert.firstChild.style.height = '0');
    if (t) {
      (this.horiz.style.display = 'block'),
        (this.horiz.style.right = r ? n + 'px' : '0'),
        (this.horiz.style.left = e.barLeft + 'px');
      var o = e.viewWidth - e.barLeft - (r ? n : 0);
      this.horiz.firstChild.style.width =
        Math.max(0, e.scrollWidth - e.clientWidth + o) + 'px';
    } else
      (this.horiz.style.display = ''),
        (this.horiz.firstChild.style.width = '0');
    return (
      !this.checkedZeroWidth &&
        e.clientHeight > 0 &&
        (0 == n && this.zeroWidthHack(), (this.checkedZeroWidth = !0)),
      { right: r ? n : 0, bottom: t ? n : 0 }
    );
  }),
    (Ts.prototype.setScrollLeft = function (e) {
      this.horiz.scrollLeft != e && (this.horiz.scrollLeft = e),
        this.disableHoriz &&
          this.enableZeroWidthBar(this.horiz, this.disableHoriz, 'horiz');
    }),
    (Ts.prototype.setScrollTop = function (e) {
      this.vert.scrollTop != e && (this.vert.scrollTop = e),
        this.disableVert &&
          this.enableZeroWidthBar(this.vert, this.disableVert, 'vert');
    }),
    (Ts.prototype.zeroWidthHack = function () {
      var e = Fl && !Ol ? '12px' : '18px';
      (this.horiz.style.height = this.vert.style.width = e),
        (this.horiz.style.pointerEvents = this.vert.style.pointerEvents =
          'none'),
        (this.disableHoriz = new Vl()),
        (this.disableVert = new Vl());
    }),
    (Ts.prototype.enableZeroWidthBar = function (e, t, r) {
      function n() {
        var i = e.getBoundingClientRect(),
          o =
            'vert' == r
              ? document.elementFromPoint(i.right - 1, (i.top + i.bottom) / 2)
              : document.elementFromPoint((i.right + i.left) / 2, i.bottom - 1);
        o != e ? (e.style.pointerEvents = 'none') : t.set(1e3, n);
      }
      (e.style.pointerEvents = 'auto'), t.set(1e3, n);
    }),
    (Ts.prototype.clear = function () {
      var e = this.horiz.parentNode;
      e.removeChild(this.horiz), e.removeChild(this.vert);
    });
  var Ms = function () {};
  (Ms.prototype.update = function () {
    return { bottom: 0, right: 0 };
  }),
    (Ms.prototype.setScrollLeft = function () {}),
    (Ms.prototype.setScrollTop = function () {}),
    (Ms.prototype.clear = function () {});
  var Ns = { native: Ts, null: Ms },
    Os = 0,
    As = function (e, t, r) {
      var n = e.display;
      (this.viewport = t),
        (this.visible = Kr(n, e.doc, t)),
        (this.editorIsHidden = !n.wrapper.offsetWidth),
        (this.wrapperHeight = n.wrapper.clientHeight),
        (this.wrapperWidth = n.wrapper.clientWidth),
        (this.oldDisplayWidth = Bt(e)),
        (this.force = r),
        (this.dims = wr(e)),
        (this.events = []);
    };
  (As.prototype.signal = function (e, t) {
    F(e, t) && this.events.push(arguments);
  }),
    (As.prototype.finish = function () {
      for (var e = this, t = 0; t < this.events.length; t++)
        D.apply(null, e.events[t]);
    });
  var Ds = 0,
    Ws = null;
  Cl ? (Ws = -0.53) : yl ? (Ws = 15) : Tl ? (Ws = -0.7) : Nl && (Ws = -1 / 3);
  var Hs = function (e, t) {
    (this.ranges = e), (this.primIndex = t);
  };
  (Hs.prototype.primary = function () {
    return this.ranges[this.primIndex];
  }),
    (Hs.prototype.equals = function (e) {
      var t = this;
      if (e == this) return !0;
      if (
        e.primIndex != this.primIndex ||
        e.ranges.length != this.ranges.length
      )
        return !1;
      for (var r = 0; r < this.ranges.length; r++) {
        var n = t.ranges[r],
          i = e.ranges[r];
        if (!ue(n.anchor, i.anchor) || !ue(n.head, i.head)) return !1;
      }
      return !0;
    }),
    (Hs.prototype.deepCopy = function () {
      for (var e = this, t = [], r = 0; r < this.ranges.length; r++)
        t[r] = new Fs(ce(e.ranges[r].anchor), ce(e.ranges[r].head));
      return new Hs(t, this.primIndex);
    }),
    (Hs.prototype.somethingSelected = function () {
      for (var e = this, t = 0; t < this.ranges.length; t++)
        if (!e.ranges[t].empty()) return !0;
      return !1;
    }),
    (Hs.prototype.contains = function (e, t) {
      var r = this;
      t || (t = e);
      for (var n = 0; n < this.ranges.length; n++) {
        var i = r.ranges[n];
        if (ae(t, i.from()) >= 0 && ae(e, i.to()) <= 0) return n;
      }
      return -1;
    });
  var Fs = function (e, t) {
    (this.anchor = e), (this.head = t);
  };
  (Fs.prototype.from = function () {
    return fe(this.anchor, this.head);
  }),
    (Fs.prototype.to = function () {
      return he(this.anchor, this.head);
    }),
    (Fs.prototype.empty = function () {
      return (
        this.head.line == this.anchor.line && this.head.ch == this.anchor.ch
      );
    }),
    (Vi.prototype = {
      chunkSize: function () {
        return this.lines.length;
      },
      removeInner: function (e, t) {
        for (var r = this, n = e, i = e + t; n < i; ++n) {
          var o = r.lines[n];
          (r.height -= o.height), lt(o), wt(o, 'delete');
        }
        this.lines.splice(e, t);
      },
      collapse: function (e) {
        e.push.apply(e, this.lines);
      },
      insertInner: function (e, t, r) {
        var n = this;
        (this.height += r),
          (this.lines = this.lines
            .slice(0, e)
            .concat(t)
            .concat(this.lines.slice(e)));
        for (var i = 0; i < t.length; ++i) t[i].parent = n;
      },
      iterN: function (e, t, r) {
        for (var n = this, i = e + t; e < i; ++e) if (r(n.lines[e])) return !0;
      },
    }),
    (Ki.prototype = {
      chunkSize: function () {
        return this.size;
      },
      removeInner: function (e, t) {
        var r = this;
        this.size -= t;
        for (var n = 0; n < this.children.length; ++n) {
          var i = r.children[n],
            o = i.chunkSize();
          if (e < o) {
            var l = Math.min(t, o - e),
              s = i.height;
            if (
              (i.removeInner(e, l),
              (r.height -= s - i.height),
              o == l && (r.children.splice(n--, 1), (i.parent = null)),
              0 == (t -= l))
            )
              break;
            e = 0;
          } else e -= o;
        }
        if (
          this.size - t < 25 &&
          (this.children.length > 1 || !(this.children[0] instanceof Vi))
        ) {
          var a = [];
          this.collapse(a),
            (this.children = [new Vi(a)]),
            (this.children[0].parent = this);
        }
      },
      collapse: function (e) {
        for (var t = this, r = 0; r < this.children.length; ++r)
          t.children[r].collapse(e);
      },
      insertInner: function (e, t, r) {
        var n = this;
        (this.size += t.length), (this.height += r);
        for (var i = 0; i < this.children.length; ++i) {
          var o = n.children[i],
            l = o.chunkSize();
          if (e <= l) {
            if ((o.insertInner(e, t, r), o.lines && o.lines.length > 50)) {
              for (
                var s = (o.lines.length % 25) + 25, a = s;
                a < o.lines.length;

              ) {
                var u = new Vi(o.lines.slice(a, (a += 25)));
                (o.height -= u.height),
                  n.children.splice(++i, 0, u),
                  (u.parent = n);
              }
              (o.lines = o.lines.slice(0, s)), n.maybeSpill();
            }
            break;
          }
          e -= l;
        }
      },
      maybeSpill: function () {
        if (!(this.children.length <= 10)) {
          var e = this;
          do {
            var t = e.children.splice(e.children.length - 5, 5),
              r = new Ki(t);
            if (e.parent) {
              (e.size -= r.size), (e.height -= r.height);
              var n = f(e.parent.children, e);
              e.parent.children.splice(n + 1, 0, r);
            } else {
              var i = new Ki(e.children);
              (i.parent = e), (e.children = [i, r]), (e = i);
            }
            r.parent = e.parent;
          } while (e.children.length > 10);
          e.parent.maybeSpill();
        }
      },
      iterN: function (e, t, r) {
        for (var n = this, i = 0; i < this.children.length; ++i) {
          var o = n.children[i],
            l = o.chunkSize();
          if (e < l) {
            var s = Math.min(t, l - e);
            if (o.iterN(e, s, r)) return !0;
            if (0 == (t -= s)) break;
            e = 0;
          } else e -= l;
        }
      },
    });
  var Ps = function (e, t, r) {
    var n = this;
    if (r) for (var i in r) r.hasOwnProperty(i) && (n[i] = r[i]);
    (this.doc = e), (this.node = t);
  };
  (Ps.prototype.clear = function () {
    var e = this,
      t = this.doc.cm,
      r = this.line.widgets,
      n = this.line,
      i = ne(n);
    if (null != i && r) {
      for (var o = 0; o < r.length; ++o) r[o] == e && r.splice(o--, 1);
      r.length || (n.widgets = null);
      var l = Ft(this);
      re(n, Math.max(0, n.height - l)),
        t &&
          (mn(t, function () {
            ji(t, n, -l), Mr(t, i, 'widget');
          }),
          wt(t, 'lineWidgetCleared', t, this, i));
    }
  }),
    (Ps.prototype.changed = function () {
      var e = this,
        t = this.height,
        r = this.doc.cm,
        n = this.line;
      this.height = null;
      var i = Ft(this) - t;
      i &&
        (et(this.doc, n) || re(n, n.height + i),
        r &&
          mn(r, function () {
            (r.curOp.forceUpdate = !0),
              ji(r, n, i),
              wt(r, 'lineWidgetChanged', r, e, ne(n));
          }));
    }),
    P(Ps);
  var Es = 0,
    Is = function (e, t) {
      (this.lines = []), (this.type = t), (this.doc = e), (this.id = ++Es);
    };
  (Is.prototype.clear = function () {
    var e = this;
    if (!this.explicitlyCleared) {
      var t = this.doc.cm,
        r = t && !t.curOp;
      if ((r && un(t), F(this, 'clear'))) {
        var n = this.find();
        n && wt(this, 'clear', n.from, n.to);
      }
      for (var i = null, o = null, l = 0; l < this.lines.length; ++l) {
        var s = e.lines[l],
          a = De(s.markedSpans, e);
        t && !e.collapsed
          ? Mr(t, ne(s), 'text')
          : t && (null != a.to && (o = ne(s)), null != a.from && (i = ne(s))),
          (s.markedSpans = We(s.markedSpans, a)),
          null == a.from &&
            e.collapsed &&
            !et(e.doc, s) &&
            t &&
            re(s, yr(t.display));
      }
      if (t && this.collapsed && !t.options.lineWrapping)
        for (var u = 0; u < this.lines.length; ++u) {
          var c = $e(e.lines[u]),
            h = nt(c);
          h > t.display.maxLineLength &&
            ((t.display.maxLine = c),
            (t.display.maxLineLength = h),
            (t.display.maxLineChanged = !0));
        }
      null != i && t && this.collapsed && Tr(t, i, o + 1),
        (this.lines.length = 0),
        (this.explicitlyCleared = !0),
        this.atomic &&
          this.doc.cantEdit &&
          ((this.doc.cantEdit = !1), t && ki(t.doc)),
        t && wt(t, 'markerCleared', t, this, i, o),
        r && cn(t),
        this.parent && this.parent.clear();
    }
  }),
    (Is.prototype.find = function (e, t) {
      var r,
        n,
        i = this;
      null == e && 'bookmark' == this.type && (e = 1);
      for (var o = 0; o < this.lines.length; ++o) {
        var l = i.lines[o],
          s = De(l.markedSpans, i);
        if (null != s.from && ((r = se(t ? l : ne(l), s.from)), -1 == e))
          return r;
        if (null != s.to && ((n = se(t ? l : ne(l), s.to)), 1 == e)) return n;
      }
      return r && { from: r, to: n };
    }),
    (Is.prototype.changed = function () {
      var e = this,
        t = this.find(-1, !0),
        r = this,
        n = this.doc.cm;
      t &&
        n &&
        mn(n, function () {
          var i = t.line,
            o = ne(t.line),
            l = Xt(n, o);
          if (
            (l &&
              (Jt(l), (n.curOp.selectionChanged = n.curOp.forceUpdate = !0)),
            (n.curOp.updateMaxLine = !0),
            !et(r.doc, i) && null != r.height)
          ) {
            var s = r.height;
            r.height = null;
            var a = Ft(r) - s;
            a && re(i, i.height + a);
          }
          wt(n, 'markerChanged', n, e);
        });
    }),
    (Is.prototype.attachLine = function (e) {
      if (!this.lines.length && this.doc.cm) {
        var t = this.doc.cm.curOp;
        (t.maybeHiddenMarkers && -1 != f(t.maybeHiddenMarkers, this)) ||
          (t.maybeUnhiddenMarkers || (t.maybeUnhiddenMarkers = [])).push(this);
      }
      this.lines.push(e);
    }),
    (Is.prototype.detachLine = function (e) {
      if (
        (this.lines.splice(f(this.lines, e), 1),
        !this.lines.length && this.doc.cm)
      ) {
        var t = this.doc.cm.curOp;
        (t.maybeHiddenMarkers || (t.maybeHiddenMarkers = [])).push(this);
      }
    }),
    P(Is);
  var zs = function (e, t) {
    var r = this;
    (this.markers = e), (this.primary = t);
    for (var n = 0; n < e.length; ++n) e[n].parent = r;
  };
  (zs.prototype.clear = function () {
    var e = this;
    if (!this.explicitlyCleared) {
      this.explicitlyCleared = !0;
      for (var t = 0; t < this.markers.length; ++t) e.markers[t].clear();
      wt(this, 'clear');
    }
  }),
    (zs.prototype.find = function (e, t) {
      return this.primary.find(e, t);
    }),
    P(zs);
  var Rs = 0,
    Bs = function (e, t, r, n, i) {
      if (!(this instanceof Bs)) return new Bs(e, t, r, n, i);
      null == r && (r = 0),
        Ki.call(this, [new Vi([new bs('', null)])]),
        (this.first = r),
        (this.scrollTop = this.scrollLeft = 0),
        (this.cantEdit = !1),
        (this.cleanGeneration = 1),
        (this.modeFrontier = this.highlightFrontier = r);
      var o = se(r, 0);
      (this.sel = Un(o)),
        (this.history = new ri(null)),
        (this.id = ++Rs),
        (this.modeOption = t),
        (this.lineSep = n),
        (this.direction = 'rtl' == i ? 'rtl' : 'ltr'),
        (this.extend = !1),
        'string' == typeof e && (e = this.splitLines(e)),
        Zn(this, { from: o, to: o, text: e }),
        Ci(this, Un(o), $l);
    };
  (Bs.prototype = b(Ki.prototype, {
    constructor: Bs,
    iter: function (e, t, r) {
      r
        ? this.iterN(e - this.first, t - e, r)
        : this.iterN(this.first, this.first + this.size, e);
    },
    insert: function (e, t) {
      for (var r = 0, n = 0; n < t.length; ++n) r += t[n].height;
      this.insertInner(e - this.first, t, r);
    },
    remove: function (e, t) {
      this.removeInner(e - this.first, t);
    },
    getValue: function (e) {
      var t = te(this, this.first, this.first + this.size);
      return !1 === e ? t : t.join(e || this.lineSeparator());
    },
    setValue: wn(function (e) {
      var t = se(this.first, 0),
        r = this.first + this.size - 1;
      Wi(
        this,
        {
          from: t,
          to: se(r, J(this, r).text.length),
          text: this.splitLines(e),
          origin: 'setValue',
          full: !0,
        },
        !0
      ),
        this.cm && Zr(this.cm, 0, 0),
        Ci(this, Un(t), $l);
    }),
    replaceRange: function (e, t, r, n) {
      (t = pe(this, t)), (r = r ? pe(this, r) : t), zi(this, e, t, r, n);
    },
    getRange: function (e, t, r) {
      var n = ee(this, pe(this, e), pe(this, t));
      return !1 === r ? n : n.join(r || this.lineSeparator());
    },
    getLine: function (e) {
      var t = this.getLineHandle(e);
      return t && t.text;
    },
    getLineHandle: function (e) {
      if (oe(this, e)) return J(this, e);
    },
    getLineNumber: function (e) {
      return ne(e);
    },
    getLineHandleVisualStart: function (e) {
      return 'number' == typeof e && (e = J(this, e)), $e(e);
    },
    lineCount: function () {
      return this.size;
    },
    firstLine: function () {
      return this.first;
    },
    lastLine: function () {
      return this.first + this.size - 1;
    },
    clipPos: function (e) {
      return pe(this, e);
    },
    getCursor: function (e) {
      var t,
        r = this.sel.primary();
      return (
        (t =
          null == e || 'head' == e
            ? r.head
            : 'anchor' == e
            ? r.anchor
            : 'end' == e || 'to' == e || !1 === e
            ? r.to()
            : r.from()),
        t
      );
    },
    listSelections: function () {
      return this.sel.ranges;
    },
    somethingSelected: function () {
      return this.sel.somethingSelected();
    },
    setCursor: wn(function (e, t, r) {
      bi(this, pe(this, 'number' == typeof e ? se(e, t || 0) : e), null, r);
    }),
    setSelection: wn(function (e, t, r) {
      bi(this, pe(this, e), pe(this, t || e), r);
    }),
    extendSelection: wn(function (e, t, r) {
      vi(this, pe(this, e), t && pe(this, t), r);
    }),
    extendSelections: wn(function (e, t) {
      mi(this, ve(this, e), t);
    }),
    extendSelectionsBy: wn(function (e, t) {
      var r = v(this.sel.ranges, e);
      mi(this, ve(this, r), t);
    }),
    setSelections: wn(function (e, t, r) {
      var n = this;
      if (e.length) {
        for (var i = [], o = 0; o < e.length; o++)
          i[o] = new Fs(pe(n, e[o].anchor), pe(n, e[o].head));
        null == t && (t = Math.min(e.length - 1, this.sel.primIndex)),
          Ci(this, Gn(this.cm, i, t), r);
      }
    }),
    addSelection: wn(function (e, t, r) {
      var n = this.sel.ranges.slice(0);
      n.push(new Fs(pe(this, e), pe(this, t || e))),
        Ci(this, Gn(this.cm, n, n.length - 1), r);
    }),
    getSelection: function (e) {
      for (var t, r = this, n = this.sel.ranges, i = 0; i < n.length; i++) {
        var o = ee(r, n[i].from(), n[i].to());
        t = t ? t.concat(o) : o;
      }
      return !1 === e ? t : t.join(e || this.lineSeparator());
    },
    getSelections: function (e) {
      for (
        var t = this, r = [], n = this.sel.ranges, i = 0;
        i < n.length;
        i++
      ) {
        var o = ee(t, n[i].from(), n[i].to());
        !1 !== e && (o = o.join(e || t.lineSeparator())), (r[i] = o);
      }
      return r;
    },
    replaceSelection: function (e, t, r) {
      for (var n = [], i = 0; i < this.sel.ranges.length; i++) n[i] = e;
      this.replaceSelections(n, t, r || '+input');
    },
    replaceSelections: wn(function (e, t, r) {
      for (
        var n = this, i = [], o = this.sel, l = 0;
        l < o.ranges.length;
        l++
      ) {
        var s = o.ranges[l];
        i[l] = {
          from: s.from(),
          to: s.to(),
          text: n.splitLines(e[l]),
          origin: r,
        };
      }
      for (
        var a = t && 'end' != t && Yn(this, i, t), u = i.length - 1;
        u >= 0;
        u--
      )
        Wi(n, i[u]);
      a ? xi(this, a) : this.cm && qr(this.cm);
    }),
    undo: wn(function () {
      Fi(this, 'undo');
    }),
    redo: wn(function () {
      Fi(this, 'redo');
    }),
    undoSelection: wn(function () {
      Fi(this, 'undo', !0);
    }),
    redoSelection: wn(function () {
      Fi(this, 'redo', !0);
    }),
    setExtending: function (e) {
      this.extend = e;
    },
    getExtending: function () {
      return this.extend;
    },
    historySize: function () {
      for (var e = this.history, t = 0, r = 0, n = 0; n < e.done.length; n++)
        e.done[n].ranges || ++t;
      for (var i = 0; i < e.undone.length; i++) e.undone[i].ranges || ++r;
      return { undo: t, redo: r };
    },
    clearHistory: function () {
      var e = this;
      (this.history = new ri(this.history.maxGeneration)),
        Qn(
          this,
          function (t) {
            return (t.history = e.history);
          },
          !0
        );
    },
    markClean: function () {
      this.cleanGeneration = this.changeGeneration(!0);
    },
    changeGeneration: function (e) {
      return (
        e &&
          (this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null),
        this.history.generation
      );
    },
    isClean: function (e) {
      return this.history.generation == (e || this.cleanGeneration);
    },
    getHistory: function () {
      return { done: pi(this.history.done), undone: pi(this.history.undone) };
    },
    setHistory: function (e) {
      var t = (this.history = new ri(this.history.maxGeneration));
      (t.done = pi(e.done.slice(0), null, !0)),
        (t.undone = pi(e.undone.slice(0), null, !0));
    },
    setGutterMarker: wn(function (e, t, r) {
      return Ui(this, e, 'gutter', function (e) {
        var n = e.gutterMarkers || (e.gutterMarkers = {});
        return (n[t] = r), !r && C(n) && (e.gutterMarkers = null), !0;
      });
    }),
    clearGutter: wn(function (e) {
      var t = this;
      this.iter(function (r) {
        r.gutterMarkers &&
          r.gutterMarkers[e] &&
          Ui(t, r, 'gutter', function () {
            return (
              (r.gutterMarkers[e] = null),
              C(r.gutterMarkers) && (r.gutterMarkers = null),
              !0
            );
          });
      });
    }),
    lineInfo: function (e) {
      var t;
      if ('number' == typeof e) {
        if (!oe(this, e)) return null;
        if (((t = e), (e = J(this, e)), !e)) return null;
      } else if (((t = ne(e)), null == t)) return null;
      return {
        line: t,
        handle: e,
        text: e.text,
        gutterMarkers: e.gutterMarkers,
        textClass: e.textClass,
        bgClass: e.bgClass,
        wrapClass: e.wrapClass,
        widgets: e.widgets,
      };
    },
    addLineClass: wn(function (t, r, n) {
      return Ui(this, t, 'gutter' == r ? 'gutter' : 'class', function (t) {
        var i =
          'text' == r
            ? 'textClass'
            : 'background' == r
            ? 'bgClass'
            : 'gutter' == r
            ? 'gutterClass'
            : 'wrapClass';
        if (t[i]) {
          if (e(n).test(t[i])) return !1;
          t[i] += ' ' + n;
        } else t[i] = n;
        return !0;
      });
    }),
    removeLineClass: wn(function (t, r, n) {
      return Ui(this, t, 'gutter' == r ? 'gutter' : 'class', function (t) {
        var i =
            'text' == r
              ? 'textClass'
              : 'background' == r
              ? 'bgClass'
              : 'gutter' == r
              ? 'gutterClass'
              : 'wrapClass',
          o = t[i];
        if (!o) return !1;
        if (null == n) t[i] = null;
        else {
          var l = o.match(e(n));
          if (!l) return !1;
          var s = l.index + l[0].length;
          t[i] =
            o.slice(0, l.index) +
              (l.index && s != o.length ? ' ' : '') +
              o.slice(s) || null;
        }
        return !0;
      });
    }),
    addLineWidget: wn(function (e, t, r) {
      return Xi(this, e, t, r);
    }),
    removeLineWidget: function (e) {
      e.clear();
    },
    markText: function (e, t, r) {
      return Yi(this, pe(this, e), pe(this, t), r, (r && r.type) || 'range');
    },
    setBookmark: function (e, t) {
      var r = {
        replacedWith: t && (null == t.nodeType ? t.widget : t),
        insertLeft: t && t.insertLeft,
        clearWhenEmpty: !1,
        shared: t && t.shared,
        handleMouseEvents: t && t.handleMouseEvents,
      };
      return (e = pe(this, e)), Yi(this, e, e, r, 'bookmark');
    },
    findMarksAt: function (e) {
      e = pe(this, e);
      var t = [],
        r = J(this, e.line).markedSpans;
      if (r)
        for (var n = 0; n < r.length; ++n) {
          var i = r[n];
          (null == i.from || i.from <= e.ch) &&
            (null == i.to || i.to >= e.ch) &&
            t.push(i.marker.parent || i.marker);
        }
      return t;
    },
    findMarks: function (e, t, r) {
      (e = pe(this, e)), (t = pe(this, t));
      var n = [],
        i = e.line;
      return (
        this.iter(e.line, t.line + 1, function (o) {
          var l = o.markedSpans;
          if (l)
            for (var s = 0; s < l.length; s++) {
              var a = l[s];
              (null != a.to && i == e.line && e.ch >= a.to) ||
                (null == a.from && i != e.line) ||
                (null != a.from && i == t.line && a.from >= t.ch) ||
                (r && !r(a.marker)) ||
                n.push(a.marker.parent || a.marker);
            }
          ++i;
        }),
        n
      );
    },
    getAllMarks: function () {
      var e = [];
      return (
        this.iter(function (t) {
          var r = t.markedSpans;
          if (r)
            for (var n = 0; n < r.length; ++n)
              null != r[n].from && e.push(r[n].marker);
        }),
        e
      );
    },
    posFromIndex: function (e) {
      var t,
        r = this.first,
        n = this.lineSeparator().length;
      return (
        this.iter(function (i) {
          var o = i.text.length + n;
          if (o > e) return (t = e), !0;
          (e -= o), ++r;
        }),
        pe(this, se(r, t))
      );
    },
    indexFromPos: function (e) {
      e = pe(this, e);
      var t = e.ch;
      if (e.line < this.first || e.ch < 0) return 0;
      var r = this.lineSeparator().length;
      return (
        this.iter(this.first, e.line, function (e) {
          t += e.text.length + r;
        }),
        t
      );
    },
    copy: function (e) {
      var t = new Bs(
        te(this, this.first, this.first + this.size),
        this.modeOption,
        this.first,
        this.lineSep,
        this.direction
      );
      return (
        (t.scrollTop = this.scrollTop),
        (t.scrollLeft = this.scrollLeft),
        (t.sel = this.sel),
        (t.extend = !1),
        e &&
          ((t.history.undoDepth = this.history.undoDepth),
          t.setHistory(this.getHistory())),
        t
      );
    },
    linkedDoc: function (e) {
      e || (e = {});
      var t = this.first,
        r = this.first + this.size;
      null != e.from && e.from > t && (t = e.from),
        null != e.to && e.to < r && (r = e.to);
      var n = new Bs(
        te(this, t, r),
        e.mode || this.modeOption,
        t,
        this.lineSep,
        this.direction
      );
      return (
        e.sharedHist && (n.history = this.history),
        (this.linked || (this.linked = [])).push({
          doc: n,
          sharedHist: e.sharedHist,
        }),
        (n.linked = [{ doc: this, isParent: !0, sharedHist: e.sharedHist }]),
        qi(n, $i(this)),
        n
      );
    },
    unlinkDoc: function (e) {
      var t = this;
      if ((e instanceof $o && (e = e.doc), this.linked))
        for (var r = 0; r < this.linked.length; ++r) {
          var n = t.linked[r];
          if (n.doc == e) {
            t.linked.splice(r, 1), e.unlinkDoc(t), Zi($i(t));
            break;
          }
        }
      if (e.history == this.history) {
        var i = [e.id];
        Qn(
          e,
          function (e) {
            return i.push(e.id);
          },
          !0
        ),
          (e.history = new ri(null)),
          (e.history.done = pi(this.history.done, i)),
          (e.history.undone = pi(this.history.undone, i));
      }
    },
    iterLinkedDocs: function (e) {
      Qn(this, e);
    },
    getMode: function () {
      return this.mode;
    },
    getEditor: function () {
      return this.cm;
    },
    splitLines: function (e) {
      return this.lineSep ? e.split(this.lineSep) : ls(e);
    },
    lineSeparator: function () {
      return this.lineSep || '\n';
    },
    setDirection: wn(function (e) {
      'rtl' != e && (e = 'ltr'),
        e != this.direction &&
          ((this.direction = e),
          this.iter(function (e) {
            return (e.order = null);
          }),
          this.cm && ti(this.cm));
    }),
  })),
    (Bs.prototype.eachLine = Bs.prototype.iter);
  for (
    var Gs = 0,
      Us = !1,
      Vs = {
        3: 'Pause',
        8: 'Backspace',
        9: 'Tab',
        13: 'Enter',
        16: 'Shift',
        17: 'Ctrl',
        18: 'Alt',
        19: 'Pause',
        20: 'CapsLock',
        27: 'Esc',
        32: 'Space',
        33: 'PageUp',
        34: 'PageDown',
        35: 'End',
        36: 'Home',
        37: 'Left',
        38: 'Up',
        39: 'Right',
        40: 'Down',
        44: 'PrintScrn',
        45: 'Insert',
        46: 'Delete',
        59: ';',
        61: '=',
        91: 'Mod',
        92: 'Mod',
        93: 'Mod',
        106: '*',
        107: '=',
        109: '-',
        110: '.',
        111: '/',
        145: 'ScrollLock',
        173: '-',
        186: ';',
        187: '=',
        188: ',',
        189: '-',
        190: '.',
        191: '/',
        192: '`',
        219: '[',
        220: '\\',
        221: ']',
        222: "'",
        63232: 'Up',
        63233: 'Down',
        63234: 'Left',
        63235: 'Right',
        63272: 'Delete',
        63273: 'Home',
        63275: 'End',
        63276: 'PageUp',
        63277: 'PageDown',
        63302: 'Insert',
      },
      Ks = 0;
    Ks < 10;
    Ks++
  )
    Vs[Ks + 48] = Vs[Ks + 96] = String(Ks);
  for (var js = 65; js <= 90; js++) Vs[js] = String.fromCharCode(js);
  for (var Xs = 1; Xs <= 12; Xs++) Vs[Xs + 111] = Vs[Xs + 63235] = 'F' + Xs;
  var Ys = {
    basic: {
      Left: 'goCharLeft',
      Right: 'goCharRight',
      Up: 'goLineUp',
      Down: 'goLineDown',
      End: 'goLineEnd',
      Home: 'goLineStartSmart',
      PageUp: 'goPageUp',
      PageDown: 'goPageDown',
      Delete: 'delCharAfter',
      Backspace: 'delCharBefore',
      'Shift-Backspace': 'delCharBefore',
      Tab: 'defaultTab',
      'Shift-Tab': 'indentAuto',
      Enter: 'newlineAndIndent',
      Insert: 'toggleOverwrite',
      Esc: 'singleSelection',
    },
    pcDefault: {
      'Ctrl-A': 'selectAll',
      'Ctrl-D': 'deleteLine',
      'Ctrl-Z': 'undo',
      'Shift-Ctrl-Z': 'redo',
      'Ctrl-Y': 'redo',
      'Ctrl-Home': 'goDocStart',
      'Ctrl-End': 'goDocEnd',
      'Ctrl-Up': 'goLineUp',
      'Ctrl-Down': 'goLineDown',
      'Ctrl-Left': 'goGroupLeft',
      'Ctrl-Right': 'goGroupRight',
      'Alt-Left': 'goLineStart',
      'Alt-Right': 'goLineEnd',
      'Ctrl-Backspace': 'delGroupBefore',
      'Ctrl-Delete': 'delGroupAfter',
      'Ctrl-S': 'save',
      'Ctrl-F': 'find',
      'Ctrl-G': 'findNext',
      'Shift-Ctrl-G': 'findPrev',
      'Shift-Ctrl-F': 'replace',
      'Shift-Ctrl-R': 'replaceAll',
      'Ctrl-[': 'indentLess',
      'Ctrl-]': 'indentMore',
      'Ctrl-U': 'undoSelection',
      'Shift-Ctrl-U': 'redoSelection',
      'Alt-U': 'redoSelection',
      fallthrough: 'basic',
    },
    emacsy: {
      'Ctrl-F': 'goCharRight',
      'Ctrl-B': 'goCharLeft',
      'Ctrl-P': 'goLineUp',
      'Ctrl-N': 'goLineDown',
      'Alt-F': 'goWordRight',
      'Alt-B': 'goWordLeft',
      'Ctrl-A': 'goLineStart',
      'Ctrl-E': 'goLineEnd',
      'Ctrl-V': 'goPageDown',
      'Shift-Ctrl-V': 'goPageUp',
      'Ctrl-D': 'delCharAfter',
      'Ctrl-H': 'delCharBefore',
      'Alt-D': 'delWordAfter',
      'Alt-Backspace': 'delWordBefore',
      'Ctrl-K': 'killLine',
      'Ctrl-T': 'transposeChars',
      'Ctrl-O': 'openLine',
    },
    macDefault: {
      'Cmd-A': 'selectAll',
      'Cmd-D': 'deleteLine',
      'Cmd-Z': 'undo',
      'Shift-Cmd-Z': 'redo',
      'Cmd-Y': 'redo',
      'Cmd-Home': 'goDocStart',
      'Cmd-Up': 'goDocStart',
      'Cmd-End': 'goDocEnd',
      'Cmd-Down': 'goDocEnd',
      'Alt-Left': 'goGroupLeft',
      'Alt-Right': 'goGroupRight',
      'Cmd-Left': 'goLineLeft',
      'Cmd-Right': 'goLineRight',
      'Alt-Backspace': 'delGroupBefore',
      'Ctrl-Alt-Backspace': 'delGroupAfter',
      'Alt-Delete': 'delGroupAfter',
      'Cmd-S': 'save',
      'Cmd-F': 'find',
      'Cmd-G': 'findNext',
      'Shift-Cmd-G': 'findPrev',
      'Cmd-Alt-F': 'replace',
      'Shift-Cmd-Alt-F': 'replaceAll',
      'Cmd-[': 'indentLess',
      'Cmd-]': 'indentMore',
      'Cmd-Backspace': 'delWrappedLineLeft',
      'Cmd-Delete': 'delWrappedLineRight',
      'Cmd-U': 'undoSelection',
      'Shift-Cmd-U': 'redoSelection',
      'Ctrl-Up': 'goDocStart',
      'Ctrl-Down': 'goDocEnd',
      fallthrough: ['basic', 'emacsy'],
    },
  };
  Ys.default = Fl ? Ys.macDefault : Ys.pcDefault;
  var _s,
    $s,
    qs = {
      selectAll: Ai,
      singleSelection: function (e) {
        return e.setSelection(e.getCursor('anchor'), e.getCursor('head'), $l);
      },
      killLine: function (e) {
        return po(e, function (t) {
          if (t.empty()) {
            var r = J(e.doc, t.head.line).text.length;
            return t.head.ch == r && t.head.line < e.lastLine()
              ? { from: t.head, to: se(t.head.line + 1, 0) }
              : { from: t.head, to: se(t.head.line, r) };
          }
          return { from: t.from(), to: t.to() };
        });
      },
      deleteLine: function (e) {
        return po(e, function (t) {
          return {
            from: se(t.from().line, 0),
            to: pe(e.doc, se(t.to().line + 1, 0)),
          };
        });
      },
      delLineLeft: function (e) {
        return po(e, function (e) {
          return { from: se(e.from().line, 0), to: e.from() };
        });
      },
      delWrappedLineLeft: function (e) {
        return po(e, function (t) {
          var r = e.charCoords(t.head, 'div').top + 5,
            n = e.coordsChar({ left: 0, top: r }, 'div');
          return { from: n, to: t.from() };
        });
      },
      delWrappedLineRight: function (e) {
        return po(e, function (t) {
          var r = e.charCoords(t.head, 'div').top + 5,
            n = e.coordsChar(
              { left: e.display.lineDiv.offsetWidth + 100, top: r },
              'div'
            );
          return { from: t.from(), to: n };
        });
      },
      undo: function (e) {
        return e.undo();
      },
      redo: function (e) {
        return e.redo();
      },
      undoSelection: function (e) {
        return e.undoSelection();
      },
      redoSelection: function (e) {
        return e.redoSelection();
      },
      goDocStart: function (e) {
        return e.extendSelection(se(e.firstLine(), 0));
      },
      goDocEnd: function (e) {
        return e.extendSelection(se(e.lastLine()));
      },
      goLineStart: function (e) {
        return e.extendSelectionsBy(
          function (t) {
            return bo(e, t.head.line);
          },
          { origin: '+move', bias: 1 }
        );
      },
      goLineStartSmart: function (e) {
        return e.extendSelectionsBy(
          function (t) {
            return xo(e, t.head);
          },
          { origin: '+move', bias: 1 }
        );
      },
      goLineEnd: function (e) {
        return e.extendSelectionsBy(
          function (t) {
            return wo(e, t.head.line);
          },
          { origin: '+move', bias: -1 }
        );
      },
      goLineRight: function (e) {
        return e.extendSelectionsBy(function (t) {
          var r = e.cursorCoords(t.head, 'div').top + 5;
          return e.coordsChar(
            { left: e.display.lineDiv.offsetWidth + 100, top: r },
            'div'
          );
        }, Zl);
      },
      goLineLeft: function (e) {
        return e.extendSelectionsBy(function (t) {
          var r = e.cursorCoords(t.head, 'div').top + 5;
          return e.coordsChar({ left: 0, top: r }, 'div');
        }, Zl);
      },
      goLineLeftSmart: function (e) {
        return e.extendSelectionsBy(function (t) {
          var r = e.cursorCoords(t.head, 'div').top + 5,
            n = e.coordsChar({ left: 0, top: r }, 'div');
          return n.ch < e.getLine(n.line).search(/\S/) ? xo(e, t.head) : n;
        }, Zl);
      },
      goLineUp: function (e) {
        return e.moveV(-1, 'line');
      },
      goLineDown: function (e) {
        return e.moveV(1, 'line');
      },
      goPageUp: function (e) {
        return e.moveV(-1, 'page');
      },
      goPageDown: function (e) {
        return e.moveV(1, 'page');
      },
      goCharLeft: function (e) {
        return e.moveH(-1, 'char');
      },
      goCharRight: function (e) {
        return e.moveH(1, 'char');
      },
      goColumnLeft: function (e) {
        return e.moveH(-1, 'column');
      },
      goColumnRight: function (e) {
        return e.moveH(1, 'column');
      },
      goWordLeft: function (e) {
        return e.moveH(-1, 'word');
      },
      goGroupRight: function (e) {
        return e.moveH(1, 'group');
      },
      goGroupLeft: function (e) {
        return e.moveH(-1, 'group');
      },
      goWordRight: function (e) {
        return e.moveH(1, 'word');
      },
      delCharBefore: function (e) {
        return e.deleteH(-1, 'char');
      },
      delCharAfter: function (e) {
        return e.deleteH(1, 'char');
      },
      delWordBefore: function (e) {
        return e.deleteH(-1, 'word');
      },
      delWordAfter: function (e) {
        return e.deleteH(1, 'word');
      },
      delGroupBefore: function (e) {
        return e.deleteH(-1, 'group');
      },
      delGroupAfter: function (e) {
        return e.deleteH(1, 'group');
      },
      indentAuto: function (e) {
        return e.indentSelection('smart');
      },
      indentMore: function (e) {
        return e.indentSelection('add');
      },
      indentLess: function (e) {
        return e.indentSelection('subtract');
      },
      insertTab: function (e) {
        return e.replaceSelection('\t');
      },
      insertSoftTab: function (e) {
        for (
          var t = [], r = e.listSelections(), n = e.options.tabSize, i = 0;
          i < r.length;
          i++
        ) {
          var o = r[i].from(),
            l = h(e.getLine(o.line), o.ch, n);
          t.push(p(n - (l % n)));
        }
        e.replaceSelections(t);
      },
      defaultTab: function (e) {
        e.somethingSelected()
          ? e.indentSelection('add')
          : e.execCommand('insertTab');
      },
      transposeChars: function (e) {
        return mn(e, function () {
          for (var t = e.listSelections(), r = [], n = 0; n < t.length; n++)
            if (t[n].empty()) {
              var i = t[n].head,
                o = J(e.doc, i.line).text;
              if (o)
                if (
                  (i.ch == o.length && (i = new se(i.line, i.ch - 1)), i.ch > 0)
                )
                  (i = new se(i.line, i.ch + 1)),
                    e.replaceRange(
                      o.charAt(i.ch - 1) + o.charAt(i.ch - 2),
                      se(i.line, i.ch - 2),
                      i,
                      '+transpose'
                    );
                else if (i.line > e.doc.first) {
                  var l = J(e.doc, i.line - 1).text;
                  l &&
                    ((i = new se(i.line, 1)),
                    e.replaceRange(
                      o.charAt(0) +
                        e.doc.lineSeparator() +
                        l.charAt(l.length - 1),
                      se(i.line - 1, l.length - 1),
                      i,
                      '+transpose'
                    ));
                }
              r.push(new Fs(i, i));
            }
          e.setSelections(r);
        });
      },
      newlineAndIndent: function (e) {
        return mn(e, function () {
          for (var t = e.listSelections(), r = t.length - 1; r >= 0; r--)
            e.replaceRange(
              e.doc.lineSeparator(),
              t[r].anchor,
              t[r].head,
              '+input'
            );
          t = e.listSelections();
          for (var n = 0; n < t.length; n++)
            e.indentLine(t[n].from().line, null, !0);
          qr(e);
        });
      },
      openLine: function (e) {
        return e.replaceSelection('\n', 'start');
      },
      toggleOverwrite: function (e) {
        return e.toggleOverwrite();
      },
    },
    Zs = new Vl(),
    Qs = null,
    Js = 400,
    ea = function (e, t, r) {
      (this.time = e), (this.pos = t), (this.button = r);
    };
  ea.prototype.compare = function (e, t, r) {
    return this.time + Js > e && 0 == ae(t, this.pos) && r == this.button;
  };
  var ta = {
      toString: function () {
        return 'CodeMirror.Init';
      },
    },
    ra = {},
    na = {};
  ($o.defaults = ra), ($o.optionHandlers = na);
  var ia = [];
  $o.defineInitHook = function (e) {
    return ia.push(e);
  };
  var oa = null,
    la = function (e) {
      (this.cm = e),
        (this.lastAnchorNode = this.lastAnchorOffset = this.lastFocusNode = this.lastFocusOffset = null),
        (this.polling = new Vl()),
        (this.composing = null),
        (this.gracePeriod = !1),
        (this.readDOMTimeout = null);
    };
  (la.prototype.init = function (e) {
    function t(e) {
      if (!W(i, e)) {
        if (i.somethingSelected())
          Qo({ lineWise: !1, text: i.getSelections() }),
            'cut' == e.type && i.replaceSelection('', null, 'cut');
        else {
          if (!i.options.lineWiseCopyCut) return;
          var t = rl(i);
          Qo({ lineWise: !0, text: t.text }),
            'cut' == e.type &&
              i.operation(function () {
                i.setSelections(t.ranges, 0, $l),
                  i.replaceSelection('', null, 'cut');
              });
        }
        if (e.clipboardData) {
          e.clipboardData.clearData();
          var r = oa.text.join('\n');
          if (
            (e.clipboardData.setData('Text', r),
            e.clipboardData.getData('Text') == r)
          )
            return void e.preventDefault();
        }
        var l = il(),
          s = l.firstChild;
        i.display.lineSpace.insertBefore(l, i.display.lineSpace.firstChild),
          (s.value = oa.text.join('\n'));
        var a = document.activeElement;
        Ul(s),
          setTimeout(function () {
            i.display.lineSpace.removeChild(l),
              a.focus(),
              a == o && n.showPrimarySelection();
          }, 50);
      }
    }
    var r = this,
      n = this,
      i = n.cm,
      o = (n.div = e.lineDiv);
    nl(
      o,
      i.options.spellcheck,
      i.options.autocorrect,
      i.options.autocapitalize
    ),
      is(o, 'paste', function (e) {
        W(i, e) ||
          el(e, i) ||
          (Sl <= 11 &&
            setTimeout(
              yn(i, function () {
                return r.updateFromDOM();
              }),
              20
            ));
      }),
      is(o, 'compositionstart', function (e) {
        r.composing = { data: e.data, done: !1 };
      }),
      is(o, 'compositionupdate', function (e) {
        r.composing || (r.composing = { data: e.data, done: !1 });
      }),
      is(o, 'compositionend', function (e) {
        r.composing &&
          (e.data != r.composing.data && r.readFromDOMSoon(),
          (r.composing.done = !0));
      }),
      is(o, 'touchstart', function () {
        return n.forceCompositionEnd();
      }),
      is(o, 'input', function () {
        r.composing || r.readFromDOMSoon();
      }),
      is(o, 'copy', t),
      is(o, 'cut', t);
  }),
    (la.prototype.screenReaderLabelChanged = function (e) {
      e
        ? this.div.setAttribute('aria-label', e)
        : this.div.removeAttribute('aria-label');
    }),
    (la.prototype.prepareSelection = function () {
      var e = Hr(this.cm, !1);
      return (e.focus = document.activeElement == this.div), e;
    }),
    (la.prototype.showSelection = function (e, t) {
      e &&
        this.cm.display.view.length &&
        ((e.focus || t) && this.showPrimarySelection(),
        this.showMultipleSelections(e));
    }),
    (la.prototype.getSelection = function () {
      return this.cm.display.wrapper.ownerDocument.getSelection();
    }),
    (la.prototype.showPrimarySelection = function () {
      var e = this.getSelection(),
        t = this.cm,
        r = t.doc.sel.primary(),
        n = r.from(),
        i = r.to();
      if (
        t.display.viewTo == t.display.viewFrom ||
        n.line >= t.display.viewTo ||
        i.line < t.display.viewFrom
      )
        e.removeAllRanges();
      else {
        var o = fl(t, e.anchorNode, e.anchorOffset),
          l = fl(t, e.focusNode, e.focusOffset);
        if (
          !o ||
          o.bad ||
          !l ||
          l.bad ||
          0 != ae(fe(o, l), n) ||
          0 != ae(he(o, l), i)
        ) {
          var s = t.display.view,
            a = (n.line >= t.display.viewFrom && al(t, n)) || {
              node: s[0].measure.map[2],
              offset: 0,
            },
            u = i.line < t.display.viewTo && al(t, i);
          if (!u) {
            var c = s[s.length - 1].measure,
              h = c.maps ? c.maps[c.maps.length - 1] : c.map;
            u = {
              node: h[h.length - 1],
              offset: h[h.length - 2] - h[h.length - 3],
            };
          }
          if (a && u) {
            var f,
              d = e.rangeCount && e.getRangeAt(0);
            try {
              f = zl(a.node, a.offset, u.offset, u.node);
            } catch (e) {}
            f &&
              (!yl && t.state.focused
                ? (e.collapse(a.node, a.offset),
                  f.collapsed || (e.removeAllRanges(), e.addRange(f)))
                : (e.removeAllRanges(), e.addRange(f)),
              d && null == e.anchorNode
                ? e.addRange(d)
                : yl && this.startGracePeriod()),
              this.rememberSelection();
          } else e.removeAllRanges();
        }
      }
    }),
    (la.prototype.startGracePeriod = function () {
      var e = this;
      clearTimeout(this.gracePeriod),
        (this.gracePeriod = setTimeout(function () {
          (e.gracePeriod = !1),
            e.selectionChanged() &&
              e.cm.operation(function () {
                return (e.cm.curOp.selectionChanged = !0);
              });
        }, 20));
    }),
    (la.prototype.showMultipleSelections = function (e) {
      r(this.cm.display.cursorDiv, e.cursors),
        r(this.cm.display.selectionDiv, e.selection);
    }),
    (la.prototype.rememberSelection = function () {
      var e = this.getSelection();
      (this.lastAnchorNode = e.anchorNode),
        (this.lastAnchorOffset = e.anchorOffset),
        (this.lastFocusNode = e.focusNode),
        (this.lastFocusOffset = e.focusOffset);
    }),
    (la.prototype.selectionInEditor = function () {
      var e = this.getSelection();
      if (!e.rangeCount) return !1;
      var t = e.getRangeAt(0).commonAncestorContainer;
      return o(this.div, t);
    }),
    (la.prototype.focus = function () {
      'nocursor' != this.cm.options.readOnly &&
        ((this.selectionInEditor() && document.activeElement == this.div) ||
          this.showSelection(this.prepareSelection(), !0),
        this.div.focus());
    }),
    (la.prototype.blur = function () {
      this.div.blur();
    }),
    (la.prototype.getField = function () {
      return this.div;
    }),
    (la.prototype.supportsTouch = function () {
      return !0;
    }),
    (la.prototype.receivedFocus = function () {
      function e() {
        t.cm.state.focused &&
          (t.pollSelection(), t.polling.set(t.cm.options.pollInterval, e));
      }
      var t = this;
      this.selectionInEditor()
        ? this.pollSelection()
        : mn(this.cm, function () {
            return (t.cm.curOp.selectionChanged = !0);
          }),
        this.polling.set(this.cm.options.pollInterval, e);
    }),
    (la.prototype.selectionChanged = function () {
      var e = this.getSelection();
      return (
        e.anchorNode != this.lastAnchorNode ||
        e.anchorOffset != this.lastAnchorOffset ||
        e.focusNode != this.lastFocusNode ||
        e.focusOffset != this.lastFocusOffset
      );
    }),
    (la.prototype.pollSelection = function () {
      if (
        null == this.readDOMTimeout &&
        !this.gracePeriod &&
        this.selectionChanged()
      ) {
        var e = this.getSelection(),
          t = this.cm;
        if (Wl && Tl && this.cm.display.gutterSpecs.length && ul(e.anchorNode))
          return (
            this.cm.triggerOnKeyDown({
              type: 'keydown',
              keyCode: 8,
              preventDefault: Math.abs,
            }),
            this.blur(),
            void this.focus()
          );
        if (!this.composing) {
          this.rememberSelection();
          var r = fl(t, e.anchorNode, e.anchorOffset),
            n = fl(t, e.focusNode, e.focusOffset);
          r &&
            n &&
            mn(t, function () {
              Ci(t.doc, Un(r, n), $l),
                (r.bad || n.bad) && (t.curOp.selectionChanged = !0);
            });
        }
      }
    }),
    (la.prototype.pollContent = function () {
      null != this.readDOMTimeout &&
        (clearTimeout(this.readDOMTimeout), (this.readDOMTimeout = null));
      var e,
        t,
        r,
        n = this.cm,
        i = n.display,
        o = n.doc.sel.primary(),
        l = o.from(),
        s = o.to();
      if (
        (0 == l.ch &&
          l.line > n.firstLine() &&
          (l = se(l.line - 1, J(n.doc, l.line - 1).length)),
        s.ch == J(n.doc, s.line).text.length &&
          s.line < n.lastLine() &&
          (s = se(s.line + 1, 0)),
        l.line < i.viewFrom || s.line > i.viewTo - 1)
      )
        return !1;
      l.line == i.viewFrom || 0 == (e = kr(n, l.line))
        ? ((t = ne(i.view[0].line)), (r = i.view[0].node))
        : ((t = ne(i.view[e].line)), (r = i.view[e - 1].node.nextSibling));
      var a,
        u,
        c = kr(n, s.line);
      if (
        (c == i.view.length - 1
          ? ((a = i.viewTo - 1), (u = i.lineDiv.lastChild))
          : ((a = ne(i.view[c + 1].line) - 1),
            (u = i.view[c + 1].node.previousSibling)),
        !r)
      )
        return !1;
      for (
        var h = n.doc.splitLines(hl(n, r, u, t, a)),
          f = ee(n.doc, se(t, 0), se(a, J(n.doc, a).text.length));
        h.length > 1 && f.length > 1;

      )
        if (g(h) == g(f)) h.pop(), f.pop(), a--;
        else {
          if (h[0] != f[0]) break;
          h.shift(), f.shift(), t++;
        }
      for (
        var d = 0, p = 0, v = h[0], m = f[0], y = Math.min(v.length, m.length);
        d < y && v.charCodeAt(d) == m.charCodeAt(d);

      )
        ++d;
      for (
        var b = g(h),
          w = g(f),
          x = Math.min(
            b.length - (1 == h.length ? d : 0),
            w.length - (1 == f.length ? d : 0)
          );
        p < x &&
        b.charCodeAt(b.length - p - 1) == w.charCodeAt(w.length - p - 1);

      )
        ++p;
      if (1 == h.length && 1 == f.length && t == l.line)
        for (
          ;
          d &&
          d > l.ch &&
          b.charCodeAt(b.length - p - 1) == w.charCodeAt(w.length - p - 1);

        )
          d--, p++;
      (h[h.length - 1] = b.slice(0, b.length - p).replace(/^\u200b+/, '')),
        (h[0] = h[0].slice(d).replace(/\u200b+$/, ''));
      var C = se(t, d),
        S = se(a, f.length ? g(f).length - p : 0);
      return h.length > 1 || h[0] || ae(C, S)
        ? (zi(n.doc, h, C, S, '+input'), !0)
        : void 0;
    }),
    (la.prototype.ensurePolled = function () {
      this.forceCompositionEnd();
    }),
    (la.prototype.reset = function () {
      this.forceCompositionEnd();
    }),
    (la.prototype.forceCompositionEnd = function () {
      this.composing &&
        (clearTimeout(this.readDOMTimeout),
        (this.composing = null),
        this.updateFromDOM(),
        this.div.blur(),
        this.div.focus());
    }),
    (la.prototype.readFromDOMSoon = function () {
      var e = this;
      null == this.readDOMTimeout &&
        (this.readDOMTimeout = setTimeout(function () {
          if (((e.readDOMTimeout = null), e.composing)) {
            if (!e.composing.done) return;
            e.composing = null;
          }
          e.updateFromDOM();
        }, 80));
    }),
    (la.prototype.updateFromDOM = function () {
      var e = this;
      (!this.cm.isReadOnly() && this.pollContent()) ||
        mn(this.cm, function () {
          return Tr(e.cm);
        });
    }),
    (la.prototype.setUneditable = function (e) {
      e.contentEditable = 'false';
    }),
    (la.prototype.onKeyPress = function (e) {
      0 == e.charCode ||
        this.composing ||
        (e.preventDefault(),
        this.cm.isReadOnly() ||
          yn(this.cm, Jo)(
            this.cm,
            String.fromCharCode(null == e.charCode ? e.keyCode : e.charCode),
            0
          ));
    }),
    (la.prototype.readOnlyChanged = function (e) {
      this.div.contentEditable = String('nocursor' != e);
    }),
    (la.prototype.onContextMenu = function () {}),
    (la.prototype.resetPosition = function () {}),
    (la.prototype.needsContentAttribute = !0);
  var sa = function (e) {
    (this.cm = e),
      (this.prevInput = ''),
      (this.pollingFast = !1),
      (this.polling = new Vl()),
      (this.hasSelection = !1),
      (this.composing = null);
  };
  (sa.prototype.init = function (e) {
    function t(e) {
      if (!W(i, e)) {
        if (i.somethingSelected())
          Qo({ lineWise: !1, text: i.getSelections() });
        else {
          if (!i.options.lineWiseCopyCut) return;
          var t = rl(i);
          Qo({ lineWise: !0, text: t.text }),
            'cut' == e.type
              ? i.setSelections(t.ranges, null, $l)
              : ((n.prevInput = ''), (o.value = t.text.join('\n')), Ul(o));
        }
        'cut' == e.type && (i.state.cutIncoming = +new Date());
      }
    }
    var r = this,
      n = this,
      i = this.cm;
    this.createField(e);
    var o = this.textarea;
    e.wrapper.insertBefore(this.wrapper, e.wrapper.firstChild),
      Dl && (o.style.width = '0px'),
      is(o, 'input', function () {
        Cl && Sl >= 9 && r.hasSelection && (r.hasSelection = null), n.poll();
      }),
      is(o, 'paste', function (e) {
        W(i, e) ||
          el(e, i) ||
          ((i.state.pasteIncoming = +new Date()), n.fastPoll());
      }),
      is(o, 'cut', t),
      is(o, 'copy', t),
      is(e.scroller, 'paste', function (t) {
        if (!Pt(e, t) && !W(i, t)) {
          if (!o.dispatchEvent)
            return (i.state.pasteIncoming = +new Date()), void n.focus();
          var r = new Event('paste');
          (r.clipboardData = t.clipboardData), o.dispatchEvent(r);
        }
      }),
      is(e.lineSpace, 'selectstart', function (t) {
        Pt(e, t) || E(t);
      }),
      is(o, 'compositionstart', function () {
        var e = i.getCursor('from');
        n.composing && n.composing.range.clear(),
          (n.composing = {
            start: e,
            range: i.markText(e, i.getCursor('to'), {
              className: 'CodeMirror-composing',
            }),
          });
      }),
      is(o, 'compositionend', function () {
        n.composing &&
          (n.poll(), n.composing.range.clear(), (n.composing = null));
      });
  }),
    (sa.prototype.createField = function (e) {
      (this.wrapper = il()), (this.textarea = this.wrapper.firstChild);
    }),
    (sa.prototype.screenReaderLabelChanged = function (e) {
      e
        ? this.textarea.setAttribute('aria-label', e)
        : this.textarea.removeAttribute('aria-label');
    }),
    (sa.prototype.prepareSelection = function () {
      var e = this.cm,
        t = e.display,
        r = e.doc,
        n = Hr(e);
      if (e.options.moveInputWithCursor) {
        var i = ar(e, r.sel.primary().head, 'div'),
          o = t.wrapper.getBoundingClientRect(),
          l = t.lineDiv.getBoundingClientRect();
        (n.teTop = Math.max(
          0,
          Math.min(t.wrapper.clientHeight - 10, i.top + l.top - o.top)
        )),
          (n.teLeft = Math.max(
            0,
            Math.min(t.wrapper.clientWidth - 10, i.left + l.left - o.left)
          ));
      }
      return n;
    }),
    (sa.prototype.showSelection = function (e) {
      var t = this.cm,
        n = t.display;
      r(n.cursorDiv, e.cursors),
        r(n.selectionDiv, e.selection),
        null != e.teTop &&
          ((this.wrapper.style.top = e.teTop + 'px'),
          (this.wrapper.style.left = e.teLeft + 'px'));
    }),
    (sa.prototype.reset = function (e) {
      if (!this.contextMenuPending && !this.composing) {
        var t = this.cm;
        if (t.somethingSelected()) {
          this.prevInput = '';
          var r = t.getSelection();
          (this.textarea.value = r),
            t.state.focused && Ul(this.textarea),
            Cl && Sl >= 9 && (this.hasSelection = r);
        } else
          e ||
            ((this.prevInput = this.textarea.value = ''),
            Cl && Sl >= 9 && (this.hasSelection = null));
      }
    }),
    (sa.prototype.getField = function () {
      return this.textarea;
    }),
    (sa.prototype.supportsTouch = function () {
      return !1;
    }),
    (sa.prototype.focus = function () {
      if (
        'nocursor' != this.cm.options.readOnly &&
        (!Hl || l() != this.textarea)
      )
        try {
          this.textarea.focus();
        } catch (e) {}
    }),
    (sa.prototype.blur = function () {
      this.textarea.blur();
    }),
    (sa.prototype.resetPosition = function () {
      this.wrapper.style.top = this.wrapper.style.left = 0;
    }),
    (sa.prototype.receivedFocus = function () {
      this.slowPoll();
    }),
    (sa.prototype.slowPoll = function () {
      var e = this;
      this.pollingFast ||
        this.polling.set(this.cm.options.pollInterval, function () {
          e.poll(), e.cm.state.focused && e.slowPoll();
        });
    }),
    (sa.prototype.fastPoll = function () {
      function e() {
        var n = r.poll();
        n || t
          ? ((r.pollingFast = !1), r.slowPoll())
          : ((t = !0), r.polling.set(60, e));
      }
      var t = !1,
        r = this;
      (r.pollingFast = !0), r.polling.set(20, e);
    }),
    (sa.prototype.poll = function () {
      var e = this,
        t = this.cm,
        r = this.textarea,
        n = this.prevInput;
      if (
        this.contextMenuPending ||
        !t.state.focused ||
        (ss(r) && !n && !this.composing) ||
        t.isReadOnly() ||
        t.options.disableInput ||
        t.state.keySeq
      )
        return !1;
      var i = r.value;
      if (i == n && !t.somethingSelected()) return !1;
      if (
        (Cl && Sl >= 9 && this.hasSelection === i) ||
        (Fl && /[\uf700-\uf7ff]/.test(i))
      )
        return t.display.input.reset(), !1;
      if (t.doc.sel == t.display.selForContextMenu) {
        var o = i.charCodeAt(0);
        if ((8203 != o || n || (n = '​'), 8666 == o))
          return this.reset(), this.cm.execCommand('undo');
      }
      for (
        var l = 0, s = Math.min(n.length, i.length);
        l < s && n.charCodeAt(l) == i.charCodeAt(l);

      )
        ++l;
      return (
        mn(t, function () {
          Jo(
            t,
            i.slice(l),
            n.length - l,
            null,
            e.composing ? '*compose' : null
          ),
            i.length > 1e3 || i.indexOf('\n') > -1
              ? (r.value = e.prevInput = '')
              : (e.prevInput = i),
            e.composing &&
              (e.composing.range.clear(),
              (e.composing.range = t.markText(
                e.composing.start,
                t.getCursor('to'),
                { className: 'CodeMirror-composing' }
              )));
        }),
        !0
      );
    }),
    (sa.prototype.ensurePolled = function () {
      this.pollingFast && this.poll() && (this.pollingFast = !1);
    }),
    (sa.prototype.onKeyPress = function () {
      Cl && Sl >= 9 && (this.hasSelection = null), this.fastPoll();
    }),
    (sa.prototype.onContextMenu = function (e) {
      function t() {
        if (null != l.selectionStart) {
          var e = i.somethingSelected(),
            t = '​' + (e ? l.value : '');
          (l.value = '⇚'),
            (l.value = t),
            (n.prevInput = e ? '' : '​'),
            (l.selectionStart = 1),
            (l.selectionEnd = t.length),
            (o.selForContextMenu = i.doc.sel);
        }
      }
      function r() {
        if (
          n.contextMenuPending == r &&
          ((n.contextMenuPending = !1),
          (n.wrapper.style.cssText = f),
          (l.style.cssText = h),
          Cl && Sl < 9 && o.scrollbars.setScrollTop((o.scroller.scrollTop = a)),
          null != l.selectionStart)
        ) {
          (!Cl || (Cl && Sl < 9)) && t();
          var e = 0,
            s = function () {
              o.selForContextMenu == i.doc.sel &&
              0 == l.selectionStart &&
              l.selectionEnd > 0 &&
              '​' == n.prevInput
                ? yn(i, Ai)(i)
                : e++ < 10
                ? (o.detectingSelectAll = setTimeout(s, 500))
                : ((o.selForContextMenu = null), o.input.reset());
            };
          o.detectingSelectAll = setTimeout(s, 200);
        }
      }
      var n = this,
        i = n.cm,
        o = i.display,
        l = n.textarea;
      n.contextMenuPending && n.contextMenuPending();
      var s = Lr(i, e),
        a = o.scroller.scrollTop;
      if (s && !Ml) {
        var u = i.options.resetSelectionOnContextMenu;
        u && -1 == i.doc.sel.contains(s) && yn(i, Ci)(i.doc, Un(s), $l);
        var c,
          h = l.style.cssText,
          f = n.wrapper.style.cssText,
          d = n.wrapper.offsetParent.getBoundingClientRect();
        if (
          ((n.wrapper.style.cssText = 'position: static'),
          (l.style.cssText =
            'position: absolute; width: 30px; height: 30px;\n      top: ' +
            (e.clientY - d.top - 5) +
            'px; left: ' +
            (e.clientX - d.left - 5) +
            'px;\n      z-index: 1000; background: ' +
            (Cl ? 'rgba(255, 255, 255, .05)' : 'transparent') +
            ';\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);'),
          Ll && (c = window.scrollY),
          o.input.focus(),
          Ll && window.scrollTo(null, c),
          o.input.reset(),
          i.somethingSelected() || (l.value = n.prevInput = ' '),
          (n.contextMenuPending = r),
          (o.selForContextMenu = i.doc.sel),
          clearTimeout(o.detectingSelectAll),
          Cl && Sl >= 9 && t(),
          Bl)
        ) {
          R(e);
          var p = function () {
            A(window, 'mouseup', p), setTimeout(r, 20);
          };
          is(window, 'mouseup', p);
        } else setTimeout(r, 50);
      }
    }),
    (sa.prototype.readOnlyChanged = function (e) {
      e || this.reset(), (this.textarea.disabled = 'nocursor' == e);
    }),
    (sa.prototype.setUneditable = function () {}),
    (sa.prototype.needsContentAttribute = !1),
    Xo($o),
    ol($o);
  var aa = 'iter insert remove copy getEditor constructor'.split(' ');
  for (var ua in Bs.prototype)
    Bs.prototype.hasOwnProperty(ua) &&
      f(aa, ua) < 0 &&
      ($o.prototype[ua] = (function (e) {
        return function () {
          return e.apply(this.doc, arguments);
        };
      })(Bs.prototype[ua]));
  return (
    P(Bs),
    ($o.inputStyles = { textarea: sa, contenteditable: la }),
    ($o.defineMode = function (e) {
      $o.defaults.mode || 'null' == e || ($o.defaults.mode = e),
        j.apply(this, arguments);
    }),
    ($o.defineMIME = X),
    $o.defineMode('null', function () {
      return {
        token: function (e) {
          return e.skipToEnd();
        },
      };
    }),
    $o.defineMIME('text/plain', 'null'),
    ($o.defineExtension = function (e, t) {
      $o.prototype[e] = t;
    }),
    ($o.defineDocExtension = function (e, t) {
      Bs.prototype[e] = t;
    }),
    ($o.fromTextArea = pl),
    gl($o),
    ($o.version = '5.53.2'),
    $o
  );
});
